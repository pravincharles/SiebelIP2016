/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET13 */
if(typeof(SiebelAppFacade.JQFullCalRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.JQFullCalRenderer");define("siebel/jqfullcalrenderer",["3rdParty/moment.min.js","3rdParty/fullcalendar/fullcalendar.js","3rdParty/jquery-ui/current/ui/jquery.ui.tooltip.js","3rdParty/jquery-ui/current/ui/jquery.ui.mouse.js","3rdParty/jquery-ui/current/ui/jquery.ui.widget.js","3rdParty/jquery.ui.touch-punch.min.js","siebel/phyrenderer"],function(){SiebelAppFacade.JQFullCalRenderer=(function(){function d(h){SiebelAppFacade.JQFullCalRenderer.superclass.constructor.call(this,h);var m=$();var g=this.GetPM();var j={};var i={};var k={};var l={};this.GetCal=function(){return m};this.SetCal=function(n){m=n};this.GetLocaleConverter=function(){return j};this.SetLocaleConverter=function(n){j=n};this.GetUtilityMap=function(){return i};this.SetUtilityMap=function(n){i=n};this.GetCalCtrlBuilder=function(){return k};this.SetCalCtrlBuilder=function(n){k=n};this.GetEventHandlerMap=function(){return l};this.SetEventHandlerMap=function(n){l=n};this.SetDefaultView=function(){if(!g.Get("ViewMode")){var o=g.Get("Default Calendar Mode");var n;switch(o){case"Monthly":n="2";break;case"Weekly":n="1";break;case"Daily":n="0";break;default:n="0";break}g.AddProperty("ViewMode",n)}}}SiebelJS.Extend(d,SiebelAppFacade.PhysicalRenderer);d.prototype.Init=function(){SiebelAppFacade.JQFullCalRenderer.superclass.Init.call(this);var g=this.GetPM();this.AttachPMBinding("ParseEventInfoOUI",function(){g.AddProperty("SelectedDate",new Date(g.Get("Default Selected Day")))},{scope:this,when:function(){return g.Get("FirstLoad")&&g.Get("Default Selected Day")}});this.AttachPMBinding("ParseEventInfoOUI",f,{scope:this,when:function(){return g.Get("ReturnStartDate")&&(g.Get("ReturnStartDate")!=="")}});this.AttachPMBinding("ParseEventInfoOUI",b,{scope:this,when:function(){return g.Get("FirstLoad")}});this.AttachPMBinding("ParseEventInfoOUI",this.BindData);this.AttachPMBinding("ForceWindowResize",function(){if(g.Get("ForceWindowResize")===true){$(window).trigger("resize");g.SetProperty("ForceWindowResize",false)}});SiebelApp.EventManager.addListner("refreshview",this.resize,this);SiebelApp.EventManager.addListner("forceResize",this.resize,this)};function a(){var g=this.GetPM();$("#"+g.Get("GetFullId")).css("overflow-x","auto");this.SetDefaultView();this.SetCal($("#calendar_"+this.GetPM().Get("GetPlaceholder")));this.SetLocaleConverter(new SiebelAppFacade.CalLocaleConverter());this.SetUtilityMap(new SiebelAppFacade.CalUtility());this.SetCalCtrlBuilder(new SiebelAppFacade.CalCtrlBuilder(g,this.GetCal(),this.GetUtilityMap()));this.SetEventHandlerMap(new SiebelAppFacade.CalEventHandlers(g,this.GetCal(),this.GetCalCtrlBuilder(),this.GetUtilityMap()))}function f(){var g=this.GetPM();g.AddProperty("SelectedDate",new Date(g.Get("ReturnStartDate")));g.AddProperty("ReturnStartDate","")}function b(){var j=this.GetPM();var i=this.GetCal();var m=this.GetUtilityMap();var l;var h=j.Get("ViewMode");var g=j.Get("SelectedDate");if(g){l=moment(g);if(l.isAfter(i.fullCalendar("getDate"))||l.isBefore(i.fullCalendar("getDate"))){i.fullCalendar("gotoDate",g)}}if(h&&h!==m.ViewNameToMode(i.fullCalendar("getView").name)){var n=m.SplitViewName(i.fullCalendar("getView").name);i.find(".siebui-cal-btn-"+n).removeClass("disabled");i.find(".siebui-cal-btn-"+n+"-txt").removeClass("disabled");if(window.matchMedia("(max-width: 1199px)").matches&&$("#_FormParentRelatedItemsOuterCont").length>0){var k=i.fullCalendar("option","defaultView");j.AddProperty("ViewMode",m.ViewNameToMode(k));i.fullCalendar("changeView",k)}else{i.fullCalendar("changeView",m.ViewModeToName(h))}}}d.prototype.BindEvents=function(g){SiebelAppFacade.JQFullCalRenderer.superclass.BindEvents.call(this);var h=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(h){h.Manage($(window),"resize.JQFullCalRenderer",{ctx:this},function(i){if(i.target===window&&i.data.ctx.GetPM().Get("ForceWindowResize")===false){i.data.ctx.resize()}});h.Manage($("#openSidebarButton"),"click.JQFullCalRenderer",{ctx:this},function(i){i.data.ctx.resize()});h.Manage($("#sidebarCloseButton"),"click.JQFullCalRenderer",{ctx:this},function(i){i.data.ctx.resize()})}if(this.GetPM().Get("Enable External Drag And Drop")==="Y"){if(h){h.Manage(this.GetCal(),"dragover",function(i){i.preventDefault()});h.Manage(this.GetCal(),"drop",{ctx:this},this.GetEventHandlerMap().OnExtHTMLDropHandler)}}};function c(){var j=this.GetPM();var m=j.Get("Start Day of the Week");var h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var q=$.inArray(m,h);var n=[];var o=[j.Get("Sunday Workday Flag"),j.Get("Monday Workday Flag"),j.Get("Tuesday Workday Flag"),j.Get("Wednesday Workday Flag"),j.Get("Thursday Workday Flag"),j.Get("Friday Workday Flag"),j.Get("Saturday Workday Flag")];var g=[];if(typeof m==="undefined"||q===-1){q=parseInt(j.Get("First Day of Week"),10)}j.AddProperty("Week Day Number",q);var k=o.length;for(var l=0;l<k;l++){if(typeof o[l]==="undefined"){g=[q+5,q+6];break}else{if(o[l]!=="Y"&&o[l]!=="1"){g.push(l)}else{n.push(l)}}}j.AddProperty("Hidden Days",g);if(j.Get("Preferred Weekly Mode")!=="5 Day Weekly"){n=[0,1,2,3,4,5,6]}var p=n.indexOf(q);var r=[];for(var l=p;l<n.length;l++){r.push(n[l])}for(var l=0;l<p;l++){r.push(n[l])}j.AddProperty("Available Days",r)}d.prototype.GetOptions=function(){var i=this.GetPM();var h=this.GetEventHandlerMap();var j={left:"",center:"today prev title next",right:""};var k={allDaySlot:i.Get("Enable AllDay Slot")==="Y",allDayText:"",axisFormat:i.Get("24 Hour Flag")==="Y"?"H(:mm)":"h(:mm)a",buttonText:{today:i.Get("UISTR Today Button"),month:i.Get("UISTR Monthly Tab"),week:i.Get("UISTR Weekly Tab"),day:i.Get("UISTR Daily Tab"),prev:"",next:"",prevYear:"",nextYear:""},columnFormat:{month:"dddd",week:"dddd%MMM%DD",day:""},contentHeight:500,dayClick:function(){h.OnDayClick.apply(h,arguments)},dayNames:i.Get("WeekDayStringArray"),defaultView:this.GetUtilityMap().ViewModeToName(i.Get("ViewMode")),dragOpacity:0,dragScroll:false,droppable:i.Get("Enable External Drag And Drop")==="Y",drop:function(){var l=Array.prototype.slice.call(arguments,0);l.push(this);h.OnExtJQueryDropHandler.apply(h,l)},editable:i.Get("CanUpdate"),eventAfterRender:function(){h.OnEventAfterRender.apply(h,arguments)},eventClick:function(){h.OnEventClick.apply(h,arguments)},eventDestroy:function(){h.OnEventDestroy.apply(h,arguments)},eventDragStop:function(){h.OnEventDragStop.apply(h,arguments)},eventDrop:function(){h.OnEventDrop.apply(h,arguments)},eventDurationEditable:i.Get("CanUpdate"),eventRender:function(){h.OnEventRender.apply(h,arguments)},eventResize:function(){h.OnEventResize.apply(h,arguments)},events:function(){h.OnEventRefresh.apply(h,arguments)},firstDay:i.Get("Week Day Number"),scrollTime:moment.duration(i.Get("Preferred Business Day Start Time")),header:j,hiddenDays:{agendaDay:[],agendaWeek:(i.Get("Preferred Weekly Mode")!=="7 Day Weekly")?i.Get("Hidden Days"):[],month:[]},isRTL:i.Get("RTL Mode")==="Y",lazyFetching:false,longDateFormat:i.Get("Long Date Format"),monthNames:i.Get("MonthStringArray"),select:function(){h.OnCalSelect.apply(h,arguments)
},selectable:i.Get("CanInsert")&&(typeof(i.Get("Enable Quick Add"))==="undefined"||i.Get("Enable Quick Add").toLowerCase()!=="n"&&i.Get("Enable Quick Add").toLowerCase()!=="false"),selectHelper:i.Get("CanInsert")&&(typeof(i.Get("Enable Quick Add"))==="undefined"||i.Get("Enable Quick Add").toLowerCase()!=="n"&&i.Get("Enable Quick Add").toLowerCase()!=="false"),slotEventOverlap:false,slotDuration:moment.duration(parseInt(i.Get("Preferred Timeslot Interval"),10),"m"),timeFormat:{agenda:"","":"h(:mm)t"},titleFormat:{month:"MMMM YYYY",week:"",day:i.Get("Long Date Format")},viewRender:function(){h.OnViewDisplayChange.apply(h,arguments)},weekends:true,fixedWeekCount:false,eventLimit:{month:4,"default":false},eventLimitClick:function(){return h.OnEventLimitClick.apply(h,arguments)},eventLimitText:"..."};var g=this.GetLocaleConverter().ConvertLocale(k);k=$.extend(true,{},k,g);return k};d.prototype.ShowUI=function(){SiebelAppFacade.JQFullCalRenderer.superclass.ShowUI.call(this);var g=this.GetPM();a.call(this);c.call(this);var h=this.GetOptions();g.AddProperty("ShortMonthNames",h.monthNamesShort);g.AddProperty("ShortDayNames",h.dayNamesShort);this.GetCal().fullCalendar(h);e.call(this)};function e(){var h=this.GetPM();var g=this.GetCal();var i=g.fullCalendar("getView");var j=this.GetUtilityMap().SplitViewName(i.name);this.GetCalCtrlBuilder().AddControls();g.find(".siebui-cal-btn-"+j).addClass("disabled");g.find(".siebui-cal-btn-"+j+"-txt").addClass("disabled");if(i.name!=="month"){this.GetCalCtrlBuilder().AddMouseControls()}h.AddProperty("MultViewFrames",$("#_swecontent").find("[id^='_svf']").filter(function(){return this.clientHeight!==0}).length);this.resize();h.SetProperty("FirstLoad",false)}d.prototype.resize=function(){if(SiebelApp.Utils.IsEmpty(this.GetPM())){return}var i=this.GetPM();var h=this.GetCal();var j;$(".siebui-applet").each(function(){if($(this).find(".fc-view-container").length===0){$(this).removeClass("hide")}});$("#_FormParentRelatedItemsOuterCont").removeClass("hide");$("#"+i.Get("GetFullId")).width(0).width("auto");$("#s_"+i.Get("GetFullId")+"_div").width(0).width("auto");j=Math.max(h.find(".fc-toolbar").width(),$("#s_"+i.Get("GetFullId")+"_div").width(),h.find(".fc-agenda-view").width(),h.find(".siebui-short-hdr").width());if(j!==$("#s_"+i.Get("GetFullId")+"_div").width()){if(j===h.find(".fc-agenda-view").width()&&i.Get("FirstLoad")){$("#s_"+i.Get("GetFullId")+"_div").width(j+200);h.fullCalendar("render")}else{$("#s_"+i.Get("GetFullId")+"_div").width(j)}}if((i.Get("ViewMode")==="1"||i.Get("ViewMode")==="2")&&window.matchMedia("(max-width: 1199px)").matches&&!i.Get("FirstLoad")){$(".siebui-applet").each(function(){if($(this).find(".fc-view-container").length===0){$(this).addClass("hide")}});$("#_FormParentRelatedItemsOuterCont").addClass("hide");$("#"+i.Get("GetFullId")).width(0);j=Math.max($("#_sweview").width(),h.find(".fc-toolbar").width());$("#"+i.Get("GetFullId")).width(j);$("#s_"+i.Get("GetFullId")+"_div").width("auto");if(j===h.find(".fc-toolbar").width()){$("#s_"+i.Get("GetFullId")+"_div").width(j)}if(i.Get("ViewMode")==="1"){this.GetCalCtrlBuilder().BldWeekColHdr(h.fullCalendar("getView"))}h.fullCalendar("option","contentHeight",h.fullCalendar("option","contentHeight"))}if(i.Get("MultViewFrames")===1){if($(window).height()!==i.Get("WindowHeight")||$(window).width()!==i.Get("WindowWidth")){i.AddProperty("WindowHeight",$(window).height());i.AddProperty("WindowWidth",$(window).width());var k=($("#_swescrnbar").width()>=$("#_sweclient").width()*0.9)?$("#_swescrnbar").outerHeight(true):0;var g=($("#_sweclient").outerHeight(true)-$("#_sweappmenu").outerHeight(true)-$("#_swethreadbar").outerHeight(true)-k)*0.9;g-=h.find(".fc-center").outerHeight(true);g-=h.find(".siebui-short-hdr").outerHeight(true);g-=h.outerHeight(true);g+=h.height();h.fullCalendar("option","contentHeight",Math.max(100,Math.min(g,500)))}}this.GetCalCtrlBuilder().BldSlotIndicators(h.fullCalendar("getView"));if($(".siebui-cal-popup").length>0){$(".siebui-cal-popup").position({my:"center",at:"center",of:$(window)})}};d.prototype.EndLife=function(){$(window).unbind("resize.JQFullCalRenderer");$("#openSidebarButton").unbind("click.JQFullCalRenderer");$("#sidebarCloseButton").unbind("click.JQFullCalRenderer");$(".siebui-tooltip-calendar").remove();SiebelApp.EventManager.removeListner("refreshview",this.resize,this);this.GetCal().fullCalendar("destroy");this.SetCal(null);this.SetLocaleConverter(null);this.SetUtilityMap(null);this.SetCalCtrlBuilder(null);this.SetEventHandlerMap(null);$(document).unbind("mouseup.JQFullCalRenderer");SiebelAppFacade.JQFullCalRenderer.superclass.EndLife.call(this)};d.prototype.BindData=function(){var h=[];var H=this.GetPM();var D=[];var r=[];var A=this.GetCal();var I=this.GetUtilityMap();var F,C,B;if(this.inProgress){return[]}var v=H.Get("GetRecordSet");var l=H.Get("EventInfo");if(this.GetCal()&&l){var G=l.length;for(F=0;F<G;F++){var u=l[F];var E=[];var w=[];var q=[];var o;var x;u.Planned=moment(u.Planned,"MM-DD-YYYY HH:mm:ss");u.PlannedCompletion=moment(u.PlannedCompletion,"MM-DD-YYYY HH:mm:ss");var m=u.DisplayField.length;for(C=0;C<m;C++){x=u.DisplayField[C];if((x.Name!=="Readonly"||!H.Get("CanUpdate"))&&(x.FieldValue===""&&x.IconFile!=="")){E.push(x.IconFile);w.push(x.ToolTip)}if(x.FieldValue===""){continue}o=parseInt(x.Sequence,10);q[o]=C}var t=[];var J;var n=q.length;for(B=1;B<n;B++){J=[];x=u.DisplayField[q[B]];J.FieldValue=x.FieldValue;J.ToolTip=x.ToolTip;J.DrillDown=x.DrillDown;J.FieldColor=x.FieldColor;J.CSSName=(this.GetUtilityMap().IsAllDayEvent(u))?"calendar-DisplayField-AllDayEventFont":"calendar-DisplayField-Font"+B.toString();t.push(J)}var z=u.EventStyle.replace(/\s/g,"");if(typeof u.EventStyle!=="undefined"){if($.inArray(u.EventLegend,D)<0){D.push(u.EventLegend)}if(typeof r[u.EventLegend]==="undefined"){r[u.EventLegend]=z}}var s=this.GetUtilityMap().IsAllDayEvent(u);if(u.Planned.isSame(u.PlannedCompletion)){var y=parseInt(H.Get("Preferred Timeslot Interval"),10);u.PlannedCompletion.add(y,"m");if((u.AllowAllDay!=="Y"&&u.AllowAllDay!=="T"&&u.AllowAllDay!=="1")||u.AllowAllDay===typeof"undefined"){s=false}}if(q.length===0||!q[1]){if(u.DisplayField.length===0){continue}else{q[1]=0}}h.push({id:u.Id,title:"",start:u.Planned,end:u.PlannedCompletion,multiDisplay:t,displayFieldOne:u.DisplayField[q[1]].FieldValue,dataDrilldown:u.DisplayField[q[1]].DrillDown,url:"javascript:void(0)",repeating:u.Repeating,calendarId:u.CalendarId,readOnly:u.ReadOnly,icons:E,iconText:w,className:"fc-event-skin calendar-EventStyle-"+z,allDay:s,editable:H.Get("CanUpdate")})}}A.fullCalendar("removeEvents");A.fullCalendar("addEventSource",h);if(H.Get("DelayRenderUpdate")){H.AddProperty("DelayRenderUpdate",false);A.fullCalendar("refetchEvents")}if(H.Get("Enable BusyFreeTime")==="Y"){var g=H.ExecuteMethod("CalcBusyHrsAndAllDay",h);H.AddProperty("BusyHours",g[0]);H.AddProperty("AllDays",g[1]);this.GetCalCtrlBuilder().RenderBusyFreeTime()}H.AddProperty("CSSLegendsLDC",D);H.AddProperty("CSSLegendsLIC",r);
this.GetCalCtrlBuilder().AddColorCodedLegends(A.find(".siebui-cal-hdr-wrapper"));var p=A.find(".siebui-cal-btn-today").children("span");I.AttachAutoAttributes($(p).children(".fc-button-content"),"Button","today");p=A.find(".siebui-cal-btn-prev").children("span");I.AttachAutoAttributes($(p).children(".fc-button-content"),"Button","prev");I.AttachAutoAttributes($(p),"Button","prev");p=A.find(".siebui-cal-btn-next").children("span");I.AttachAutoAttributes($(p).children(".fc-button-content"),"Button","next");I.AttachAutoAttributes($(p),"Button","next")};return d}());SiebelAppFacade.CalCtrlEventHandlers=(function(){function a(d,c,e,g){var b=d;var i=c;var f=e;var h=g;this.GetPM=function(){return b};this.GetCal=function(){return i};this.GetCalCtrlBuilder=function(){return f};this.GetUtilityMap=function(){return h}}a.prototype={OnCancelClick:function(b){$("#"+b).dialog("close")},OnDatepickerSelect:function(e){var c=this.GetCal();var b=this.GetPM();var d=$("#"+e).datepicker("getDate");b.AddProperty("SelectedDate",d);c.fullCalendar("gotoDate",d);if(c.find(".fc-toolbar").width()>$("#s_"+b.Get("GetFullId")+"_div").width()){$("#s_"+b.Get("GetFullId")+"_div").width(c.find(".fc-toolbar").width())}},OnHomePageViewBtnClick:function(e){var d=this.GetPM();var b=CCFMiscUtil_CreatePropSet();SiebelApp.S_App.uiStatus.Busy({target:SiebelApp.S_App.GetTargetViewContainer(),mask:true});var c={async:true,cb:function(){SiebelApp.S_App.uiStatus.Free()}};b.SetProperty("SelectedDay",this.GetCal().fullCalendar("getDate").format("MM/DD/YYYY"));switch(e){case"month":d.ExecuteMethod("InvokeMethod","GoToMonthly",b,c);break;case"agendaWeek":d.ExecuteMethod("InvokeMethod","GotoWeekly",b,c);break;case"agendaDay":d.ExecuteMethod("InvokeMethod","GotoToday",b,c);break;default:break}},OnQuickAddDialogOkClick:function(f,e,c){var d=this.GetPM();var b=$("input:text[name=eventDescription]").val();if($.trim(b)===""){b="";d.OnControlEvent("newEvent",b,e,c,null)}else{d.OnControlEvent("newEvent",b,e,c,null);this.GetCal().fullCalendar("refetchEvents")}$("#"+f).dialog("close")},OnRepeatDialogOkClick:function(h,e,b,d,c){var f=CCFMiscUtil_CreatePropSet();var g=$("input:radio[name=userchoice]:checked").val();if(g!=="SaveThisOne"&&g!=="SaveAll"){d();$("#"+h).dialog("close")}else{f.SetProperty("Repeating","Y");if(g==="SaveThisOne"){f.SetProperty("Modify","ThisOne")}else{f.SetProperty("Modify","AllFuture")}this.GetPM().OnControlEvent(b,e.start.format("MM/DD/YYYY HH:mm:ss"),e.end.format("MM/DD/YYYY HH:mm:ss"),e.calendarId,f);c();$("#"+h).dialog("close")}},OnSettingsDialogOkClick:function(f){var d=this.GetPM();var c=false;var b={async:true,cb:function(){SiebelApp.S_App.uiStatus.Free()}};if(d.Get("Enable Timezone Picker")==="Y"){if(d.Get("Timezone")!==$("#tzCombo").val()){d.AddProperty("Timezone",$("#tzCombo").val());c=true}}var e=$("#ownerCombo").val();if(d.Get("Enable Owner Picker")==="Y"){if(d.Get("Owner")!==e){if(e==="ALLEMPLOYEES"){SiebelApp.S_App.uiStatus.Busy({target:SiebelApp.S_App.GetTargetViewContainer(),mask:true});d.ExecuteMethod("InvokeMethod","GoToEmployeeCalView",CCFMiscUtil_CreatePropSet(),b)}else{d.AddProperty("Owner",e);d.ExecuteMethod("UpdateUserPermission");if((e===d.Get("User Login Name"))&&(d.Get("FromExternalCalendar")==="Y")){SiebelApp.S_App.uiStatus.Busy({target:SiebelApp.S_App.GetTargetViewContainer(),mask:true});d.ExecuteMethod("InvokeMethod","GoToExternalCalView",d.ExecuteMethod("PopulatePropSet"),b)}}c=true}}if(c&&e!=="ALLEMPLOYEES"){d.AddProperty("DelayRenderUpdate",true);d.ExecuteMethod("GetCalendarData")}$("#"+f).dialog("close")},OnViewBtnClick:function(f){var c=this.GetCal();var b=this.GetPM();var e=this.GetUtilityMap();var g=e.SplitViewName(c.fullCalendar("getView").name);var d;c.find(".siebui-cal-btn-"+g).removeClass("disabled");c.find(".siebui-cal-btn-"+g+"-txt").removeClass("disabled");b.AddProperty("ViewMode",e.ViewNameToMode(f));c.fullCalendar("removeEvents");if(f==="agendaDay"){$(".siebui-applet").each(function(){if($(this).find(".fc-view-container").length===0){$(this).removeClass("hide")}});$("#_FormParentRelatedItemsOuterCont").removeClass("hide");$("#"+b.Get("GetFullId")).width(0);$("#"+b.Get("GetFullId")).width("auto");$("#s_"+b.Get("GetFullId")+"_div").width(0);$("#s_"+b.Get("GetFullId")+"_div").width("auto");d=Math.max(c.find(".fc-toolbar").width(),$("#s_"+b.Get("GetFullId")+"_div").width(),c.find(".siebui-short-hdr").width());if(d!==$("#s_"+b.Get("GetFullId")+"_div").width()){$("#s_"+b.Get("GetFullId")+"_div").width(d)}b.SetProperty("ForceWindowResize",true)}else{if(f!=="agendaDay"&&window.matchMedia("(max-width: 1199px)").matches){$(".siebui-applet").each(function(){if($(this).find(".fc-view-container").length===0){$(this).addClass("hide")}});$("#_FormParentRelatedItemsOuterCont").addClass("hide");$("#"+b.Get("GetFullId")).width(0);d=Math.max($("#_sweview").width(),c.find(".fc-toolbar").width());$("#"+b.Get("GetFullId")).width(d);$("#s_"+b.Get("GetFullId")+"_div").width(0);$("#s_"+b.Get("GetFullId")+"_div").width("auto");if(d===c.find(".fc-toolbar").width()){$("#s_"+b.Get("GetFullId")+"_div").width(d)}}}c.fullCalendar("changeView",f);$(document).unbind("mouseup.JQFullCalRenderer");if(f!=="month"){this.GetCalCtrlBuilder().AddMouseControls()}},OnNavBtnClick:function(i){var f=this.GetPM();var e=this.GetCal();var b=e.fullCalendar("getView");var h=e.fullCalendar("getDate");if(i==="next"){if(b.name==="agendaWeek"){h.add(7,"d")}else{if(b.name==="agendaDay"){h.add(1,"d")}else{h.add(1,"month")}}}else{if(i==="prev"){if(b.name==="agendaWeek"){h.subtract(7,"d")}else{if(b.name==="agendaDay"){h.subtract(1,"d")}else{h.subtract(1,"month")}}}}var d=h.toDate();var g=moment().format("YYYY-MM-DD");var c=$.fullCalendar.moment(g);if(i==="today"){d=c.toDate()}if(c.isBefore(b.start)||!c.isBefore(b.end)||i!=="today"){e.fullCalendar("removeEvents")}e.fullCalendar("gotoDate",d);$("#"+f.Get("GetFullId")).find("#caldate_picker").datepicker("setDate",d);if(e.find(".fc-toolbar").width()>$("#s_"+f.Get("GetFullId")+"_div").width()){$("#s_"+f.Get("GetFullId")+"_div").width(e.find(".fc-toolbar").width())}},OnPrintCalendar:function(){var f=this.GetPM();var k=this.GetCal();var j=$("#s_"+f.Get("GetFullId")+"_div");var h=k.find(".fc-scroller");var e=$("#_sweview");var d=$(".siebui-applet");var c=$("div[class^=siebui-span-]");var l=$(".siebui-view-multi-column");var p=0,b=0;var m=0;var g=f.Get("ViewMode");var i=f.ExecuteMethod("GetSlotInfo");var n=k.fullCalendar("option","contentHeight");if(g==="2"){b=k.find(".fc-toolbar").height()+k.find(".fc-day-grid").height()+k.find(".fc-month-view .fc-row").height()}else{p=Math.max(k.find(".fc-slats tr").height(),21);b=p*(i.totalSlots+1)+k.find(".fc-toolbar").height()+k.find(".fc-day-grid").height()+k.find(".fc-agenda-view .fc-row").height();m=h.scrollTop()}d.each(function(){if($(this).find(".fc-view-container").length===0){$(this).addClass("hide")}});$("#_FormParentRelatedItemsOuterCont").addClass("hide");c.each(function(){$(this).addClass("siebui-print-static")});l.addClass("siebui-print-dbl-width");
j.addClass("siebui-cal-print");k.fullCalendar("refetchEvents");k.fullCalendar("option","contentHeight",b);l.addClass("siebui-noscroll");e.addClass("siebui-noscroll");h.addClass("siebui-noscroll");if(navigator.appName!=="Microsoft Internet Explorer"){window.print()}else{var o=(g==="2")?"span":"div";j.find(o+".fc-title").each(function(){$(this).data("originalText",$(this).text());var q=$(this).text();$(this).text(q);$(this).find("a").addClass("siebui-no-display")});window.print();j.find(o+".fc-title").each(function(){var q=$(this).data("originalText");$(this).text(q);$(this).find("a").removeClass("siebui-no-display")})}d.each(function(){if($(this).find(".fc-view-container").length===0){$(this).removeClass("hide")}});$("#_FormParentRelatedItemsOuterCont").removeClass("hide");c.each(function(){$(this).removeClass("siebui-print-static")});l.removeClass("siebui-print-dbl-width");l.removeClass("siebui-noscroll");e.removeClass("siebui-noscroll");h.removeClass("siebui-noscroll");j.removeClass("siebui-cal-print");k.fullCalendar("render");k.fullCalendar("option","contentHeight",n);if(g==="0"||g==="1"){h.scrollTop(m)}this.GetCalCtrlBuilder().BldSlotIndicators(k.fullCalendar("getView"))},OnWeekHdrAddClick:function(i){var f=this.GetPM();var d=moment($(i.target).attr("data-date"));var j;var h=moment();var c=h.minute();var g=parseInt(f.Get("Preferred Timeslot Interval"),10);var b=parseInt(f.Get("Preferred Duration"),10);f.AddProperty("SelectedDate",d.toDate());d.hours(h.hour()+Math.floor((c+g)/60));d.minutes(((Math.floor(c/g)+1)*g)%60);d.seconds(0);j=moment(d);j.add(b,"m");f.OnControlEvent("newEvent","",d,j,null)},OnWeekHdrClick:function(d){var b=this.GetPM();var c;if($(d.target).attr("data-date")){c=moment($(d.target).attr("data-date"))}else{c=moment($(d.target.parentElement).attr("data-date"))}b.AddProperty("SelectedDate",c.toDate())}};return a}());SiebelAppFacade.CalCtrlBuilder=(function(){function e(h,g,j){var l=g;var f=h;var k=j;var i=new SiebelAppFacade.CalCtrlEventHandlers(h,g,this,j);this.GetCal=function(){return l};this.GetPM=function(){return f};this.GetCalCtrlEventHandlers=function(){return i};this.GetUtilityMap=function(){return k}}e.prototype.AddColorCodedLegends=function(o){var h=this.GetPM();var q=this.GetCal();var j=h.Get("CSSLegendsLDC")||[];var p=h.Get("CSSLegendsLIC")||[];if(q.find("#siebui-cal-legend-row")){q.find("#siebui-cal-legend-row").remove()}var k=$("<div id='siebui-cal-legend-row' class='siebui-cal-legend-row'></div>");k.appendTo(o);j.sort();for(var l=0;l<j.length;l++){var f=j[l]!==""?p[j[l]]:"undefined";var r=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_PLAINTEXT"),className:"siebui-legend-square",id:"color_square_"+f,attrs:"title=''",value:"&#9632"});var m=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_PLAINTEXT"),className:"siebui-legend-text",id:"legend_"+f,value:j[l]!==""?j[l]:"undefined"});var n=$(r+m);q.find("#siebui-cal-legend-row").append(n);var g=$(".calendar-EventStyle-"+f).css("background-color");if(!g){q.find("#color_square_"+f).remove();q.find("#legend_"+f).remove()}}};e.prototype.AddControls=function(){var w=this.GetPM();var D=this.GetCal();var T=this;var z=this.GetCalCtrlEventHandlers();var v=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");var ak=w.Get("Home Page Mode");var ao=this.GetUtilityMap();var L=$(".fc-center").width();var P=[];var G=[];var aa=[];var q=[];var af,ad,ab;if(w.Get("CanInsert")){if(w.Get("Enable New Contact Call Button")==="Y"){var N=w.Get("UISTR Contact Call")||"Contact Call";P.push(this.BldCustomHdrBtn(w.Get("UISTR Contact Call Button"),N,"newContactCall","",function(){w.OnControlEvent("newLSCall","Contact")}))}if(w.Get("Enable New Account Call Button")==="Y"){var ac=w.Get("UISTR Account Call")||"Account Call";P.push(this.BldCustomHdrBtn(w.Get("UISTR Account Call Button"),ac,"newAccountCall","",function(){w.OnControlEvent("newLSCall","Account")}))}if(w.Get("Enable New Meeting Button")==="Y"){var S=w.Get("UISTR Meeting")||"Meeting";P.push(this.BldCustomHdrBtn(w.Get("UISTR New Meeting Button"),S,"newMeetingCall","",function(){w.OnControlEvent("newLSCall","Meeting")}))}if(w.Get("Enable New Button")==="Y"){var am=w.Get("UISTR New Record")||"New Record";var p=function(){var aq,av;var au=D.fullCalendar("getView");var i=au.name;aq=D.fullCalendar("getDate");if(i==="agendaWeek"&&w.Get("Preferred Weekly Mode")!=="7 Day Weekly"){if($.inArray(aq.day()%7,w.Get("Hidden Days"))!==-1){aq=au.start}}var at=moment();var k=at.minute();var ar=parseInt(w.Get("Preferred Timeslot Interval"),10);var j=parseInt(w.Get("Preferred Duration"),10);aq.hours(at.hour()+Math.floor((k+ar)/60));aq.minutes(((Math.floor(k/ar)+1)*ar)%60);aq.seconds(0);av=moment(aq);av.add(j,"m");w.OnControlEvent("newEvent","",aq,av,null)};G.push(this.BldStdHdrBtn("",am,"newEvent","siebui-icon-add",p));q.push(this.BldStdHdrBtn("",am,"newEvent","siebui-icon-add",p))}}if(w.Get("Enable Print Button")==="Y"){var Q=w.Get("UISTR Print")||"Print";G.push(this.BldStdHdrBtn("",Q,"printCalendar","siebui-icon-print",function(){z.OnPrintCalendar()}))}if(w.Get("Enable Daily")==="Y"){var H=w.Get("UISTR Switch to daily view")||"Switch to daily view";var ap;if(ak){ap=function(){z.OnHomePageViewBtnClick("agendaDay")}}else{ap=function(){z.OnViewBtnClick("agendaDay")}}aa.push(this.BldStdHdrBtn("",H,ao.SplitViewName("agendaDay"),"siebui-icon-cal-daily",ap));var al=this.BldStdHdrBtn(w.Get("UISTR Daily Tab"),H,ao.SplitViewName("agendaDay")+"-txt","",ap);q.push(al);aa.push(al.clone(true,true))}if(w.Get("Enable Weekly")==="Y"){var M=w.Get("UISTR Switch to week view")||"Switch to week view";var an;if(ak){an=function(){z.OnHomePageViewBtnClick("agendaWeek")}}else{an=function(){z.OnViewBtnClick("agendaWeek")}}aa.push(this.BldStdHdrBtn("",M,ao.SplitViewName("agendaWeek"),"siebui-icon-cal-weekly",an));var A=this.BldStdHdrBtn(w.Get("UISTR Weekly Tab"),M,ao.SplitViewName("agendaWeek")+"-txt","",an);q.push(A);aa.push(A.clone(true,true))}if(w.Get("Enable Monthly")==="Y"){var X=w.Get("UISTR Switch to month view")||"Switch to month view";var l;if(ak){l=function(){z.OnHomePageViewBtnClick("month")}}else{l=function(){z.OnViewBtnClick("month")}}aa.push(this.BldStdHdrBtn("",X,ao.SplitViewName("month"),"siebui-icon-cal-monthly",l));var y=this.BldStdHdrBtn(w.Get("UISTR Monthly Tab"),X,ao.SplitViewName("month")+"-txt","",l);q.push(y);aa.push(y.clone(true,true))}if((w.Get("Enable Timezone Picker")==="Y"||w.Get("Enable Owner Picker")==="Y")&&(!ak||ak!=="Y")){var C=w.Get("UISTR Advanced Calendar Settings")||"Advanced Calendar Settings";aa.push(this.BldStdHdrBtn("",C,"settings","siebui-icon-settings",function(){T.BuildSettingsDialog()}))}var ag=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_PLAINTEXT"),className:"fc-header-space"});var V=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-hdr-wrapper siebui-cal-"+ao.SplitViewName(D.fullCalendar("getView").name)+"-hdr",id:"siebui-cal-hdr-wrapper-"+this.GetPM().Get("GetPlaceholder"),type:consts.get("SWE_CTRL_PLAINTEXT")}));
var E=$("<div class='siebui-short-hdr siebui-btn-group-justified' id='siebui-short-hdr-"+this.GetPM().Get("GetPlaceholder")+"'/>");D.prepend(E);D.prepend(V);D.find(".fc-toolbar").appendTo(V);V.find("h2").addClass("fc-header-title");var O=V.find(".fc-center");var t=V.find(".fc-right");var ah=O.clone(true,true);var g=t.clone(true,true);O.replaceWith(g);t.replaceWith(ah);var B=$("<div class='siebui-hdr-right'></div>");var h=$("<div class='siebui-hdr-left'></div>");D.find(".fc-right").append(B);D.find(".fc-left").append(h);V.find(".fc-clear").remove();var r=$("<div id='siebui-cal-button-row-2'><div id='cal-custom-buttons'></div></div>");if(P.length===0){r.addClass("siebui-cal-custombutton-row-empty")}else{r.addClass("siebui-cal-custombutton-row")}V.append(r);var ai=r.find("#cal-custom-buttons");var aj=D.find(".siebui-hdr-left");var ae=D.find(".siebui-hdr-right");var m="caldate_picker";var Z=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_TEXT"),id:m});var F=D.find(".fc-today-button");var u=(w.Get("RTL Mode")!=="Y")?D.find(".fc-prev-button"):D.find(".fc-next-button");var I=(w.Get("RTL Mode")!=="Y")?D.find(".fc-next-button"):D.find(".fc-prev-button");var R={};var U={};if(F.length>0){R=F.parent();U=F.prev();D.find(".fc-today-button").remove();if(w.Get("Enable Today Button")==="Y"){var f=w.Get("UISTR Go to Today")||"Go to Today";F=this.BldStdHdrBtn(w.Get("UISTR Today Button"),f,"today","",function(){z.OnNavBtnClick("today")});if(U[0]){U.after(F)}else{R.prepend(F)}var o=D.fullCalendar("getView");var s=moment().format("YYYY-MM-DD");var x=$.fullCalendar.moment(s);if(!x.isBefore(o.start)&&x.isBefore(o.end)){F.addClass("disabled")}else{F.removeClass("disabled")}q.push(F.clone(true,true))}}if(u.length>0){var J=(w.Get("RTL Mode")!=="Y")?w.Get("UISTR Previous Day")||"Previous Day":w.Get("UISTR Next Day")||"Next Day";R=u.parent();U=u.prev();u=this.BldStdHdrBtn("",J,"prev","siebui-icon-arrowsm-left",function(){z.OnNavBtnClick(w.Get("RTL Mode")!=="Y"?"prev":"next")});if(w.Get("RTL Mode")!=="Y"){D.find(".fc-prev-button").remove()}else{D.find(".fc-next-button").remove()}if(U[0]){U.after(u)}else{R.prepend(u)}}if(I.length>0){var Y=(w.Get("RTL Mode")!=="Y")?w.Get("UISTR Next Day")||"Next Day":w.Get("UISTR Previous Day")||"Previous Day";R=I.parent();U=I.prev();I=this.BldStdHdrBtn("",Y,"next","siebui-icon-arrowsm-right",function(){z.OnNavBtnClick(w.Get("RTL Mode")!=="Y"?"next":"prev")});if(w.Get("RTL Mode")!=="Y"){D.find(".fc-next-button").remove()}else{D.find(".fc-prev-button").remove()}if(U[0]){U.after(I)}else{R.prepend(I)}}var n="";if(w.Get("Enable Date Picker")==="Y"){n=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_PLAINTEXT"),className:"btn-icon siebui-icon-calendar siebui-cal-btn-datepicker",id:"cal-datepicker-button",value:Z})}for(af=0;af<G.length;af++){aj.append(ag);aj.append(G[af])}for(ad=0;ad<aa.length;ad++){ae.append(ag);ae.append(aa[ad])}for(ab=0;ab<P.length;ab++){ai.append(ag);ai.append(P[ab])}D.find(".fc-center").append(ag+n+ag);for(ad=0;ad<q.length;ad++){var K=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-short-hdr-elm",type:consts.get("SWE_CTRL_PLAINTEXT")}));K.append(q[ad]);E.append(K)}var W=w.Get("UISTR Date Picker Icon")||"images/calPicker_icon.gif";if(w.Get("Enable Date Picker")==="Y"){a.call(this,m,W,function(){z.OnDatepickerSelect.call(z,m)})}if(v){v.Manage(D.find(".fc-header-title"),["click","tap"],function(){D.find("#"+m).datepicker("show")});v.Manage(D.find(".siebui-cal-btn-datepicker.siebui-icon-calendar"),["click","tap"],function(){D.find("#"+m).datepicker("show")})}};e.prototype.AddMouseControls=function(){var g=this.GetPM();var f=false;var h=false;var j=$("#"+g.Get("GetFullId")+" .fc-widget-content");var i=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(i){i.Manage(j,"mousedown",function(){f=true;h=false});i.Manage(j,"mousemove",function(){if(f===true){h=true}});i.Manage($(document),"mouseup.JQFullCalRenderer",function(){if(f===true){f=false;g.AddProperty("MouseDrag",h)}else{}})}};e.prototype.BuildQuickAddDialog=function(f,i){var h=this.GetPM();var s=this.GetCalCtrlEventHandlers();var l=this.GetCal();var n=this.GetUtilityMap();var r=CCFMiscUtil_CreatePropSet();if(typeof(h.Get("Enable Quick Add"))==="undefined"||h.Get("Enable Quick Add").toLowerCase()!=="n"&&h.Get("Enable Quick Add").toLowerCase()!=="false"){var m=h.Get("UISTR Tooltip Field Label:Description")||"Description";var g=h.Get("UISTR Repeating Dialog OK Button")||"OK";var k=h.Get("UISTR Repeating Dialog Cancel Button")||"Cancel";var q=h.Get("UISTR New Event")||"New Event";var p=c.call(this,"QuickAddDialog");var o={};o[g]=function(){s.OnQuickAddDialogOkClick("quickAddDialog",f,i)};o[k]=function(){s.OnCancelClick("quickAddDialog")};var j=d.call(this,"quickAddDialog",p,q,o);$("#quickAddDialog").addClass("siebui-cal-quick-add-dialog");j.dialog("option","open",function(t){var u=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(u){u.Manage($("#quickAddDialog"),"keypress",function(v){if(v.keyCode===$.ui.keyCode.ENTER){$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click")}})}});n.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===g}),"Button","QuickAddOK");n.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===k}),"Button","QuickAddCancel");j.dialog("open")}};e.prototype.BuildRepeatDialog=function(f,g,l,s){var i=this.GetPM();var r=this.GetCalCtrlEventHandlers();var q=CCFMiscUtil_CreatePropSet();var m=this.GetUtilityMap();var p=c.call(this,"RepeatDialog");var h=i.Get("UISTR Repeating Dialog OK Button")||"OK";var k=i.Get("UISTR Repeating Dialog Cancel Button")||"Cancel";var o=i.Get("UISTR Repeating Event Dialog")||"Repeating Event Dialog";var n={};n[h]=function(){r.OnRepeatDialogOkClick("repeatDialog",f,g,l,s)};n[k]=function(){l();r.OnCancelClick("repeatDialog")};var j=d.call(this,"repeatDialog",p,o,n);$("#repeatDialog").addClass("siebui-cal-repeat-dialog");j.dialog("option","close",function(t,u){if(t.originalEvent&&$(t.originalEvent.target).closest(".ui-dialog-titlebar-close").length!==0){l()}$("#repeatDialog").remove()});m.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===h}),"Button","RepeatOK");m.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===k}),"Button","RepeatCancel");j.dialog("open")};e.prototype.BuildSettingsDialog=function(){var i=this.GetPM();var q=this.GetCalCtrlEventHandlers();var m=this.GetUtilityMap();var h=i.Get("UISTR Repeating Dialog OK Button")||"OK";var k=i.Get("UISTR Repeating Dialog Cancel Button")||"Cancel";var p=i.Get("UISTR Settings")||"Settings";var n=c.call(this,"SettingsDialog");var o={};o[h]=function(){q.OnSettingsDialogOkClick("calSettingsDialog")};o[k]=function(){q.OnCancelClick("calSettingsDialog")};var g=d.call(this,"calSettingsDialog",n,p,o);
$("#calSettingsDialog").addClass("siebui-cal-settings-dialog");m.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===h}),"Button","SettingsOK");m.AttachAutoAttributes($(".ui-dialog-buttonpane").find("button").filter(function(){return $(this).text()===k}),"Button","SettingsCancel");g.dialog("open");var l=i.Get("Timezone");if(i.Get("Enable Timezone Picker")==="Y"){if(typeof l==="undefined"){var j=i.Get("Default Timezone")||"(GMT-08:00) Pacific Time (US & Canada)";i.AddProperty("Timezone",j);l=j}$("#tzCombo").val(l)}var f=i.Get("Owner");if(i.Get("Enable Owner Picker")==="Y"){$("#ownerCombo").val(f)}};e.prototype.BldStdHdrBtn=function(h,g,f,k,j){var i="btn-icon siebui-cal-btn-"+f+" "+k;return b(h,g,i,"cal-"+f+"-button",consts.get("SWE_PST_BUTTON_CTRL"),j)};e.prototype.BldCustomHdrBtn=function(h,g,f,k,j){var i="siebui-ctrl-btn siebui-cal-btn-"+f+" "+k;return b(h,g,i,"cal-"+f+"-button",consts.get("SWE_CTRL_PLAINTEXT"),j)};e.prototype.BldSlotIndicators=function(x){var H=this.GetPM();var C=this.GetCal();var q=H.Get("RTL Mode")==="Y";var G=H.Get("Hidden Days");var n=(x.name==="agendaDay")?1:7;var o=(x.name==="agendaDay")?1:((H.Get("Preferred Weekly Mode")==="7 Day Weekly")?7:7-G.length);var v;var I=this.GetUtilityMap();var k=moment();var z,N,u,m;var p=H.ExecuteMethod("GetSlotInfo");var s;var l,g,h,J;var M,y;var O;var F=q?o-1:0;if(x.name==="month"){return}C.find(".siebui-cal-start-row").remove();C.find(".siebui-cal-end-row").remove();C.find("th").removeClass("calendar-WorkingHr-"+x.name).removeClass("calendar-NonWorkingHr-"+x.name);C.find("div").removeClass("calendar-WorkingHr-"+x.name).removeClass("calendar-NonWorkingHr-"+x.name);for(var t=0;t<n;t++){var P=moment(x.start.format("YYYY-MM-DD"));P.add(t,"d");z=P.isBefore(k,"d");N=P.isAfter(k,"d");u=(!z&&!N);m=($.inArray((x.start.day()+t)%7,G)===-1);if(x.name==="agendaWeek"&&H.Get("Preferred Weekly Mode")!=="7 Day Weekly"&&!m){continue}s=(u?Math.floor((k.hour()+k.minute()/60)*p.slotsPerHr):p.startWorkHrSlot);for(var E=0;E<p.totalSlots;E++){var A=moment.duration((E*parseInt(H.Get("Preferred Timeslot Interval"),10)),"m");var j=moment({hour:A.hours(),minute:A.minutes()}).format("HH:mm");if(x.name==="agendaDay"){h=C.find(".fc-slats tr").eq(E);l=h.find(".fc-widget-content");g=h.find(".fc-axis");I.AttachAutoAttributes(l,"CalendarSlot","slotCol-0-"+j);J=h.parent();M=h.position().top;y=h.css("width")}else{if(x.name==="agendaWeek"){h=C.find(".fc-agendaWeek-view").find(".fc-slats tr").eq(E);if(((!q&&F===0)||(q&&F===o-1))&&h.find("td").not(".fc-axis").length===1){var D=h.find("td").not(".fc-axis").eq(0);I.AttachAutoAttributes(D,"CalendarSlot","slotCol-1-"+j);for(var K=1;K<o;K++){if(q){D.clone(true).last().prependTo(h)}else{D.clone(true).last().appendTo(h)}var L=(K+1)%o;I.AttachAutoAttributes(D,"CalendarSlot","slotCol-"+L+"-"+j)}}var r=q?F:F+1;J=h.find("td").eq(r);if(J.children().length===0){J.append($("<div style='position:relative'>&nbsp;</div>"))}l=J.find("div");M=J.position().top;y=l.width()}}if((E===s)&&!z&&m){var f=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-start-row",type:consts.get("SWE_CTRL_PLAINTEXT")}));J.addClass("siebui-cal-start-slot");J.append(f);f.css("top",M);f.css("width",y)}if(E>=s&&E<p.endWorkHrSlot&&!z&&m){if(x.name!=="month"){l.addClass("calendar-WorkingHr-"+x.name)}}else{if((E<s||E>=p.endWorkHrSlot)||z||!m){if(!z&&m&&(E===p.endWorkHrSlot)){var B=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-end-row",type:consts.get("SWE_CTRL_PLAINTEXT")}));J.addClass("siebui-cal-end-slot");J.append(B);B.css("top",M);B.css("width",y)}if(x.name==="agendaDay"){g.addClass("calendar-NonWorkingHr-"+x.name)}if(x.name!=="month"){l.addClass("calendar-NonWorkingHr-"+x.name)}}}}if(!q){F++}else{F--}}};e.prototype.BldWeekColHdr=function(r){var C=this.GetPM();var x=this.GetCal();var n=this.GetCalCtrlEventHandlers();var s=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");var B=C.Get("Hidden Days");var l=((C.Get("Preferred Weekly Mode")==="7 Day Weekly")?7:7-B.length);var m=C.Get("RTL Mode")==="Y";var k,q,f;var p,v=0;var u=false;if(r.name!=="agendaWeek"){return}var y=function(h){n.OnWeekHdrAddClick(h)};var t=function(h){n.OnWeekHdrClick(h)};for(var A=0;A<l;A++){k=x.find("th.fc-widget-header").not(".fc-axis").eq(A);if(!k.hasClass("siebui-cal-col-hdr")&&k.text()!=="undefined"){q=k.text();u=q.indexOf(SiebelApp.S_App.LocaleObject.GetDispDateSeparator())!==-1;f=q.split("%");$(k).addClass("siebui-cal-col-hdr");$(k).text("");while(C.Get("Preferred Weekly Mode")!=="7 Day Weekly"&&$.inArray((r.start.day()+v)%7,B)!==-1){v++}if(m){p=moment(r.end);p.subtract(v+1,"d")}else{p=moment(r.start);p.add(v,"d")}var i=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({attrs:"data-date= '"+p.format("YYYY-MM-DD")+"'",className:"siebui-col-hdr-date",type:consts.get("SWE_CTRL_PLAINTEXT")}));if(s){s.Manage(i,["click","tap"],t)}var z=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-col-hdr-row",type:consts.get("SWE_CTRL_PLAINTEXT"),value:f[0]}));var w=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-col-hdr-row",type:consts.get("SWE_CTRL_PLAINTEXT"),value:f[1]+(u?"":" ")+f[2]}));i.append(z);i.append(w);var j=C.Get("UISTR New Record")||"New Record";var g=this.BldStdHdrBtn("",j,"newEvent","siebui-icon-add",y);g.attr("data-date",p.format("YYYY-MM-DD"));g.attr("rn",j.replace(/\s/g,"")+A);g.attr("un",j);g.attr("ot","Button");var D=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-date-hdr",type:consts.get("SWE_CTRL_PLAINTEXT")}));var o=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-hdr-add-container",type:consts.get("SWE_CTRL_PLAINTEXT")}));o.append(g);D.append(i);if(C.Get("CanInsert")&&C.Get("Enable New Button")==="Y"){D.append(o)}$(k).append(D);x.find(".fc-agendaWeek-view").children("div").css("top",$(k).css("height"))}v++}};e.prototype.RenderBusyFreeTime=function(){var u=this.GetPM();var p=this.GetCal();var j=p.fullCalendar("getView");if(j.name!=="month"){return}var n=u.ExecuteMethod("HourDecimal",u.Get("Preferred Business Day Start Time"));var i=u.ExecuteMethod("HourDecimal",u.Get("Preferred Business Day End Time"));var t=u.Get("Hidden Days");for(var m=0;m<7;m++){if($.inArray(m,t)!==-1){var s;if(m===0){s="sun"}else{if(m===1){s="mon"}else{if(m===2){s="tue"}else{if(m===3){s="wed"}else{if(m===4){s="thu"}else{if(m===5){s="fri"}else{if(m===6){s="sat"}}}}}}}if(typeof(s)!=="undefined"){p.find(".fc-day.fc-"+s).addClass("siebui-off-day")}}}p.find(".siebui-free-time").remove();var l=moment(j.start);var g;while(l.isBefore(j.intervalEnd)){if(l.isBefore(j.intervalStart)||!l.isBefore(j.intervalEnd)||l.isBefore(moment())){if(l.isBefore(moment())){g=l.format("YYYY-MM-DD");p.find(".fc-day[data-date='"+g+"']").addClass("siebui-past-day")}l.add(1,"d");continue}if(p.fullCalendar("getDate").month()===l.month()){var h=u.Get("BusyHours");var r=($.inArray(l.day(),t)!==-1||typeof(u.Get("AllDays")[l.toDate().toDateString()])!=="undefined")?0:i-n;
var w=(typeof(h[l.toDate().toDateString()])==="undefined")?i-n:Math.round(r-h[l.toDate().toDateString()]/(1000*60*60));var k=(w===1)?"HOUR AVAILABLE":"HOURS AVAILABLE";g=l.format("YYYY-MM-DD");var o=p.find(".fc-day[data-date='"+g+"']").not(".siebui-off-month, .siebui-off-day");o.find("div").removeAttr("style");o.removeClass("fc-state-highlight");var q;if(w>0&&o.length>0&&r>0){var v=$("<div id='free-time-"+g+"' class='siebui-free-time'></div>");v.append("<h4>"+w+"</h4>");v.append("<p>"+k+"</p>");q=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-monthly-cell",type:consts.get("SWE_CTRL_PLAINTEXT"),value:o.html()+$("<div>").append(v).html()});o.html(q)}else{var f=u.Get("AllDays");o.find("p").remove();if(typeof(f[l.toDate().toDateString()])!=="undefined"){var x=$("<p id='all-day-"+g+"'>"+f[l.toDate().toDateString()].displayFieldOne+"</p>");o.addClass("siebui-cal-all-day");q=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-monthly-cell",type:consts.get("SWE_CTRL_PLAINTEXT"),value:o.html()+$("<div>").append(x).html()});o.html(q)}}l.add(1,"d")}}};function b(i,h,l,f,g,m){var j=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({attrs:"ot='"+g+"' un='"+h.replace(/\s/g,"")+"' rn='"+h.replace(/\s/g,"")+"' alt= '"+h.replace(/\d/g,"")+"' title='"+h.replace(/\d/g,"")+"'",className:l,id:f,type:g,value:i}));var k=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(k){k.Manage(j,["click","tap"],function(){if(!j.hasClass("fc-state-disabled")){m.apply(this,Array.prototype.slice.call(arguments,0))}}).Manage(j,"mousedown",function(){j.not(".fc-state-active").not(".fc-state-disabled").addClass("fc-state-down")}).Manage(j,"mouseup",function(){j.removeClass("fc-state-down")}).Manage(j,"mouseenter",function(){j.not(".fc-state-active").not(".fc-state-disabled").addClass("fc-state-hover")}).Manage(j,"mouseleave",function(){j.removeClass("fc-state-hover").removeClass("fc-state-down")})}return j}function a(f,n,j){var h=this.GetPM();var o=this.GetUtilityMap();var k=this.GetCal().find("#"+f);k.css("z-index","9999");k.css("position","absolute");var i=h.Get("ShortMonthNames");var g=h.Get("ShortDayNames");var l=h.Get("UISTR Choose a date")||"Choose a date";k.datepicker({buttonImage:n,buttonText:l,buttonImageOnly:false,changeMonth:true,changeYear:true,dayNamesMin:g,isRTL:h.Get("RTL Mode")==="Y",monthNames:h.Get("MonthStringArray"),monthNamesShort:i,onSelect:j,showOn:"button"});var m=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");m.Manage(k,"keydown",function(){k.focus()});$(".ui-datepicker-trigger").addClass("fc-button-inner");$(".ui-datepicker-trigger").attr("alt",l);$(".ui-datepicker-trigger").attr("title",l);$(".ui-datepicker-trigger").attr("tabindex",0);$(".ui-datepicker-trigger").children().addClass("fc-button-content");$(".ui-datepicker-trigger").children().addClass("cal-ui-datepicker");$(".hasDatepicker").attr("tabindex",-1);o.AttachAutoAttributes(this.GetCal().find("#"+f+" ~ button.ui-datepicker-trigger"),"datePicker","datePicker");if(h.Get("Default Selected Day")){k.datepicker("setDate",h.Get("Default Selected Day"))}else{if(h.Get("SelectedDate")){k.datepicker("setDate",h.Get("SelectedDate"))}}return k}function d(j,i,f,g){var h=$("#"+j);if($("#"+j).length===0){h=$('<div id="'+j+'"></div>').html(i).dialog({autoOpen:false,buttons:g,close:function(){$("#"+j).remove()},height:"auto",modal:true,resizable:false,title:f,width:"auto",draggable:false})}h.parent().addClass("siebui-cal-popup");return h}function c(i){var v=this.GetPM();var t="";switch(i){case"QuickAddDialog":var j=v.Get("UISTR Tooltip Field Label:Description")||"Description";var h=v.Get("DescriptionFieldLength");t="<p>"+j+"<br />";t+=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_TEXT"),id:"DescriptionId",attrs:"rn='QANewDescription' ot='input' un='QANewDescription' name='eventDescription' maxlength='"+h+"'"});t+="<br /></p>";break;case"RepeatDialog":var n=v.Get("UISTR Repeating Dialog Label 1");var m=v.Get("UISTR Repeating Dialog Label 2");var p=v.Get("UISTR Repeating Dialog This Instance")||"This instance";var s=v.Get("UISTR Repeating Dialog All Future Instances")||"This and all future instances";t="<p>"+n+"<br /><br />";t+=m+"<br />";t+=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_RADIO"),id:"SaveThisOneId",attrs:"rn='saveThisOne' ot='radioButton' un='saveThisOne' name='userchoice' checked='checked'",value:"SaveThisOne"});t+=p+"<br />";t+=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_RADIO"),id:"SaveAllId",attrs:"rn='saveAll' ot='radioButton' un='saveAll' name='userchoice'",value:"SaveAll"});t+=s+"<br /></p>";break;case"SettingsDialog":var q=CCFMiscUtil_CreatePropSet();t="<table><td></td>";if(v.Get("Enable Timezone Picker")==="Y"){q.DecodeFromString(v.Get("Timezone List"));var u=[];var x=q.GetChildCount();for(var f=0;f<x;f++){u.push(q.GetChild(f).GetProperty("Value"))}var r=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_COMBOBOX"),id:"tzCombo",attrs:"rn='settingTimeZone' ot='JComboBox' un='settingTimeZone'",value:u});t+="<tr><td>"+v.Get("UISTR Timezone Label")+"</td>";t+="<td>"+r+"</td></tr>"}if(v.Get("Enable Owner Picker")==="Y"){q.DecodeFromString(v.Get("Access List"));var y=q.EnumProperties(true);var o=[],l=[],w=[];while(y){o.push([y,q.GetProperty(y)]);y=q.EnumProperties(false)}o.sort(this.GetUtilityMap().SortOrder);for(var g=0;g<o.length;g++){w.push(o[g][0]);l.push(o[g][1])}var k=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({attrs:"rn='settingOwner' ot='JComboBox' un='settingOwner'",displayValue:l,id:"ownerCombo",type:consts.get("SWE_CTRL_COMBOBOX"),value:w});t+="<tr><td>"+v.Get("UISTR Owner Label")+"</td>";t+="<td>"+k+"</td></tr>"}t+="</table>";break}return t}return e}());SiebelAppFacade.CalEventHandlers=(function(){function a(d,c,f,h){var i=c;var b=d;var g=f;var e=h;this.GetCal=function(){return i};this.GetPM=function(){return b};this.GetCalCtrlBuilder=function(){return g};this.GetUtilityMap=function(){return e}}a.prototype={OnCalSelect:function(g,b){var d=this.GetPM();if(d.Get("CanInsert")&&this.GetCal().fullCalendar("getView").name!=="month"){var e=d.Get("MouseDrag");var c;if(e===false){var f=parseInt(d.Get("Preferred Duration"),10);c=moment(g);c.add(f,"m")}else{c=moment(b)}this.GetCalCtrlBuilder().BuildQuickAddDialog(g,c)}},OnDayClick:function(d,c,b){this.GetCal().fullCalendar("gotoDate",d);this.GetPM().AddProperty("SelectedDate",this.GetCal().fullCalendar("getDate").toDate())},OnEventRender:function(r,c,k){var v=this.GetPM();var p=this.GetCal();var e=v.Get("CSSFontColors")||[];var g="";var u="";var s;if(typeof r.className!=="undefined"&&r.className.length===1&&r.className[0]==="fc-helper"){c.addClass("siebui-cal-quick-add-helper");return}if($(c.find(".fc-title")[0]).length===0){c.find(".fc-content").append('<div class="fc-title"></div>');c.find(".fc-content").css("height",c.css("height"))}var j=$(c.find(".fc-title")[0]);var b=v.Get("Available Days")||[];
var t=new Date(r.start);var m=t.getDay();var h=b.indexOf(m);if(k.name==="agendaDay"){h=0}var f=r.displayFieldOne.replace(/\s/g,"");c.attr("rn","slot-"+h+"-"+r.start.format("HHmmss")+f);c.attr("un",r.id);c.attr("ot","CalendarEvent");c.attr("data-drilldown",r.dataDrilldown);if(k.name==="month"&&v.Get("Enable BusyFreeTime")==="Y"){c.remove();return false}if(r.icons){for(s=0;s<r.icons.length;s++){var d=r.icons[s];var q=r.iconText[s];if(d!==""){g+=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_IMAGECONTROL"),src:"images/"+d,attrs:"title = '"+q+"' alt= '"+q+"'"})}}}var x=r.multiDisplay;for(var o=0;o<x.length;o++){var n=x[o];var w=e[n.CSSName];if(!w){j.addClass(n.CSSName);w=$("."+n.CSSName).css("color");if(w){w=this.GetUtilityMap().Rgb2hex(w)}else{w="NOCSSFONTCOLOR"}j.removeClass(n.CSSName);e[n.CSSName]=w}if(w!=="NOCSSFONTCOLOR"&&w!=="#111111"){n.FieldColor=w}n.FieldColor=n.FieldColor||"#111111";var y=this.GetUtilityMap().MakeDisplayField(n);if(y!==""){u+=y}}v.AddProperty("CSSFontColors",e);j.prepend(g+"&nbsp;"+u)},OnEventAfterRender:function(r,d,k){var v=this.GetPM();var q=this.GetCal();var s;var j=$(d.find(".fc-title")[0]);j.find("a").tooltip({content:j.find("a").attr("title"),position:v.Get("RTL Mode")!=="Y"?{}:{my:"right top",at:"right bottom",of:v.Get("ViewMode")==="2"?$(d.find(".fc-content")[0]):j,collision:"fit flip"},tooltipClass:"siebui-tooltip-calendar"});d.draggable({delay:250,});var l=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(l){var w,u;var m=false,x=false;l.Manage(d,["tap"],function(){d.trigger("click");d.draggable("enable")});l.Manage(d,"mousedown",function(i){m=true;x=false;w=i.pageX;u=i.pageY});l.Manage(d,"mousemove",function(i){if(m===true&&(Math.abs(i.pageX-w)>5||Math.abs(i.pageY-u)>5)){x=true}});l.Manage(d,"mouseup",function(){if(!x){d.draggable("disable")}m=false})}if(k.name!=="month"){var o=r.source||{};var c=function(i){return q.fullCalendar("option",i)};var n=[r.durationEditable,o.durationEditable,c("eventDurationEditable"),r.editable,o.editable,c("editable")];var h;var f=this;for(s=0;s<n.length;s++){if(n[s]!==undefined){h=n[s];break}}if(h){d.find(".fc-resizer").remove();var A=Math.max(q.find(".fc-slats tr").height(),21);var p=parseInt(v.Get("Preferred Timeslot Interval"),10);var z=r.end.diff(r.start,"m");var e=A;if(z%p!=0){e=((z%p)*A)/p}var y=bMutateEnd=false;var t="";if(d.hasClass("fc-start")&&d.hasClass("fc-end")){t="n,s"}else{if(d.hasClass("fc-start")){t="n"}else{if(d.hasClass("fc-end")){t="s"}else{}}}if(t.length!==0){d.resizable({handles:t,grid:A,minHeight:e,start:function(i,B){d.css("min-height",e+"px");if($(i.originalEvent.target).hasClass("ui-resizable-n")){y=true}else{if($(i.originalEvent.target).hasClass("ui-resizable-s")){bMutateEnd=true}}},stop:function(D,F){var E;var C;if(d.height()<=F.originalSize.height&&z<=p){C=0}else{C=Math.round((Math.max(e,d.height())-F.originalSize.height)/A)}if(y){var i=$.fullCalendar.moment(r.start);i.subtract(C*p,"m");E=k.calendar.mutateEvent(r,i,null);f.OnEventResize(r,E.dateDelta,function(){E.undo();q.fullCalendar("rerenderEvents")},D,F)}else{if(bMutateEnd){var B=$.fullCalendar.moment(r.end);B.add(C*p,"m");E=k.calendar.mutateEvent(r,null,B);f.OnEventResize(r,E.durationDelta,function(){E.undo();q.fullCalendar("rerenderEvents")},D,F)}}d.css("min-height","22px")}})}d.on("mousedown",function(i){if($(i.target).hasClass("ui-resizable-n")||$(i.target).hasClass("ui-resizable-s")){i.preventDefault();i.stopPropagation()}})}}d.find(".fc-time").text("");if(v.ExecuteMethod("IsTimeStampRequired",r.start,r.end)){var g=v.ExecuteMethod("GetTimeStampFormat",r.start,r.end);var b=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({className:"siebui-cal-timestamp",type:consts.get("SWE_CTRL_PLAINTEXT"),value:$.fullCalendar.formatRange(r.start,r.end,g)+" "});j.parent().prepend(b)}d.removeClass("fc-state-highlight");d.find(".ui-resizable-handle").empty()},OnEventClick:function(h,c,b){var e=this.GetPM();var d=this.GetCal();d.fullCalendar("gotoDate",h.start);e.AddProperty("SelectedDate",d.fullCalendar("getDate").toDate());var f=c.target||c.srcElement;var g=$(f).closest("[data-drilldown]").attr("data-drilldown");e.OnControlEvent(SiebelApp.Constants.get("PHYEVENT_DRILLDOWN_LIST"),g)},OnEventLimitClick:function(c,b){var f=this.GetPM();var e=this.GetCal();var g=this.GetUtilityMap().SplitViewName(e.fullCalendar("getView").name);e.find(".siebui-cal-btn-"+g).removeClass("disabled");e.find(".siebui-cal-btn-"+g+"-txt").removeClass("disabled");var d="day";return d},OnEventDestroy:function(d,c,b){var e=$(c.find(".fc-title")[0]).find("a");if(e.data("ui-tooltip")){e.tooltip("destroy")}if(c.data("ui-draggable")){c.draggable("destroy")}if(c.data("ui-resizable")){c.resizable("destroy")}e.off()},OnEventDragStop:function(d,c,e,b){b.coordMap.build();if(b.coordMap.getCell(c.pageX,c.pageY)){return}this.GetCal().fullCalendar("refetchEvents")},OnEventDrop:function(e,f,d,b){var c=this.GetCal();if(e.readOnly!=="N"){d()}else{if(e.repeating==="N"){this.GetPM().OnControlEvent("eventDrop",e.start.format("MM/DD/YYYY HH:mm:ss"),e.end.format("MM/DD/YYYY HH:mm:ss"),e.calendarId,null);c.fullCalendar("refetchEvents");return}else{this.GetCalCtrlBuilder().BuildRepeatDialog(e,"eventDrop",d,function(){c.fullCalendar("refetchEvents")})}}},OnEventResize:function(e,g,d,b,f){var c=this.GetCal();if(f&&f.element&&f.originalPosition){if(Math.abs(f.element.position().top-f.originalPosition.top)>1){e.end.subtract(g)}}if(e.readOnly!=="N"){d()}else{if(e.repeating==="N"){this.GetPM().OnControlEvent("eventResize",e.start.format("MM/DD/YYYY HH:mm:ss"),e.end.format("MM/DD/YYYY HH:mm:ss"),e.calendarId,null);c.fullCalendar("refetchEvents");return}else{this.GetCalCtrlBuilder().BuildRepeatDialog(e,"eventResize",d,function(){c.fullCalendar("refetchEvents")})}}},OnEventRefresh:function(f,b,d,e){var c=this.GetPM();c.AddProperty("CurViewShowDate",moment(f));c.AddProperty("CurViewStartDate",moment(f));c.AddProperty("CurViewEndDate",moment(b));c.AddProperty("SelectedDate",new Date(this.GetCal().fullCalendar("getDate").format()));c.ExecuteMethod("GetCalendarData");e([])},OnExtJQueryDropHandler:function(f,d,h,c,g){if(this.GetPM().Get("CanInsert")&&$.data(g).appletRowId){d.preventDefault();var e=moment(f);e.add(this.GetCal().fullCalendar("option","slotDuration"),"m");var b=[{id:"tmp1",title:"",start:f,end:e,url:"",multiDisplay:[],repeating:"N",readOnly:"N",displayFieldOne:"",className:"fc-event-skin calendar-EventStyle-Placeholder",allDay:false,editable:true}];this.GetCal().fullCalendar("addEventSource",b);this.GetPM().OnControlEvent("externalDrop",f.format("MM/DD/YYYY HH:mm:ss"),$.data(g).appletRowId.appletName,$.data(g).appletRowId.rowId,null);this.GetCal().fullCalendar("refetchEvents")}},OnExtHTMLDropHandler:function(o){o.preventDefault();var e;if(o.originalEvent.dataTransfer){e=o.originalEvent.dataTransfer.getData("Text")}if(e){var n;if(e.indexOf("\r")!==-1){n=e.replace(/\n/g,"").split("\r")}else{n=e.split("\n")}var k=[];var l=[];var f,d;if(n.length-1<=1){SiebelJS.Log("ERROR: Expected data but only received header row");
return}for(f=0;f<n.length-1;f++){var b=n[f].split("\t");var g=[];for(d=0;d<b.length;d++){if(f===0){var p=b[d].replace("\n","");if(p!==""){k.push(p)}else{SiebelJS.Log("ERROR: Empty field name received in header row.");return}}else{g.push(b[d].replace("\n",""))}}if(f!==0){l.push(g)}}var h=l.length;for(f=0;f<h;f++){var c=CCFMiscUtil_CreatePropSet();var m=k.length;for(d=0;d<m;d++){c.SetProperty(k[d],l[f][d])}o.data.ctx.GetPM().OnControlEvent("externalDrop",null,null,null,c)}o.data.ctx.GetCal().fullCalendar("refetchEvents")}},OnViewDisplayChange:function(b){var f=this.GetPM();var e=this.GetCal();var g=this.GetCalCtrlBuilder();var d=this.GetUtilityMap().SplitViewName(b.name);e.find(".siebui-cal-btn-"+d).addClass("disabled");e.find(".siebui-cal-btn-"+d+"-txt").addClass("disabled");var h=moment().format("YYYY-MM-DD");var c=$.fullCalendar.moment(h);if(!c.isBefore(b.start)&&c.isBefore(b.end)){e.find(".siebui-cal-btn-today").addClass("disabled")}else{e.find(".siebui-cal-btn-today").removeClass("disabled")}e.find(".siebui-cal-hdr-wrapper").removeClass().addClass("siebui-cal-hdr-wrapper");e.find(".siebui-cal-hdr-wrapper").addClass("siebui-cal-"+d+"-hdr");if(b.name==="agendaWeek"){g.BldWeekColHdr(b)}if(b.name==="agendaDay"||b.name==="agendaWeek"){g.BldSlotIndicators(b)}if(b.name==="month"&&f.Get("Enable BusyFreeTime")==="Y"){e.find(".fc-grid .fc-day-content").addClass("siebui-no-height")}}};return a}());SiebelAppFacade.CalUtility=(function(){function a(){}a.prototype={EventSortOrder:function(d,c){return d.start-c.start},GetObjectSize:function(d){var c=0;for(var b in d){if(d.hasOwnProperty(b)){c+=1}}return c},Hex:function(b){return("0"+parseInt(b,10).toString(16)).slice(-2)},IsAllDayEvent:function(c){if(c.Planned<=c.PlannedCompletion){var b=c.Planned;var d=c.PlannedCompletion;if(b.hour()===0&&b.minute()===0&&b.second()===0&&d.hour()===0&&d.minute()===0&&d.second()===0){return true}}return false},MakeDisplayField:function(e){var g=e.FieldValue;var i=$("<div />").text(e.ToolTip).html();var h=e.DrillDown;var d=e.FieldColor;var b="";if(g===""){return b}var f=i.split("&lt;br /&gt;");var c=45;for(var j=0;j<f.length;j++){if(f[j].length>c){f[j]=f[j].substring(0,c).split(" ").slice(0,-1).join(" ")+"..."}}i=f.join("&lt;br /&gt;");b+=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_LINK"),attrs:'title="'+i+'" data-drilldown="'+h+'"',value:SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:consts.get("SWE_CTRL_PLAINTEXT"),className:e.CSSName+" fc-title siebui-cal-drilldown",value:g})});if(d!==""){$("."+e.CSSName).css("color",d)}return b},Rgb2hex:function(b){if(b.search("rgb")===-1){return b}else{b=b.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);return"#"+this.Hex(b[1])+this.Hex(b[2])+this.Hex(b[3])}},SortOrder:function(d,c){return(d[1]>c[1]?1:-1)},SplitViewName:function(e){var b="";var d=e.match(/[A-Z]*[^A-Z]+/g);for(var c=0;c<d.length;c++){b+=d[c].toLowerCase();if(c!==d.length-1){b+="-"}}return b},ViewModeToName:function(b){var c="agendaDay";if(b==="0"){c="agendaDay"}else{if(b==="1"){c="agendaWeek"}else{if(b==="2"){c="month"}}}return c},ViewNameToMode:function(c){var b="0";if(c==="agendaDay"){b="0"}else{if(c==="agendaWeek"){b="1"}else{if(c==="month"){b="2"}}}return b},AttachAutoAttributes:function(c,d,b){if(typeof(c)!=="undefined"){c.attr({rn:b,ot:d,un:b})}}};return a}());SiebelAppFacade.CalLocaleConverter=(function(){function a(){var j={"hh:mm:ss":function(k){return c(k)},"mm:hh:ss":function(k){return c(k)},"ss:mm:hh":function(k){return c(k)},"mm:ss:hh":function(k){return c(k)},"hh:ss:mm":function(k){return c(k)},"ss:hh:mm":function(k){return c(k)},"h:mm:ss":function(k){return c(k)},"mm:h:ss":function(k){return c(k)},"ss:mm:h":function(k){return c(k)},"mm:ss:h":function(k){return c(k)},"ss:h:mm":function(k){return c(k)},"h:ss:mm":function(k){return c(k)},"m:hh:ss":function(k){return c(k)},"ss:m:hh":function(k){return c(k)},"hh:m:ss":function(k){return c(k)},"m:ss:hh":function(k){return c(k)},"hh:ss:m":function(k){return c(k)},"ss:hh:m":function(k){return c(k)},"hh:mm:s":function(k){return c(k)},"mm:hh:s":function(k){return c(k)},"s:mm:hh":function(k){return c(k)},"s:hh:mm":function(k){return c(k)},"mm:s:hh":function(k){return c(k)},"hh:s:mm":function(k){return c(k)},"h:m:ss":function(k){return c(k)},"m:h:ss":function(k){return c(k)},"ss:m:h":function(k){return c(k)},"ss:h:m":function(k){return c(k)},"m:ss:h":function(k){return c(k)},"h:ss:m":function(k){return c(k)},"hh:m:s":function(k){return c(k)},"hh:s:m":function(k){return c(k)},"m:hh:s":function(k){return c(k)},"s:hh:m":function(k){return c(k)},"s:m:hh":function(k){return c(k)},"m:s:hh":function(k){return c(k)},"h:mm:s":function(k){return c(k)},"mm:h:s":function(k){return c(k)},"mm:s:h":function(k){return c(k)},"s:mm:h":function(k){return c(k)},"h:s:mm":function(k){return c(k)},"s:h:mm":function(k){return c(k)},"h:m:s":function(k){return c(k)},"m:h:s":function(k){return c(k)},"s:m:h":function(k){return c(k)},"hh:mm":function(k){return c(k,"hm")},"mm:hh":function(k){return c(k,"hm")},"h:mm":function(k){return c(k,"hm")},"mm:h":function(k){return c(k,"hm")},"hh:m":function(k){return c(k,"hm")},"m:hh":function(k){return c(k,"hm")},"h:m":function(k){return c(k,"hm")},"m:h":function(k){return c(k,"hm")},"ss:mm":function(k){return c(k,"ms")},"ss:m":function(k){return c(k,"ms")},"m:ss":function(k){return c(k,"ms")},"mm:s":function(k){return c(k,"ms")},"s:mm":function(k){return c(k,"ms")},"s:m":function(k){return c(k,"ms")},"m:s":function(k){return c(k,"ms")},"dd/mm/yyyy":function(k){return d(k)},"mm/dd/yyyy":function(k){return d(k)},"dd/yyyy/mm":function(k){return d(k)},"yyyy/dd/mm":function(k){return d(k)},"mm/yyyy/dd":function(k){return d(k)},"yyyy/mm/dd":function(k){return d(k)},"d/mm/yyyy":function(k){return d(k)},"mm/d/yyyy":function(k){return d(k)},"d/yyyy/mm":function(k){return d(k)},"yyyy/d/mm":function(k){return d(k)},"mm/yyyy/d":function(k){return d(k)},"yyyy/mm/d":function(k){return d(k)},"dd/m/yyyy":function(k){return d(k)},"m/dd/yyyy":function(k){return d(k)},"dd/yyyy/m":function(k){return d(k)},"yyyy/dd/m":function(k){return d(k)},"m/yyyy/dd":function(k){return d(k)},"yyyy/m/dd":function(k){return d(k)},"dd/mm/yy":function(k){return d(k)},"mm/dd/yy":function(k){return d(k)},"dd/yy/mm":function(k){return d(k)},"yy/dd/mm":function(k){return d(k)},"mm/yy/dd":function(k){return d(k)},"yy/mm/dd":function(k){return d(k)},"d/m/yyyy":function(k){return d(k)},"m/d/yyyy":function(k){return d(k)},"d/yyyy/m":function(k){return d(k)},"yyyy/d/m":function(k){return d(k)},"m/yyyy/d":function(k){return d(k)},"yyyy/m/d":function(k){return d(k)},"d/mm/yy":function(k){return d(k)},"mm/d/yy":function(k){return d(k)},"d/yy/mm":function(k){return d(k)},"yy/d/mm":function(k){return d(k)},"mm/yy/d":function(k){return d(k)},"yy/mm/d":function(k){return d(k)},"dd/m/yy":function(k){return d(k)},"m/dd/yy":function(k){return d(k)},"dd/yy/m":function(k){return d(k)},"yy/dd/m":function(k){return d(k)},"m/yy/dd":function(k){return d(k)
},"yy/m/dd":function(k){return d(k)},"d/m/yy":function(k){return d(k)},"m/d/yy":function(k){return d(k)},"d/yy/m":function(k){return d(k)},"yy/d/m":function(k){return d(k)},"m/yy/d":function(k){return d(k)},"yy/m/d":function(k){return d(k)},"mm/yyyy":function(k){return d(k,"my")},"yyyy/mm":function(k){return d(k,"my")},"yyyy/m":function(k){return d(k,"my")},"m/yyyy":function(k){return d(k,"my")},"mm/yy":function(k){return d(k,"my")},"yy/mm":function(k){return d(k,"my")},"yy/m":function(k){return d(k,"my")},"m/yy":function(k){return d(k,"my")},"dd/mm":function(k){return d(k,"md")},"mm/dd":function(k){return d(k,"md")},"dd/m":function(k){return d(k,"md")},"m/dd":function(k){return d(k,"md")},"d/mm":function(k){return d(k,"md")},"mm/d":function(k){return d(k,"md")},"d/m":function(k){return d(k,"md")},"m/d":function(k){return d(k,"md")},s:function(k){return k.s},ss:function(k){return k.s},m:function(k){return k.n},mm:function(k){return k.n},h:function(k){return k.h},hh:function(k){return k.h},H:function(k){return k.h},HH:function(k){return k.h},d:function(k){return k.ld},dd:function(k){return k.ld},M:function(k){return k.lm},MM:function(k){return k.lm},yy:function(k){return k.ly},yyyy:function(k){return k.ly},ddd:function(k){return"ddd"},dddd:function(k){return"dddd"},MMM:function(k){return"MMM"},MMMM:function(k){return"MMMM"},t:function(k){return(k.h24?"":k.p)},a:function(k){return(k.h24?"":k.p)},T:function(k){return(k.h24?"":k.p.toUpperCase())},A:function(k){return(k.h24?"":k.p.toUpperCase())},"//":function(k){return"/"},"/":function(k){return k.ds},"::":function(k){return":"},":":function(k){return k.ts}};this.getFormatConverter=function(){return j}}a.prototype.ConvertLocale=function(o){var p=this;var j=[];var n=[];for(var k=1;k<13;k++){j.push(SiebelApp.S_App.LocaleObject.GetMonth(k));n.push(SiebelApp.S_App.LocaleObject.GetMonth(k,true))}var s=[];var l=[];for(var q=0;q<7;q++){s.push(SiebelApp.S_App.LocaleObject.GetDayOfWeek(q,0));l.push(SiebelApp.S_App.LocaleObject.GetDayOfWeek(q,1))}var r={ds:SiebelApp.S_App.LocaleObject.GetDispDateSeparator(),ts:SiebelApp.S_App.LocaleObject.GetDispTimeSeparator(),h24:true,df:"",tf:"",ldf:"",p:"",monthNames:j,monthNamesShort:n,dayNames:s,dayNamesShort:l,periodName:[SiebelApp.S_App.LocaleObject.GetDispTimeAM().toLowerCase(),SiebelApp.S_App.LocaleObject.GetDispTimePM().toLowerCase()],periodShortName:[SiebelApp.S_App.LocaleObject.GetDispTimeAM().toLowerCase().charAt(0),SiebelApp.S_App.LocaleObject.GetDispTimePM().toLowerCase().charAt(0)]};r=i(r);r=h(r);r=e(r,o.longDateFormat);var t=(r.ds).replace(/\\/g,"\\\\");t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\^\$\|]/g,"\\\\$&");$.fullCalendar.dateFormatters=$.extend(true,{},$.fullCalendar.dateFormatters,{t:function(u,m){return u.hour()<12?m.periodShortName[0]:m.periodShortName[1]},tt:function(u,m){return u.hour()<12?m.periodName[0]:m.periodName[1]},T:function(u,m){return u.hour()<12?m.periodShortName[0].toUpperCase():m.periodShortName[1].toUpperCase()},TT:function(u,m){return u.hour()<12?m.periodName[0].toUpperCase():m.periodName[1].toUpperCase()}});return $.extend(true,{},r,{titleFormat:{month:g.call(p,o.titleFormat.month,r),week:b.call(p,r),day:g.call(p,o.titleFormat.day,r)},columnFormat:{month:g.call(p,o.columnFormat.month,r),week:g.call(p,o.columnFormat.week,r).replace(/\s/g,"%").replace(new RegExp(t),r.ds+"%"),day:g.call(p,o.columnFormat.day,r)},timeFormat:{"":g.call(p,o.timeFormat,r)}})};function i(l){var o,m,q,p,n="";var r=SiebelApp.S_App.LocaleObject.GetDateFormat();var k=r.length;for(o=0;o<k;o++){for(m=k;m>o;m--){q=f(r.substring(o,m),l,false);if(q){if(q!==l.ds){o=m-1;l=q}}}}return l}function e(u,q){var n,l,m,r,t="",s="";var p=q.length;var v=q.toUpperCase();var k=[];var o;for(n=0;n<p;n++){t=v.charAt(n);if(t==="'"){for(l=n+1;l<p;l++){if(v.charAt(l)==="'"){if(l-n===2&&k.length>0){o="["+v.charAt(n+1)+"]";var w=k.pop();switch(w){case"ld":u=$.extend(true,{},u,{symbLd:o});break;case"lm":u=$.extend(true,{},u,{symbLm:o});break;case"ly":u=$.extend(true,{},u,{symbLy:o});break}}n=l;break}}}for(m=p;m>n;m--){r=f(v.substring(n,m),u,true,k);if(r){if(r!==u.ds){n=m-1;u=r}}}}return u}function h(l){var o,m,r,p,n="";var q=SiebelApp.S_App.LocaleObject.GetTimeFormat();var k=q.length;for(o=0;o<k;o++){for(m=k;m>o;m--){r=f(q.substring(o,m),l,false);if(r){if(r!==l.ts){o=m-1;l=r}}}}return l}function f(n,m,j,k){var l;switch(n){case m.ds:l=m.ds;break;case m.ts:l=m.ts;break;case"DDDD":if(j){l=m}break;case"DDD":if(j){l=m}break;case"DD":if(j){l=$.extend(true,{},m,{ld:"DD",ldf:m.ldf.concat("d")});k.push("ld")}else{l=$.extend(true,{},m,{d:"DD",df:m.df.concat("d")})}break;case"D":if(j){l=$.extend(true,{},m,{ld:"D",ldf:m.ldf.concat("d")});k.push("ld")}else{l=$.extend(true,{},m,{d:"D",df:m.df.concat("d")})}break;case"MMMM":if(j){l=$.extend(true,{},m,{lm:"MMMM",ldf:m.ldf.concat("m")});k.push("lm")}else{l=$.extend(true,{},m,{m:"MMMM",df:m.df.concat("m")})}break;case"MMM":if(j){l=$.extend(true,{},m,{lm:"MMM",ldf:m.ldf.concat("m")});k.push("lm")}else{l=$.extend(true,{},m,{m:"MMM",df:m.df.concat("m")})}break;case"MM":if(j){l=$.extend(true,{},m,{lm:"MM",ldf:m.ldf.concat("m")});k.push("lm")}else{l=$.extend(true,{},m,{m:"MM",df:m.df.concat("m")})}break;case"M":if(j){l=$.extend(true,{},m,{lm:"M",ldf:m.ldf.concat("m")});k.push("lm")}else{l=$.extend(true,{},m,{m:"M",df:m.df.concat("m")})}break;case"YYYY":if(j){l=$.extend(true,{},m,{ly:"YYYY",ldf:m.ldf.concat("y")});k.push("ly")}else{l=$.extend(true,{},m,{y:"YYYY",df:m.df.concat("y")})}break;case"YY":if(j){l=$.extend(true,{},m,{ly:"YY",ldf:m.ldf.concat("y")});k.push("ly")}else{l=$.extend(true,{},m,{y:"YY",df:m.df.concat("y")})}break;case"HH":l=$.extend(true,{},m,{h:"HH",h24:true,tf:m.tf.concat("h")});break;case"H":l=$.extend(true,{},m,{h:"H",h24:true,tf:m.tf.concat("h")});break;case"hh":l=$.extend(true,{},m,{h:"hh",tf:m.tf.concat("h")});break;case"h":l=$.extend(true,{},m,{h:"h",tf:m.tf.concat("h")});break;case"mm":l=$.extend(true,{},m,{n:"mm",tf:m.tf.concat("m")});break;case"m":l=$.extend(true,{},m,{n:"m",tf:m.tf.concat("m")});break;case"ss":l=$.extend(true,{},m,{s:"ss",tf:m.tf.concat("s")});break;case"s":l=$.extend(true,{},m,{s:"s",tf:m.tf.concat("s")});break;case"p":l=$.extend(true,{},m,{h24:false,p:"tt"});break;default:return}return l}function g(p,r){var l,m=p.length,o,k,q,n="",j="";for(l=0;l<m;l++){o=p.charAt(l);if(o==="'"){n+="[";for(k=l+1;k<m;k++){if(p.charAt(k)==="'"){n+=p.substring(l+1,k);n+="]";l=k;break}}}else{if(o==="("){n+=o;for(k=l+1;k<m;k++){if(p.charAt(k)===")"){j=g.call(this,p.substring(l+1,k),r);n+=j;n+=")";l=k;break}}}else{for(k=m;k>l;k--){q=this.getFormatConverter()[p.substring(l,k)]||this.getFormatConverter()[p.substring(l,k).toLowerCase()];if(q){n+=q(r);l=k-1;break}}if(k===l){n+=o}}}}return n}function c(k,l){var j;switch(k.tf){case"hms":j=(l==="hm"?k.h+k.ts+k.n:(l==="ms"?k.n+k.ts+k.s:k.h+k.ts+k.n+k.ts+k.s));break;case"hsm":j=(l==="hm"?k.h+k.ts+k.n:(l==="ms"?k.s+k.ts+k.n:k.h+k.ts+k.s+k.ts+k.n));break;case"smh":j=(l==="hm"?k.n+k.ts+k.h:(l==="ms"?k.s+k.ts+k.n:k.s+k.ts+k.n+k.ts+k.h));
break;case"shm":j=(l==="hm"?k.h+k.ts+k.n:(l==="ms"?k.s+k.ts+k.n:k.s+k.ts+k.h+k.ts+k.n));break;case"msh":j=(l==="hm"?k.n+k.ts+k.h:(l==="ms"?k.n+k.ts+k.s:k.n+k.ts+k.s+k.ts+k.h));break;case"mhs":j=(l==="hm"?k.n+k.ts+k.h:(l==="ms"?k.n+k.ts+k.s:k.n+k.ts+k.h+k.ts+k.s));break}j+=(k.h24?k.p:"");return j}function d(j,k){switch(j.df){case"dmy":return(k==="my"?j.m+j.ds+j.y:(k==="md"?j.d+j.ds+j.m:j.d+j.ds+j.m+j.ds+j.y));case"mdy":return(k==="my"?j.m+j.ds+j.y:(k==="md"?j.m+j.ds+j.d:j.m+j.ds+j.d+j.ds+j.y));case"dym":return(k==="my"?j.y+j.ds+j.m:(k==="md"?j.d+j.ds+j.m:j.d+j.ds+j.y+j.ds+j.m));case"myd":return(k==="my"?j.m+j.ds+j.y:(k==="md"?j.m+j.ds+j.d:j.m+j.ds+j.y+j.ds+j.d));case"ymd":return(k==="my"?j.y+j.ds+j.m:(k==="md"?j.m+j.ds+j.d:j.y+j.ds+j.m+j.ds+j.d));case"ydm":return(k==="my"?j.y+j.ds+j.m:(k==="md"?j.d+j.ds+j.m:j.y+j.ds+j.d+j.ds+j.m))}}function b(k){var m=k.ly;var j=k.lm;var l=k.ld;if(k.symbLy){m=m.concat(k.symbLy)}if(k.symbLm){j=j.concat(k.symbLm)}if(k.symbLd){l=l.concat(k.symbLd)}switch(k.ldf){case"dmy":return(l+" "+j+" "+m);case"mdy":return(j+" "+l+" "+m);case"dym":return(l+" "+m+" "+j);case"myd":return(j+" "+m+" "+l);case"ymd":return(m+" "+j+" "+l);case"ydm":return(m+" "+l+" "+j);case"dm":return(l+" "+j);case"md":return(j+" "+l);case"my":return(j+" "+m);case"ym":return(m+" "+j)}}return a}());return"SiebelAppFacade.JQFullCalRenderer"})};