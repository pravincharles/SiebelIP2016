/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET7 */
if(typeof(SiebelAppFacade.CommToolbarPhyRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.CommToolbarPhyRenderer");define("siebel/commToolbarprender",["siebel/basephyrenderer"],function(){SiebelAppFacade.CommToolbarPhyRenderer=(function(){var y=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject");function i(I){SiebelAppFacade.CommToolbarPhyRenderer.superclass.constructor.call(this,I);this.m_toolbarUI=$(I.Get("GetPlaceholder"));this.m_focusEditBeforeClick="";this.m_sSelText="";this.m_curFocusEditName="";this.m_timerId=0;this.m_oldtitle="";this.m_mapOrderToName={};this.m_mapNameToOrder={};this.m_mouseupfromSelf=false;this.m_bIsMakeCallPopupNeeded=I.Get("IsMakeCallPopupNeeded");this.m_lastClickTime=0;this.m_EditPrevStatusMap={};this.m_EditBoxTextMap={}}SiebelJS.Extend(i,SiebelAppFacade.BasePR);i.prototype.Init=function(){SiebelAppFacade.CommToolbarPhyRenderer.superclass.Init.call(this);this.AttachPMBinding("ShowStatusText",this.ShowStatusText);this.AttachPMBinding("ShowMessageWithAlert",this.ShowMessageWithAlert);this.AttachPMBinding("TriggerEvent",this.TriggerEvent,{scope:this});this.AttachPMBinding("PlaySound",this.PlaySound,{scope:this});this.AttachPMBinding("UpdateHTMLControl",this.UpdateHTMLControl,{scope:this});this.AttachPMBinding("FlashTitle",this.FlashTitle,{scope:this});this.AttachPMBinding("BlinkParentBtn",this.BlinkParentBtn);this.AttachPMBinding("GotoCTIToolbar",this.GotoCTIToolbar,{scope:this});this.AttachPMBinding("HideCTIToolbar",this.HideCTIToolbar,{scope:this});this.AttachPMBinding("UpdateCallContactFromUI",this.UpdateCallContactFromUI);this.AttachPMBinding("OpenCallContactFromUIPopup",this.OpenCallContactFromUIPopup,{scope:this});this.AttachPMBinding("NotifyCommPanel",A)};i.prototype.GetControljqObj=function(K){var J=$('<div role="presentation"></div>');var I;if(K===undefined){J=$();return J}switch(K.m_type){case"button":var L=K.m_image;if(K.m_state==="disabled"){L=K.m_imgd}I=$("<img>");I.attr({name:K.m_name,id:K.m_id,title:K.m_tooltip,alt:H(K),src:L,role:"button","aria-label":H(K),tabindex:"-1"});if(K.m_name.indexOf("Agent State")>=0){I.attr("aria-pressed","false")}J.attr("id","CommBtn_"+K.m_id);if(K.m_name.indexOf("SidewayPopup")===0){J.addClass("commSidewayBtnContainer siebui-tb-cti-sideway-poup-btn-container siebui-commbtn-enabled siebui-tb-cti-btn-enabled");I.addClass("commSidewayBtn siebui-tb-cti-sideway-poup-btn commBtnEnabled siebui-tb-cti-btn-img-enabled")}else{if(K.m_index!==0){I.addClass("commSubBtn siebui-tb-cti-child-btn");J.addClass("commSubBtnContainer siebui-tb-cti-child-btn-container")}else{I.addClass("commTopBtn siebui-tb-cti-parent-btn");J.addClass("commTopBtnContainer siebui-tb-cti-parent-btn-container")}if(K.m_state==="enabled"){J.addClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled");I.addClass("commBtnEnabled siebui-tb-cti-btn-img-enabled")}else{J.addClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled");I.addClass("siebui-tb-cti-btn-img-disabled")}}J.append(I);this.InjectQTPInfo(K,I);break;case"edit":I=$("<input/>");I.attr({id:K.m_id,name:K.m_name,title:K.m_tooltip,alt:K.m_name,type:"text",value:K.m_value,style:"width: "+K.m_width*0.7+"em",tabindex:"-1",role:"textbox","aria-label":K.m_name});I.addClass("commEdit siebui-tb-cti-edit-box");J.attr("id","CommEdit_"+K.m_id);J.addClass("commEditContainer siebui-tb-cti-edit-box-container");J.append(I);this.InjectQTPInfo(K,I);break;case"combo box":I=$("<select></select>");I.attr({id:K.m_id,name:K.m_name,title:K.m_tooltip,style:"width: "+K.m_width*0.7+"em",tabindex:"-1",role:"combobox","aria-label":K.m_name});I.addClass("commCombo siebui-tb-cti-dropdown");J.attr("id","CommCombo_"+K.m_id);J.addClass("commComboContainer siebui-tb-cti-dropdown-container");J.append(I);this.InjectQTPInfo(K,I);break;case"separator":I=$("<span></span>");I.attr({id:K.m_id,role:"separator"});I.addClass("commSep siebui-tb-cti-separator");J.attr("id","CommSep_"+K.m_id);J.addClass("commSepContainer siebui-tb-cti-separator-container");J.append(I);break;case"timer":I=$("<span></span>");I.text("00:00:00");I.attr({id:K.m_id,name:K.m_name,tabindex:"-1",role:"timer","aria-label":K.m_name});I.addClass("commTimerSpan siebui-tb-cti-timer");J.attr("id","CommTimer_"+K.m_id);J.addClass("commTimerContainer siebui-tb-cti-timer-container");J.append(I);this.InjectQTPInfo(K,I);break;default:J=$();break}if(J.attr("id")!==""&&K.m_name!==""){J.addClass("siebui-tb-cti-item-"+K.m_name.replace(/\s+/g,"-").toLowerCase())}return J};i.prototype.InjectQTPInfo=function(J,I){if(this.GetPM().Get("IsAutomationEnabled")){I.attr({rn:J.m_name,un:J.m_id,ot:J.m_type})}};i.prototype.ShowUI=function(){SiebelAppFacade.CommToolbarPhyRenderer.superclass.ShowUI.call(this);var Z=$("#CommunicationPanelContainer #CTIToolbar");var I=null;var K=null;var aa=null;var ae="";var ah="";if(Z.length>0){Z.addClass("siebui-tb-cti-container");I=Z.find("#commPanelCTIToggle");if(I.length>0){aa=I.find("#commPanelCTIToShowMore");K=I.find("#commPanelCTIToShowLess");if(aa.length>0){ae=y.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_MORE");aa.parent("div").attr("title",ae);aa.attr("aria-label",ae)}if(K.length>0){ah=y.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_LESS");K.parent("div").attr("title",ah);K.attr("aria-label",ah)}}}var N=$("#s_toolbar").find("[name='Toggle CTI Toolbar']");if(N.length>0&&SiebelAppFacade.DecisionManager.IsTouch()){N.addClass("hidden")}var ac=null;var O=null;var ag=0;var Y=this.GetPM();if(!Y.OnControlEvent("PreShow")){return}var L=Y.Get("GetPopSidewayCtrl");var W=L.m_name;var af=0;var Q=Y.Get("GetTopControlNum");var S=Y.Get("GetTopCtrlsSeqMap");var M=Y.Get("GetSubCtrlsSeqMap");var J;var ab=$("<div></div>");var R;var P=true;var U=0;this.m_toolbarUI.attr({role:"toolbar","aria-label":y.GetLocalString("IDS_CTI_TOOLBAR_TITLE"),"aria-expanded":"true"}).parent().attr({role:"navigation","aria-label":y.GetLocalString("IDS_CTI_TOOLBAR_REGION_LABEL")});for(var X=1;X<=Q;X++){ac=S[X];if(ac!==undefined){R=this.GetControljqObj(ac);if(P){R.children().attr("tabindex","0");P=false}ab.append(R);if(ac.m_type!=="separator"){this.m_mapNameToOrder[ac.m_id]=U;this.m_mapOrderToName[U++]=ac.m_id}J=M[X];if(J===undefined){ag=0}else{ag=M[X].length-1}if(ag>0){L.m_id=W+af++;R=this.GetControljqObj(L);R.children().attr("aria-label",y.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));ab.append(R);this.m_mapNameToOrder[L.m_id]=U;this.m_mapOrderToName[U++]=L.m_id;var ad=$("<div></div>");ad.attr("id","SubCmdOf"+ac.m_id);ad.attr("role","group");ad.addClass("commSubCmdContainer siebui-tb-cti-btn-group-container");for(var V=1;V<=ag;V++){O=J[V];ad.append(this.GetControljqObj(O));this.m_mapNameToOrder[O.m_id]=U;this.m_mapOrderToName[U++]=O.m_id}ad.hide().attr({"aria-hidden":"true","aria-expanded":"false"});ab.append(ad)}}}this.m_toolbarUI.hide().append(ab.contents()).show().find(".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-timer, .siebui-tb-cti-edit-box, .siebui-tb-cti-dropdown").tooltip({position:{my:"left top",at:"right bottom+5",collision:"flipfit"},tooltipClass:"siebui-tooltip-cti",show:null,hide:null}).tooltip("disable");
var T=$("#siebui-toolbar-toggle-communication-panel").find("li[name='Toggle Communication Panel']");if(T.length>0){T.attr("data-initial-title",T.attr("title"))}B.call(this,"CTIToolbar: ShowUI")};i.prototype.CollectComboValue=function(){var I={};$(".siebui-tb-cti-dropdown").each(function(){var K=$(this).attr("name");var J=$(this).find(":selected");if(J.length>0){I[K]=J.val()}else{I[K]=""}});return I};i.prototype.CollectEditText=function(){var I={};$(".siebui-tb-cti-edit-box").each(function(){var J=$(this).attr("name");var K=$(this).val();K=K.replace(/\s/g,"");I[J]=K});return I};i.prototype.GetFocusEditName=function(J){if(J){var I=document.activeElement.id;if(I!==""){return $("#"+I.replace(/\s/g,"\\ ")).attr("name")}else{return""}}else{return this.m_focusEditBeforeClick}};i.prototype.GetSelText=function(){var M="";try{if(window.getSelection){if(document.activeElement&&document.activeElement.tagName&&(document.activeElement.tagName.toLowerCase()==="textarea"||document.activeElement.tagName.toLowerCase()==="input")){var L=document.activeElement.value;M=L.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var I=window.getSelection();M=I.toString()}}else{if(document.selection&&document.selection.createRange){var J=document.selection.createRange();M=J.text}}}catch(K){SiebelApp.S_App.CommToolbarUtil.Log(3,"commToolbarprender.js: get selected text failed!")}return M};i.prototype.GetCtrlData=function(I){return{ComboValue:this.CollectComboValue(),EditText:this.CollectEditText(),FocusEdit:this.GetFocusEditName(I),SelText:this.GetSelText()}};function l(){if($(this).data("hovered")||$(this).data("focused")){var I=$(this).attr("old-aria-label")!==undefined?$(this).attr("old-aria-label"):$(this).attr("aria-label");$(this).tooltip("enable").tooltip("open");var K=$(this).attr("aria-describedby");var J=$("#"+K).children().text();$(this).attr("aria-label",J).attr("old-aria-label",I);if($(this).data("focused")){$(this).triggerHandler("blur");$(this).triggerHandler("focus")}window.status=J}}function k(K,I){var L=K.data.ctx;var J=$(this).parent().next();if(J.css("display")==="none"){$(this).parent().siblings().has("div").hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",y.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));J.show().removeAttr("aria-hidden");$(this).attr("aria-label",y.GetLocalString("IDS_CTI_SIDEWAYBTN_HIDE_LABEL")).parent().next().attr("aria-expanded","true")}else{J.hide().attr({"aria-hidden":"true","aria-expanded":"false"});$(this).attr("aria-label",y.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"))}if(L.m_focusEditBeforeClick!==""&&!I){L.m_toolbarUI.find("#"+L.m_focusEditBeforeClick.replace(/\s/g,"_")).focus()}else{if(L.m_toolbarUI.hasClass("siebui-tb-cti-float")){$(this).focus()}}L.m_focusEditBeforeClick=""}function q(L,I){var N=L.data.ctx;var J=N.GetPM();var M=$(this).attr("name");if((new Date().getTime()-N.m_lastClickTime)<750){N.m_lastClickTime=new Date().getTime();return}N.m_lastClickTime=new Date().getTime();if($(this).hasClass("siebui-tb-cti-btn-img-enabled")){var K=N.GetCtrlData();K.SelText=N.m_sSelText;J.OnControlEvent("CommCommandBtnClicked",M,K,I);J.ExecuteMethod("ClearFocusInfo");J.ExecuteMethod("ApplySticky",$(this).attr("name"));if($(this).hasClass("siebui-tb-cti-child-btn")){$(this).parent().parent().hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",y.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));N.MoveTabIndex(false,$(this).attr("id"),true)}}if(N.m_toolbarUI.hasClass("siebui-tb-cti-float")&&!$(this).hasClass("siebui-tb-cti-child-btn")){$(this).focus()}SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Clicking ["+$(this).attr("name")+"]")}function n(L,I){var N=L.data.ctx;var J=N.GetPM();var M=$(this).attr("name");var K=N.GetCtrlData();K.SelText=N.m_sSelText;J.OnControlEvent("CommCommandBtnClicked",M,K,I);J.ExecuteMethod("ClearFocusInfo")}function j(J){var K=J.data.ctx;var I=K.GetPM();K.m_sSelText=K.GetSelText();K.m_focusEditBeforeClick=K.m_curFocusEditName;if($(this).hasClass("siebui-tb-cti-btn-img-enabled")&&J.which===1){$(this).addClass("commBtnClicked siebui-tb-cti-btn-img-clicked")}if(($(this).hasClass("siebui-tb-cti-parent-btn")||$(this).hasClass("siebui-tb-cti-child-btn")||$(this).hasClass("siebui-tb-cti-dropdown"))&&J.which===1){I.ExecuteMethod("CollectFocusInfo")}}function f(){$(this).removeClass("commBtnClicked siebui-tb-cti-btn-img-clicked")}function v(J){var L=J.data.ctx;var I=L.GetPM();$(this).data("hovered",true);var K=$(this).attr("name");I.ExecuteMethod("InvokeCommandToolTip",K,L.GetCtrlData(true))}function p(){$(this).data("hovered",false);if(!/msie|trident/.test(navigator.userAgent.toLowerCase())||!$(this).hasClass("siebui-tb-cti-dropdown")){$(this).tooltip("close").tooltip("disable")}$(this).removeClass("commBtnClicked siebui-tb-cti-btn-img-clicked");var I=$(this).attr("old-aria-label");if(I!==undefined){$(this).attr("aria-label",I).removeAttr("old-aria-label")}}function d(I){var J=I.data.ctx;if($(this).attr("tabindex")!=="0"){return}switch(I.which){case $.ui.keyCode.RIGHT:if($(this)[0].tagName.toUpperCase()!=="INPUT"){J.MoveTabIndex(true,$(this).attr("id"),true);I.preventDefault()}break;case $.ui.keyCode.LEFT:if($(this)[0].tagName.toUpperCase()!=="INPUT"){J.MoveTabIndex(false,$(this).attr("id"),true);I.preventDefault()}break;case $.ui.keyCode.SPACE:case $.ui.keyCode.ENTER:$(this).trigger("click",[true]);I.preventDefault();break;case $.ui.keyCode.TAB:if($(this)[0].tagName.toUpperCase()==="INPUT"){if(I.shiftKey){J.MoveTabIndex(false,$(this).attr("id"),true)}else{J.MoveTabIndex(true,$(this).attr("id"),true)}I.preventDefault()}break;default:break}}function b(K){var M=K.data.ctx;var L=$(this).attr("name");var J=M.m_EditBoxTextMap[L];var I=$.trim($(this).val());M.m_EditBoxTextMap[L]=I;if(!J&&I){w.call(M,L,M.GetCtrlData(true),true,"text changed from empty to non empty")}else{if(J&&!I){w.call(M,L,M.GetCtrlData(true),false,"text changed from non empty to empty")}}}function s(J){var L=J.data.ctx;var I=L.GetPM();if(J.which===119){var K=$(this).attr("name");I.ExecuteMethod("InvokeCommandToolTip",K,L.GetCtrlData(),true)}}function m(K){var M=K.data.ctx;$(this).data("focused",false);var L=$(this).attr("name");if($(this).hasClass("siebui-tb-cti-edit-box")){M.m_curFocusEditName="";if($.trim($(this).val())){var J=M.GetCtrlData(true);J.FocusEdit="";w.call(M,L,J,false,"focus lost when non empty")}}$(this).removeClass("commFocused siebui-tb-cti-btn-img-focused");var I=$(this);setTimeout(function(){I.tooltip("close").tooltip("disable");var N=I.attr("old-aria-label");if(N!==undefined){I.attr("aria-label",N).removeAttr("old-aria-label")}},100)}function e(I){var J=I.data.ctx;$(this).data("focused",true);if($(this).hasClass("siebui-tb-cti-edit-box")){J.m_curFocusEditName=$(this).attr("name");if($.trim($(this).val())){w.call(J,J.m_curFocusEditName,J.GetCtrlData(true),true,"focus gained when non empty")}}J.m_toolbarUI.find(".siebui-tb-cti-btn-img-focused").removeClass("commFocused siebui-tb-cti-btn-img-focused");
J.FocusControl($(this));$(this).addClass("commFocused siebui-tb-cti-btn-img-focused")}function C(I){var J=I.data.ctx;J.m_mouseupfromSelf=true}function r(I){var J=I.data.ctx;if($(this).text().length>0){J.MakeCallToUIPhone($(this).text(),$(this),J.m_bIsMakeCallPopupNeeded)}}function u(I){var J=I.data.ctx;if(J.m_timerId!==0){clearInterval(J.m_timerId);J.m_timerId=0;document.title=J.m_oldtitle}}i.prototype.BindEvents=function(){SiebelAppFacade.CommToolbarPhyRenderer.superclass.BindEvents.call(this);var J=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(!J){return}var N=".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-timer, .siebui-tb-cti-edit-box, .siebui-tb-cti-dropdown";var M=".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-dropdown, .siebui-tb-cti-timer";var K=this.m_toolbarUI;J.Manage(K,"ShowTooltipEvt",{},l,N).Manage(K,"click",{ctx:this},k,".siebui-tb-cti-sideway-poup-btn").Manage(K,"click",{ctx:this},q,".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn").Manage(K,"change",{ctx:this},n,".siebui-tb-cti-dropdown").Manage(K,"down",{ctx:this},j,M).Manage(K,"up",{ctx:this},f,M).Manage(K,"over",{ctx:this},v,N).Manage(K,"out",{ctx:this},p,N).Manage(K,"keydown",{ctx:this},d,"[tabindex]").Manage(K,"keyup",{ctx:this},b,".siebui-tb-cti-edit-box").Manage(K,"keypress",{ctx:this},s,M).Manage(K,"blur",{ctx:this},m,N).Manage(K,"focus",{ctx:this},e,N).Manage(K,"up",{ctx:this},C);var L=$("#s_toolbar").find("[name='Toggle CTI Toolbar']");if(L.length>0){this.RegisterControlBtn(L)}J.Manage($("#_sweview"),"click",{ctx:this},r,".siebui-ctrl-link-call-from-ui-enabled").Manage($(document),"up",{ctx:this},u).Manage($(document),"keydown",{ctx:this},u);var I=$("#CommunicationPanelContainer #commPanelCTIToggle");if(I.length>0){J.Manage(I,"click",{ctx:this},o);J.Manage(I,"keydown",{ctx:this},F)}};i.prototype.BindData=function(){SiebelAppFacade.CommToolbarPhyRenderer.superclass.BindData.call(this);this.GetPM().OnControlEvent("PostShow")};i.prototype.MakeCallToUIPhone=function(I,O,K){var J=this.GetPM();var M=this;if(K){var L=$("#comm_makecall_popup");if(L.length<=0){L=$('<div id="comm_makecall_popup"></div>');L.append("<div id='comm_makecall_popup_content' class='siebui-popup-cti-call-from-ui-text'></div>")}var N={};N[y.GetLocalString("IDS_CTI_CALL")]=function(){J.ExecuteMethod("CallContactFromUI",I,M.GetCtrlData());SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+I+"]");$(this).dialog("close");O.focus()};L.dialog({title:y.GetLocalString("IDS_CTI_PHONE_LABEL"),buttons:N,position:[O.offset().left+O.width()+10,O.offset().top+O.height()],dialogClass:"commMakeCallFromUIPopup siebui-popup-cti-call-from-ui",close:function(){O.focus()}});$("#comm_makecall_popup_content").html(I)}else{J.ExecuteMethod("CallContactFromUI",I,this.GetCtrlData());SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+I+"]")}};i.prototype.TriggerEvent=function(K,I){var J=K.replace(/\s/g,"\\ ");this.m_toolbarUI.find("#"+J).trigger(I)};i.prototype.RefreshControl=function(K,J){var L=K.m_id;var M;var I=this.m_toolbarUI.find("#"+L);if(I.length<=0){return}if(K.m_type==="button"){if(J==="state"){M=I.attr("src");if(M!==""){switch(K.m_state){case"enabled":M=K.m_image;I.attr("src",M).addClass("commBtnEnabled siebui-tb-cti-btn-img-enabled").removeClass("siebui-tb-cti-btn-img-disabled").removeAttr("aria-disabled").parent().addClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled").removeClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled");SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Enabled ["+K.m_name+"]");break;case"disabled":M=K.m_imgd;I.attr("src",M).addClass("siebui-tb-cti-btn-img-disabled").removeClass("commBtnEnabled siebui-tb-cti-btn-img-enabled").attr("aria-disabled","true").parent().removeClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled").addClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled");break}}I.attr({alt:H(K),"aria-label":H(K)}).removeAttr("old-aria-label")}else{if(J==="effect"){M=I.attr("src");if(M!==""){switch(K.m_effect){case"toggled":I.addClass("commBtnToggled siebui-tb-cti-btn-img-toggled").attr("aria-pressed","true").parent();break;case"untoggled":K.m_effect="";I.removeClass("commBtnToggled siebui-tb-cti-btn-img-toggled").parent();if(I.attr("aria-pressed")!==undefined){I.attr("aria-pressed","false")}break;case"blinking":I.addEffectForCommToolbar("blink");SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Blinking ["+K.m_name+"]");break;case"unblinking":K.m_effect="";I.addEffectForCommToolbar("stopblink");break}}I.attr({alt:H(K),"aria-label":H(K)}).removeAttr("old-aria-label")}else{if(J==="value"){if(K.m_bStatic){M=K.m_image}else{if(K.m_state==="enabled"){M=K.m_image}else{M=K.m_imgd}}if(M===""){I.attr("src",M).hide();if(I.attr("tabindex")==="0"){this.FocusControl(this.m_toolbarUI.find('img[tabindex][aria-disabled!="true"]:visible').first())}I.attr("aria-hidden","true")}else{I.attr("src",M).show().removeAttr("aria-hidden")}}}}}if(J==="tooltip"){I.tooltip("enable").attr("title",K.m_tooltip).tooltip("disable").trigger("ShowTooltipEvt")}};i.prototype.MoveTabIndex=function(K,M,L){var I;var J;I=this.m_mapNameToOrder[M];if(K){J=this.m_mapOrderToName[++I]}else{J=this.m_mapOrderToName[--I]}while(J!==undefined&&(($("#"+J).hasClass("siebui-tb-cti-child-btn")&&$("#"+J).parent().parent().css("display")==="none")||$("#"+J).css("display")==="none")){if(K){++I}else{--I}J=this.m_mapOrderToName[I]}if(J===undefined){return false}else{$("#"+M).attr("tabindex","-1");$("#"+J).attr("tabindex","0");if(L){$("#"+J).focus()}return true}};i.prototype.FocusControl=function(I){this.m_toolbarUI.find('[tabindex="0"]').attr("tabindex","-1");I.attr("tabindex","0")};i.prototype.UpdateHTMLControl=function(L,K,J){if(L===undefined||K===""){return}var M=L.m_id;switch(K){case"state":this.RefreshControl(L,"state");break;case"effect":this.RefreshControl(L,"effect");break;case"value":switch(L.m_type){case"edit":this.m_toolbarUI.find("#"+M).attr("value",L.m_value);break;case"combo box":this.m_toolbarUI.find("#"+M).empty();for(var I=0;I<J.length;I+=2){if(I+1<J.length){var N=$("<option></option>");N.append(J[I]).attr({value:J[I+1],role:"option"});this.m_toolbarUI.find("#"+M).append(N)}}break;case"button":this.RefreshControl(L,"value");break;default:break}break;case"starttimer":this.m_toolbarUI.find("#"+M).addEffectForCommToolbar("starttimer",{driverTime:J[0],serverTime:J[1]});break;case"stoptimer":this.m_toolbarUI.find("#"+M).addEffectForCommToolbar("stoptimer");break;case"changetooltip":this.RefreshControl(L,"tooltip");break;case"":break;default:break}};function H(I){var J;if(I.m_effect==="toggled"&&I.m_name.indexOf("Agent State")!==-1){J="Change To Ready. Enabled."}else{if(I.m_state==="enabled"&&I.m_name.indexOf("Agent State")!==-1){J="Change To Not Ready. Enabled."}else{if(I.m_effect!==""){J=I.m_effect}else{J=I.m_state}}}return I.m_name+". "+J}i.prototype.ShowStatusText=function(L,J){window.status=L;
var K=$("#CommunicationPanelContainer #CommPanelMessageCTI");if(K.length===0){K=$("#MsgLayer")}if(K.length>0){var I=K.attr("timerid");if(I>0){clearTimeout(I)}if(L.length>75){var M=L;L=L.substr(0,75)+"...";K.html('<span id="MessageSpan" class="CommStatusMessage siebui-tb-cti-status-msg" title="'+M+'" role="alert">'+L+"</span>")}else{K.html('<span id="MessageSpan" class="CommStatusMessage siebui-tb-cti-status-msg" role="alert">'+L+"</span>")}if(!this.GetPM().Get("InitFailed")){I=setTimeout(function(){K.html("")},J);K.attr("timerid",I)}}};i.prototype.ShowMessageWithAlert=function(I){utils.Alert(I)};i.prototype.FlashTitle=function(J){if(this.m_timerId===0){this.m_oldtitle=document.title;var K=this.m_oldtitle;var I=0;this.m_timerId=setInterval(function(){if(I%2===1){document.title=J}else{document.title=K}I++},1000)}};i.prototype.PlaySound=function(I){if(this.m_toolbarUI.find("#CommSounderWrapper").length>0){this.m_toolbarUI.find("#CommSounderWrapper").empty()}else{this.m_toolbarUI.append('<div id="CommSounderWrapper" style="visibility:hidden" aria-hidden="true"></div>')}this.m_toolbarUI.find("#CommSounderWrapper").append('<audio autoplay src="'+I+'"></audio>')};var D;var E;var a={DOCK:{next_status:["HIDDEN"],status_func:function(I,J){J.removeClass("floatToolbar siebui-tb-cti-float");J.removeClass("siebui-no-display");if(I.isBlink===true){I.isBlink=false;I.addEffectForCommToolbar("stopblink")}if(J.data("uiDraggable")!==undefined){J.draggable("option","disabled",true)}J.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},HIDDEN:{next_status:["DOCK","FLOAT"],status_func:function(I,J){if(J.hasClass("siebui-tb-cti-float")){D=J.offset();J.removeClass("floatToolbar siebui-tb-cti-float")}J.addClass("siebui-no-display");if(I.isBlink===true){I.addEffectForCommToolbar("blink")}J.attr({"aria-expanded":"false","aria-hidden":"true"})}},FLOAT:{next_status:["DOCK","HIDDEN"],status_func:function(I,K,J){K.removeClass("siebui-no-display");K.addClass("floatToolbar siebui-tb-cti-float");if(K.data("uiDraggable")===undefined){K.position({my:"left top",at:"right bottom",of:I,collision:"flipfit"});if($.ui.ddmanager){if($.ui.ddmanager.dragStart===undefined){$.ui.ddmanager.dragStart=function(){}}if($.ui.ddmanager.dragStop===undefined){$.ui.ddmanager.dragStop=function(){}}}K.draggable({containment:"window"});if(navigator.appName.indexOf("Microsoft")<0){K.mousedown(function(){if(I.status==="FLOAT"){var M=K.find('[tabindex="0"]').attr("id");var L=K.find(".siebui-tb-cti-edit-box");if(L.length>0){L.first().focus().blur()}if(!$("#"+M).hasClass("siebui-tb-cti-edit-box")){K.find("#"+M).focus()}}})}}else{K.offset(D);K.draggable("option","disabled",false)}if(I.isBlink===true){I.isBlink=false;I.addEffectForCommToolbar("stopblink")}K.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},UNKNOWN:{next_status:[],stauts_func:undefined}};i.prototype.CtrlBtnOp=function(Q,O,I){var L=$(SiebelApp.S_App.CommToolbar.GetPlaceholder());if(Q.status===undefined){if(L.css("display")==="block"){Q.status="DOCK"}else{if(L.css("display")==="none"){Q.status="HIDDEN"}else{SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: toolbar control display is: "+L.css("display"));Q.status="UNKNOWN"}}}var S=O;if(S==="TOGGLE"){if(Q.status==="DOCK"){S="HIDDEN"}else{S="DOCK"}}else{if(S==="HIDDEN_FLOAT"){if(Q.status!=="FLOAT"){return}else{S="HIDDEN"}}}var M=a[Q.status];if(M==="undefined"){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: unknown toolbar status: "+M);return}var J=M.next_status;for(var R=0,P=J.length;R<P;R++){var K=J[R];if(K===S){Q.status=S;var N=a[S];N.status_func(Q,L,I);return}}};i.prototype.BlinkParentBtn=function(){if(E===undefined||E.status===undefined){return}if(E.status==="HIDDEN"){E.isBlink=true;E.addEffectForCommToolbar("blink")}};i.prototype.StopBlinkCtrlBtn=function(){if(E===undefined){return}E.isBlink=false;if(E.status!=="Dock"){E.addEffectForCommToolbar("stopblink")}};function G(I){var J=I.data.ctx;J.CtrlBtnOp(I.data.ctrlButton,"TOGGLE");J.m_mouseupfromSelf=true}function g(I){var J=I.data.ctx;if(I.which===$.ui.keyCode.ENTER){J.CtrlBtnOp(I.data.ctrlButton,"TOGGLE")}}function x(I){var J=I.data.ctx;J.CtrlBtnOp(I.data.ctrlButton,"FLOAT",I)}function z(I){var J=I.data.ctx;if(J.m_mouseupfromSelf===false){J.CtrlBtnOp(I.data.ctrlButton,"HIDDEN_FLOAT")}J.m_mouseupfromSelf=false}function o(K){var I=$(K.target);var J=I.attr("id");K.preventDefault();if(J==="commPanelCTIToShowMore"){h(K,I)}else{if(J==="commPanelCTIToShowLess"){c(K,I)}}}function F(I){if(I.which===$.ui.keyCode.ENTER||I.which===$.ui.keyCode.SPACE){o(I)}}function c(L,J){var I=$("#CommunicationPanelContainer #commPanelCTIToShowMore");var K=$("#CommunicationPanelContainer #commPanelCTIToShowLess");if(I.length===0||K.length===0){return}var M=I.css("display")!=="none";if(M){return}else{I.show().attr("aria-hidden",false);K.hide().attr("aria-hidden",true);if(L&&J){I.focus()}t(L)}}function h(L,J){var I=$("#CommunicationPanelContainer #commPanelCTIToShowMore");var K=$("#CommunicationPanelContainer #commPanelCTIToShowLess");if(I.length===0||K.length===0){return}var M=K.css("display")!=="none";if(M){return}else{K.show().attr("aria-hidden",false);I.hide().attr("aria-hidden",true);if(L&&J){K.focus()}t(L)}}function t(I){var J=$("#CommunicationPanelContainer #CTIToolbar");if(J.length>0){J.toggleClass("siebui-comm-panel-less")}B.call(I.data.ctx,"CTIToolbar: Toggle")}function B(I){if($("#CommunicationPanelContainer").length>0){$(window).trigger("resize.commpanel",I)}}i.prototype.RegisterControlBtn=function(I){E=I;if(E.length===0){return}var J=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(!J){return}J.Manage(I,"up",{ctx:this,ctrlButton:E},G).Manage(I,"keydown",{ctx:this,ctrlButton:E},g).Manage(I,"over",{ctx:this,ctrlButton:E},x).Manage($(document),"up",{ctx:this,ctrlButton:E},z)};i.prototype.GotoCTIToolbar=function(){this.m_toolbarUI.find('[tabindex="0"]').focus()};i.prototype.HideCTIToolbar=function(){this.m_toolbarUI.addClass("forcehide");$("#CommunicationPanelContainer").find("#CommPanelHeaderCTI").addClass("forcehide");$("#CommunicationPanelContainer").find("#SS_ChatUI").addClass("forcehide")};i.prototype.UpdateCallContactFromUI=function(I){if(I){$(".siebui-ctrl-link-call-from-ui-disabled").removeClass("siebui-call-from-ui-disabled siebui-ctrl-link-call-from-ui-disabled").addClass("siebui-call-from-ui-enabled siebui-ctrl-link-call-from-ui-enabled")}else{$(".siebui-ctrl-link-call-from-ui-enabled").removeClass("siebui-call-from-ui-enabled siebui-ctrl-link-call-from-ui-enabled").addClass("siebui-call-from-ui-disabled siebui-ctrl-link-call-from-ui-disabled");try{var K=$("#comm_makecall_popup");if(K.length>0){K.dialog("close")}}catch(J){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+J)}}};i.prototype.OpenCallContactFromUIPopup=function(I,L){try{if(this.m_bIsMakeCallPopupNeeded){if(I.length>0){if(L===null||L===undefined){L=$(":focus").first()}this.MakeCallToUIPhone(I,L,true)
}else{var K=$("#comm_makecall_popup");if(K.length>0){K.dialog("close")}}}else{if(I.length>0){this.MakeCallToUIPhone(I,L,false)}}}catch(J){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+J)}};function w(M,K,L,J){if(this.m_EditPrevStatusMap[M]!==L){SiebelApp.S_App.CommToolbarUtil.Log(3,"Status Update for "+M+": "+J);var I=this.GetPM();I.ExecuteMethod("EditBoxStatusUpdate",M,K);I.ExecuteMethod("ClearFocusInfo");this.m_EditPrevStatusMap[M]=L}}function A(){var I=$("#siebui-toolbar-toggle-communication-panel").find("li[name='Toggle Communication Panel']");var J;if(I.length>0&&!I.hasClass("siebui-toolbar-toggle-communication-panel-notification")){J=(I.attr("data-initial-title")||"")+y.GetLocalString("IDS_COMM_PANEL_NOTIFICATION");I.addClass("siebui-toolbar-toggle-communication-panel-notification").attr("aria-label",J).attr("title",J)}}(function(K){function I(O){var N=Math.floor(O/1000);var L=Math.floor(N/3600);N-=L*3600;var M=Math.floor(N/60);N-=M*60;if(L<10){L="0"+L}if(M<10){M="0"+M}if(N<10){N="0"+N}return L+":"+M+":"+N}var J={blink:function(M){var N={delay:500,opacity:1};var L=K.extend(N,M);return this.each(function(){var O=K(this);if(O.attr("timerid")>0){clearInterval(O.attr("timerid"))}var P=setInterval(function(){if(O.css("opacity")==="1"){O.animate({opacity:0},L.delay/2,"",function(){if(O.attr("timerid")==="0"){O.css("opacity",L.opacity===1?1:0)}})}else{O.animate({opacity:1},L.delay/2)}},L.delay);O.attr("timerid",P)})},stopblink:function(M){var N={opacity:1};var L=K.extend(N,M);return this.each(function(){var O=K(this);if(O.attr("timerid")>0){clearInterval(O.attr("timerid"));O.attr("timerid",0);O.stop();O.css("opacity",L.opacity===1?1:0)}})},starttimer:function(M){var N={delay:1000};var L=K.extend(N,M);return this.each(function(){var R=K(this);var Q=L.driverTime*1000;var O=L.serverTime*1000;var T=new Date();var P=new Date().getTime()-T.getTime()+O-Q;R.text(I(P));if(R.attr("timerid")>0){clearInterval(R.attr("timerid"))}var S=setInterval(function(){P=new Date().getTime()-T.getTime()+O-Q;R.text(I(P))},L.delay);R.attr("timerid",S)})},stoptimer:function(){return this.each(function(){var L=K(this);L.text("00:00:00");if(L.attr("timerid")>0){clearInterval(L.attr("timerid"));L.attr("timerid",0)}})}};K.fn.addEffectForCommToolbar=function(L){if(J[L]){return J[L].apply(this,Array.prototype.slice.call(arguments,1))}}}(jQuery));return i}());return"SiebelAppFacade.CommToolbarPhyRenderer"})};