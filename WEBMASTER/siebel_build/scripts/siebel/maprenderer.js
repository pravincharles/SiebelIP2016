/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET8 */
if(typeof(SiebelAppFacade.MapPhyRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.MapPhyRenderer");define("siebel/maprenderer",[window.location.protocol+"//elocation.oracle.com/elocation/jslib/oracleelocation.js",window.location.protocol+"//elocation.oracle.com/mapviewer/fsmc/jslib/oraclemaps.js","siebel/phyrenderer"],function(){SiebelAppFacade.MapPhyRenderer=(function(){var I=SiebelJS.Dependency("SiebelApp.Utils");var x=SiebelJS.Dependency("SiebelApp.Constants");var B=x.get("SWE_PST_BUTTON_CTRL");var C=x.get("SWE_CTRL_MVG");var E=x.get("SWE_CTRL_RADIO");var v=x.get("SWE_CTRL_CHECKBOX");var H=x.get("SWE_CTRL_CHART");var G=x.get("SWE_CTRL_PLAINTEXT");var q=x.get("SWE_CTRL_TEXT");var m=x.get("SWE_CTRL_RTCEMBEDDED");var y=x.get("SWE_CTRL_URL");var D=x.get("SWE_CTRL_MAILTO");var o=x.get("SWE_CTRL_IMAGECONTROL");var e="SiebelMap_Menu";var f={};var w;var t={};function z(L){SiebelAppFacade.MapPhyRenderer.superclass.constructor.call(this,L);var K;this.SetMapView=function(M){K=M};this.GetMapView=function(){return K}}function j(){var L=window.location.protocol+"//elocation.oracle.com/mapviewer";var K=this.GetPM();this.SetMapView(new MVMapView(document.getElementById(K.Get("GetPlaceholder")),L));this.GetMapView().addBaseMapLayer(new MVBaseMap("elocation_mercator.world_map"),d(this))}function d(){var K=20;var M=0;var O=1;var L=arguments[0];if(!L){L=this}var N=MVSdoGeometry.createPoint(M,K,8307);L.GetMapView().setCenter(N);L.GetMapView().setZoomLevel(O);L.GetMapView().addNavigationPanel("EAST");L.GetMapView().setLoadingIconVisible()}function u(M){var K=/^\s*lon lat:\s*-?((\d\d*\.\d*)|(\d\d*)|(\.\d\d*))\s*-?((\d\d*\.\d*)|(\d\d*)|(\.\d\d*))\s*$/;if(M&&K.test(M)){var L=M.indexOf("lon lat:");M=M.substr(L+"lon/lat:".length).replace(/^\s+|\s+$/,"");L=M.indexOf(" ");return{lon:M.substr(0,L),lat:M.substr(L)}}else{return M}}function k(){w=new OracleELocation(window.location.protocol+"//elocation.oracle.com/elocation");var K=this;f={};var M=this.GetPM(),L=s.call(this),R=p.call(this),P=M.Get("GetRowsSelectedArray"),O=$("#"+M.Get("GetPlaceholder")),Q="<span class='"+M.Get("SelectedRowImage")+"' />",N="<span class='"+M.Get("UnselectedrowImage")+"' />",K=this;$.each(L,function(T,S){w.geocode(u(S),function(V,U){if(V.length==0){SiebelJS.Log("No address is found! "+U)}else{if(V.length==1){var W=V[0];if(W.accuracy<1){SiebelJS.Log("No address is found! "+U)}else{icon=P[T]===true?Q:N;selected=P[T]===true?true:false;f[T]=W;a.call(K,W,T,icon,selected)}}else{SiebelJS.Log("Multiple addresses are found! "+U)}}})});this.GetMapView().display()}function l(){this.GetMapView().removeAllFOIs();f={}}function n(M,K){var L=f[M];if(L.accuracy<3){this.GetMapView().setCenterAndZoomLevel(K,10)}else{if(L.accuracy==3){this.GetMapView().setCenterAndZoomLevel(K,7)}else{if(L.accuracy==4){this.GetMapView().setCenterAndZoomLevel(K,6)}else{if(L.accuracy==5){this.GetMapView().setCenterAndZoomLevel(K,5)}else{this.GetMapView().setCenterAndZoomLevel(K,4)}}}}}function F(L,N){$(this).hide();var K=L.data.ctx;if(N&&N.item){if(N.item.children().attr("tag")=="SelectRecord"){r.call(K,t.id)}else{if(N.item.children().attr("tag")=="ViewDetails"){var O=A.call(K,t.id);var M=J.call(K,t.id);$(K.GetPM().Get("ListDetail")).dialog("option","title",M).dialog("open")}}}return true}function h(){var K=arguments[1].id;t=arguments[1];$("#"+e).show().position({my:"center top+15",at:"center bottom",of:$(t.node),collision:"flip flip"});setTimeout(function(){$("#"+e).hide()},5000)}function a(P,L,R,N){var T=this;var M=T.GetPM();var K=MVSdoGeometry.createPoint(P.x,P.y,8307);var O=MVFOI.createHTMLFOI(L.toString(),K,R);O.enableInfoWindow(false);O.enableInfoTip(true);O.enableEventPropagation(true);this.GetMapView().enableInfoWindowEventPropagation(true);var S=J.call(this,L);O.setInfoTip(S);var Q=L;O.attachEventListener(MVEvent.MOUSE_CLICK,h);this.GetMapView().removeFOI(L.toString());this.GetMapView().addFOI(O);if(N){n.call(T,L,O.geom);O.setZIndex(999);O.reDraw()}}function s(){var N=this.GetPM(),M=N.Get("markerLocation"),O=N.Get("GetRawRecordSet"),Q=[];if(!I.IsEmpty(M)){for(var L=0,K=O.length;L<K;L++){var P=O[L][M];Q.push(P)}}return Q}function p(){var M=this.GetPM(),Q=M.Get("markerTitle"),O=M.Get("GetRawRecordSet"),N=[];if(!I.IsEmpty(Q)){for(var L=0,K=O.length;L<K;L++){var P=O[L][Q];if(!I.IsEmpty(P)){N.push(P)}}}return N}function J(K){var L=this.GetPM(),N=L.Get("markerTitle"),M=L.Get("GetRawRecordSet"),O=M[K][N];return O}function A(L){var K=this;var M=$(K.GetPM().Get("ListDetail"));c.call(K,L);$("input",M).attr("readonly",true)}function b(M,O){var U=!O?0:O,L=this.GetPM(),K=M.GetName(),N=M.GetFieldName(),T=L.Get("IsInQueryMode"),Q=L.Get("IsPure"),P=L.ExecuteMethod("IsPrivateField",K);if(!I.IsEmpty(N)||P||!Q){var S="";if(T||P||!Q){if(!T||!Q){if(O===undefined||O===null){S=L.ExecuteMethod("GetFormattedFieldValue",M,false)}else{S=L.ExecuteMethod("GetFormattedFieldValue",M,true,U)}}else{var R=L.Get("GetRecordSet");S=I.IsEmpty(R[U][N])?"":R[U][N]}}else{if(O===undefined||O===null){S=L.ExecuteMethod("GetFormattedFieldValue",M,true)}else{S=L.ExecuteMethod("GetFormattedFieldValue",M,true,U)}}if(Q||(!Q&&M.GetUIType()!==B)){this.SetControlValue(M,S,0)}}}function c(L){var N=this.GetPM(),O=N.Get("ListOfColumns"),K=O.length;for(var M=0;M<K;M++){b.call(this,O[M].control,L)}}function r(M){var K=this.GetPM(),L=self;if(Number(M)===Number(K.Get("GetSelection"))){return true}SiebelApp.S_App.uiStatus.Busy({});if(!K.OnControlEvent(x.get("PHYEVENT_SELECT_ROW"),M,"","")){SiebelApp.S_App.uiStatus.Free();return false}SiebelApp.S_App.uiStatus.Free();return true}function g(){$(this.GetPM().Get("ListDetail")).dialog({modal:true,appendTo:"#s_"+this.GetPM().Get("GetFullId")+"_div",autoOpen:false,title:"",close:function(){$(this).hide()}})}SiebelJS.Extend(z,SiebelAppFacade.PhysicalRenderer);z.prototype.Init=function(){var K=this;g.call(this);SiebelAppFacade.MapPhyRenderer.superclass.Init.call(K)};z.prototype.ShowSelection=function(S){var L=this.GetPM(),U=$("#"+L.Get("GetPlaceholder")),T=L.Get("GetRowsSelectedArray"),R="<span class='"+L.Get("SelectedRowImage")+"' />",N="<span class='"+L.Get("UnselectedrowImage")+"' />";if(!this.GetMapView()){return}var O=this.GetMapView().getAllFOIs();var K=false;if(O.length<1){return}SiebelApp.S_App.uiStatus.Busy({});for(var M=0,Q=T.length;M<Q;M++){var P=this.GetMapView().getFOI(M.toString());if(T[M]===true){if(P){P.setHTMLElement(R,0,0);n.call(this,M,P.geom);P.setZIndex(999);P.reDraw();K=true}}else{if(P){P.setHTMLElement(N,0,0);P.setZIndex(500);P.reDraw()}}}if(!K){d.call(this)}SiebelApp.S_App.uiStatus.Free({})};z.prototype.ShowUI=function(){SiebelAppFacade.MapPhyRenderer.superclass.ShowUI.call(this);g.call(this);var N=this.GetPM(),P=N.Get("GetPlaceholder"),M=$("#"+P);htmlmarkupstr="<div class = 'siebui-map' ><div style='width: 100%; height: 100%' id = '"+P+"'></div></div>";M.replaceWith(htmlmarkupstr);j.call(this);var K=SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_MAP_MENU_SELECT_RECORD");var O=SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_MAP_MENU_DISPLAY_INFO");
var L=" <ul id='"+e+"' style='z-index:99'  ><li><a href='#' class='siebui-menu-details' tag='ViewDetails' >"+O+"</a></li><li><a href='#' class='siebui-menu-select' tag='SelectRecord' >"+K+"</a></li></ul>";$("#"+N.Get("GetPlaceholder")).append(L);$("#"+e).menu({}).css({position:"absolute",zIndex:99}).hide().bind("menuselect",{ctx:this},F)};z.prototype.BindData=function(N){var K=this.GetPM(),M=$("#"+K.Get("GetPlaceholder")),L=K.Get("IsInQueryMode");if(N){l.call(this);d.call(this)}if(L){this.GetMapView().display();return}k.call(this)};function i(K){return(typeof(K.GetInputName)==="function")}z.prototype.EndLife=function(){var K=this.GetPM(),L=$("#"+K.Get("GetPlaceholder"));l.call(this);delete this.GetMapView();delete w;delete f;SiebelAppFacade.MapPhyRenderer.superclass.EndLife.call(this)};return z}());return SiebelAppFacade.MapPhyRenderer})};