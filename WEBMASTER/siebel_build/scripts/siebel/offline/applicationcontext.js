/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET11 */
if(SiebelApp.S_App){define("siebel/offline/applicationcontext",[],function(){(function(){var l=SiebelApp.S_App.constructor;var d=SiebelApp.Offlineconstants;var f=SiebelApp.OfflineAppSettings;var o=SiebelApp.S_App;var e=o.Model;var k=SiebelJS.Dependency("SiebelApp.Constants");var q=SiebelJS.Dependency("SiebelApp.Utils");var p=window.localStorage;var g=SiebelApp.OfflineUtils;var m=SiebelApp.S_App.OfflineLocaleObject;var b=null;var c={};var j={};var n={};var h;j.InitExecContext=o.InitExecContext;j.AppendToStrCache=o.AppendToStrCache;j.ClearBusObj=o.ClearBusObj;j.GetService=o.GetService;j.GotoView=o.GotoView;j.InitializeBO=o.InitializeBO;j.CallServer=o.CallServer;j.OnLoadViewContainer=o.OnLoadViewContainer;l.prototype.isGotoview=false;l.prototype.isNewRecord=false;o.constructor.prototype.IsEditRecord=false;var r=new Date();r.setTime(r.getTime()+(-1*24*60*60*1000));document.cookie="|sameuisession|=1;expires=Thu, 01 Jan 0000 00:00:00 GMT;";l.prototype.GetPrevViewBCList=function(){return h};l.prototype.SetPrevViewBCList=function(s){h=s};n.CallServer=function(s,y,x,t){var w=t.async;var v=false;if(typeof(t.cb)==="function"){var u=t.cb;t.cb=function(){u.apply(this,arguments);if(y.GetProperty("Status")===k.get("SWE_RPC_PROP_STATUS_ERROR")){if(t.scope&&t.scope.SetErrStatus){this.SetErrStatus(true)}v=true}$.setReturnValue({err:v,retVal:y})}}else{t.cb=function(){if(y.GetProperty("Status")===k.get("SWE_RPC_PROP_STATUS_ERROR")){if(t.scope&&t.scope.SetErrStatus){this.SetErrStatus(true)}v=true}$.setReturnValue({err:v,retVal:y})}}j.CallServer.call(this,s,y,x,t)};n.InitializeBO=function(v){var u=v.GetChild(0).GetProperty("boexist");if(u||v.GetChild(0).GetProperty("keepBO")){var w=this.GetActiveBusObj();var s=this.GetActiveView();if(u){if(s){this.ClearMainView();this.ClearBusObj(false)}var t=SiebelApp.OfflineAppMgr.GetPostedAction().BusObj;this.SetActiveBusObj(t);var x=this.GetActiveBusObj();x.ProcessChildObjInfo(v.GetChild(0));return}if(w&&s&&s.GetBusObj()===w){this.ClearMainView();this.ClearBusObj(true)}w.ProcessObjectInfo(v.GetChild(0))}else{j.InitializeBO.call(this,v)}};n.GotoView=function(w,x,t,z,v,y){if(this.GetDiscardUserState()||v){return(j.GotoView.call(this,w,x,t,z,v,y))}else{var s=this.CanLeaveMainView();if(window.localStorage.getItem("reload")&&JSON.parse(window.localStorage.getItem("reload"))&&window.localStorage.getItem("view")){w=window.localStorage.getItem("view");if(!q.IsEmpty(t)){var u=q.DecodeFromQueryString(t);u.SetProperty(k.get("SWE_VIEW_ARG"),w);t=u.EncodeAsString()}}var A=function(){var D=SiebelApp.S_App.GetActiveView().GetActiveApplet();var B=D.HasPendingCommit(null,true);var C=D.GetBusComp().IsDeletePending();if(!B&&!C){j.GotoView.call(this,w,x,t,z,v,y)}};if(s){return(j.GotoView.call(this,w,x,t,z,v,y))}else{$.callback(this,A)}}};l.prototype.BuildView=function(s,t,w,v,u){e.IsMetadataInitialized();g.CcfLogEvent([d.get("LOG_EVT_CLIENT_SYS"),54,8,29,v]);$.callback(this,function(x){if(!x.err){SiebelApp.BrowserCacheMgr.DiscoverMetadata(s,"",t,v,u);$.callback(this,function(z){if(!z.err){var y=z.retVal;if(t===d.get("GOTOVIEWCOLD")){y=SiebelApp.OfflineAppMgr.PrepareWriteRecordResponse(y)}$.setReturnValue({err:z.err,retVal:y})}else{$.setReturnValue(z)}})}else{$.setReturnValue({err:true,retVal:""})}})};var a=j.InitExecContext;n.InitExecContext=function(t){var s=window.localStorage,u=s.getItem("SRN");s.setItem("reload",true);t.GetChild(0).SetPropertyStr("SRN",u);a.call(this,t)};j.InitExecContext=function(s){a.call(this,s);if(f.CheckSameDownloadCond(s.GetChild(0))){var t=SiebelApp.S_App.GetSRN();p.setItem("SRN",t)}};l.prototype.LookupSCIndex=function(t){var v="";var s=o.GetStringCache().length;var u;for(u=0;u<s;u++){v=o.GetStringCache()[u];if(t===v){return u}}return -1};n.AppendToStrCache=function(w){if(w&&w!==""){var u=[];var t=o.GetStringCache().length;CCFMiscUtil_StringToArray(w,u);var s=u.length;for(var v=0;v<s;v++){i.call(this,t+v,u[v])}}j.AppendToStrCache.call(this,w)};function i(t,s){if(s&&s!==""){if(c){c[s]=t}}}l.prototype.ActiveViewName=function(){return SiebelApp.S_App.GetActiveView().GetName()};l.prototype.ActiveBusObject=function(){return SiebelApp.S_App.GetActiveBusObj()};l.prototype.FindApplet=function(s){return SiebelApp.S_App.GetActiveView().GetApplet(s)};l.prototype.LoginId=function(){return SiebelApp.S_App.Model.GetLoginId()};l.prototype.LoginName=function(){return SiebelApp.S_App.Model.GetLoginName()};l.prototype.Name=function(){return SiebelApp.S_App.GetName()};l.prototype.NewPropertySet=function(){return CCFMiscUtil_CreatePropSet()};l.prototype.PositionId=function(){return SiebelApp.S_App.Model.GetPositionId()};l.prototype.PositionName=function(){return SiebelApp.S_App.Model.GetPositionName()};l.prototype.CurrencyCode=function(){return SiebelApp.S_App.Model.GetCurrencyCode()};l.prototype.GetBusObject=function(s){return SiebelApp.S_App.Model.GetBusObj(s)};l.prototype.LookupSCMap=function(s){if(c){return c[s]}return""};l.prototype.GetOfflineMode=function(){return SiebelApp.OfflineAppSettings.GetMode()};n.ClearBusObj=function(y){if(y){var s,u;var t=this.GetActiveBusObj();if(t){var z=t.GetBCMap();h=[];for(var x in z){if(z.hasOwnProperty(x)){if(z[x]&&z[x].GetNotifyObject()){var w=z[x].GetNotifyObject();u=w.GetAppletRegistry();s=u.length;for(var v=0;v<s;v++){w.DeRegister(u[0])}}h.push(z[x])}}}}else{j.ClearBusObj.call(this)}};n.GetService=function(v){var x=SiebelApp.S_App.Model.GetIsInterFace();if(x>0){var u={};var w;var s;var t;u[d.get("DOUIREG_OBJ_NAME")]=v;if(!v){return(null)}w=e.RegistryLookup(u);if(w){if(w.length>1){t=w[1]}else{t=w[0]}if(typeof(SiebelApp[t.Service])==="function"){s=new SiebelApp[t.Service]();return(s)}}else{return(null)}}else{return(j.GetService(v))}};l.prototype.OnLoadViewContainer=function(){var s;if(!b){try{var t=function(){};var v=new t();v.GetName=function(){return"DMToolbarPxy"};b=new SiebelAppFacade.DMToolbarPModel(v);s=CCFMiscUtil_CreatePropSet();s.SetProperty("SWE_OUI_RENDERER","DMToolbarRenderer");b.Init();b.Setup(s.Clone());b.Show()}catch(u){SiebelJS.Log("Error -> DMToolbar creation failed  :"+u.message);SiebelJS.Log(u)}}j.OnLoadViewContainer.apply(this,arguments)};l.prototype.GetModel=function(){return o.ModelInterface};l.prototype.GetLastErrCode=function(){return o.OfflineErrorObject.GetErrorCode()};l.prototype.GetLastErrText=function(){return o.OfflineErrorObject.GetErrorText()};l.prototype.UpdateSyncStatus=function(s){if(b){b.ExecuteMethod("SyncUpdate",s)}};l.prototype.InitiateSync=function(){if(b){b.ExecuteMethod("InitiateSync")}};l.prototype.OfflineCallServer=function(v,E,s,C){var D;if(SiebelApp.SyncThreadHandler.SyncInProgress()){D=m.GetLocalString("SSASqlErrTrxInProgress");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D);return false}if(!SiebelApp.BrowserCacheMgr.GetBrowserStorage()){D=m.GetLocalString("IDS_DOUI_ERR_INSUFFICIENT_MEMORY");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D);return false}if(!q.IsEmpty(SiebelApp.S_App.Model.GetLoginName())&&SiebelApp.S_App.Model.GetLoginName()!==SiebelApp.S_App.GetUserName()){D=m.GetLocalString("IDS_DOUI_ERR_UNAUTH_USER");
SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D);return false}if(!SiebelApp.OfflineAppSettings.GetMode()){if(navigator.onLine){var w=SiebelApp.OfflineAppMgr.Ping();if(w){if(SiebelApp.S_App.GetTimer()){var u=JSON.parse(window.localStorage.getItem(k.get("SWE_PERF_LOG_DATA")));if(u){var B=this;var t=SiebelApp.S_App.GetPageURL();var A=SiebelApp.S_App.GetSRN();t=t+"?SWECmd=InvokeMethod&SWEMethod=WritePerfLog&SRN="+A;var x=""+k.get("SWE_PERF_LOG_DATA")+"="+URLEncode(u);$.ajax({type:"POST",url:t,data:x,processData:false,complete:function(F,J,G){if(J!=="error"){window.localStorage.removeItem(k.get("SWE_PERF_LOG_DATA"));SiebelApp.S_App.InitiateSync.call(B)}else{if(SiebelApp.OfflineAppSettings.GetPkgStatus()){SiebelApp.OfflineAppSettings.OnSuccessfulDataDownload();SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),21,13,84]);var I=window.location;I.replace(I.origin.concat(I.pathname));return false}else{var H=m.GetLocalString("IDS_DOUI_ERR_SYNC");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,H]);alert(H);return false}}}})}else{SiebelApp.S_App.InitiateSync.call(this)}}else{SiebelApp.S_App.InitiateSync.call(this)}}else{return false}}else{if(SiebelApp.OfflineAppSettings.GetPkgStatus()){SiebelApp.OfflineAppSettings.OnSuccessfulDataDownload();SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),40,13,84]);var z=window.location;z.replace(z.origin.concat(z.pathname));return false}else{D=m.GetLocalString("IDS_DOUI_ERR_OFFLINE_PKG");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D);return false}}}else{if(navigator.onLine){var y=SiebelApp.OfflineAppMgr.Ping();if(y){if(SiebelApp.OfflineAppSettings.GetSyncStatus()||f.GetSyncType()===d.get("SYNC_TYPE_UPSYNC_ISYNC")){SiebelApp.S_App.InitiateSync();return true}else{if(!f.IsBatchMode()||f.GetSyncType()===d.get("SYNC_TYPE_GOONLINE")){SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),46,13,84]);SiebelApp.ProactiveCacheBuilder.ProcessGoOnline();return false}else{SiebelApp.S_App.UpdateSyncStatus("NoStatus")}}}else{SiebelApp.S_App.UpdateSyncStatus("FullDownLoadFailed");return false}}else{if(SiebelApp.OfflineAppSettings.GetSyncStatus()){D=m.GetLocalString("IDS_DOUI_ERR_NETWORK_CONN");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D)}else{D=m.GetLocalString("IDS_DOUI_ERR_INTERN_CONN");SiebelApp.OfflineUtils.CcfLogEvent([d.get("LOG_EVT_COMMON"),27,13,84,D]);alert(D)}SiebelApp.S_App.UpdateSyncStatus("FullDownLoadFailed");return false}}};SiebelApp.OfflineUtils.DefineExtentions(l,n,j);l.prototype.LogOfflineEvent=function(t){if(t){var s=SiebelApp.Offlineconstants.get("LOG_EVT_COMMON"),v=[s,t],u=[];if(arguments.length>1){u=Array.prototype.slice.call(arguments,1)}v=v.concat(u);SiebelApp.OfflineUtils.CcfLogEvent(v)}};l.prototype.LoadMafResources=function(){var u=this;if(window.localStorage&&!(window.localStorage.getItem("ResetApp"))){window.localStorage.setItem("ResetApp","true")}function v(A,x){var C=u.GetService(k.get("SWE_OUI_CLIENT_PREF_SERVICE"));if(!q.IsEmpty(C)){var w=SiebelApp.S_App.NewPropertySet();var z="N",B="N",D="N",E="",y="N";if(window.localStorage&&window.sessionStorage.getItem("isEligible")=="1"){z="Y"}if(window.localStorage&&window.localStorage.getItem("isCompatibility")=="false"){B="Y"}if(window.localStorage&&window.localStorage.getItem("isAdfmContainer")=="1"){y="Y"}E=(window.localStorage&&window.localStorage.getItem("SyncNodeId"))?window.localStorage.getItem("SyncNodeId"):"";if(A&&!E){D="Y"}if(!A){A=E}w.SetProperty("isEligible",z);w.SetProperty("isAdfmContainer",y);w.SetProperty("isMultiApp",B);w.SetProperty("isReuse",D);w.SetProperty("SyncNodeId",A);C.InvokeMethod("SetMafCapability",w,{npr:false,async:true,cb:function(F,H,I){var G="",J="";if(I&&I.GetChild("0")){G=I.GetChild("0").GetProperty("SyncNodeId");J=I.GetChild("0").GetProperty("BatchMode")}SiebelJS.Log("Set sync node..."+G);if(G&&window.localStorage){window.localStorage.setItem("SyncNodeId",G)}if(J&&window.localStorage){window.localStorage.setItem("BatchMode",J)}if(x){x(G)}}})}}if(window.localStorage&&window.localStorage.getItem("isAdfmContainer")=="1"&&window.localStorage.getItem("isCompatibility")=="false"&&!window.localStorage.getItem("SyncNodeId")){function t(w){var x=(window.sessionStorage&&window.sessionStorage.getItem("userloc"))?window.sessionStorage.getItem("userloc"):"";adf.mf.api.invokeMethod("com.oracle.determinations.mobile.application.SyncNodes","setSyncNodeId",x,w,function(z,y){SiebelJS.Log("Store sync node identity successfully."+w)},function(z,y){if(window.localStorage){var A="SyncNodeId";window.localStorage.removeItem(A);A="BatchMode";window.localStorage.removeItem(A)}SiebelJS.Log("Failed to store sync node identity.")})}var s=function(){SiebelJS.Log("Getting sync node ...");var w=(window.sessionStorage&&window.sessionStorage.getItem("userloc"))?window.sessionStorage.getItem("userloc"):"";adf.mf.api.invokeMethod("com.oracle.determinations.mobile.application.SyncNodes","getSyncNodeId",w,function(y,x){v(x,t)},function(y,x){})};if(adf.mf.api.invokeMethod){s()}else{document.addEventListener("showpagecomplete",function(){s()},false)}}else{v()}}}())})};