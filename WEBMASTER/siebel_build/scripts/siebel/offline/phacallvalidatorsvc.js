/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET7 */
if(typeof(SiebelApp.PharmaCallValidatorsvc)==="undefined"){SiebelJS.Namespace("SiebelApp.PharmaCallValidatorsvc");define("siebel/offline/PharmaCallValidatorsvc",["siebel/offline/model","siebel/offline/servicemodel"],function(){var e=0;var u=0;var c=false;var n=false;var w=[];var t={};var r={};var l=true;var o=true;var a="";var s=true;var f=[];var g=1;var v=6;var q=1;var b=2;var i=4;var h=[];var d;var m;var p;var x;var j=SiebelApp.Offlineconstants;var k={};k[j.get("DOUIREG_OBJ_NAME")]="LS Pharma Validation Service";k[j.get("DOUIREG_SRVC_NAME")]="PharmaCallValidatorsvc";SiebelApp.S_App.Model.ServiceRegistry(k);SiebelApp.PharmaCallValidatorsvc=(function(){var ar=SiebelJS.Dependency("SiebelApp.Utils");function H(){SiebelApp.PharmaCallValidatorsvc.superclass.constructor.call(this)}SiebelJS.Extend(H,SiebelApp.ServiceModel);H.prototype.CanInvokeMethod=function(au){if(au==="CallValidate"){$.setReturnValue({err:false,retVal:true});return}else{if(au==="CanAddSample"){$.setReturnValue({err:false,retVal:true});return}else{return SiebelApp.PharmaCallValidatorsvc.superclass.CanInvokeMethod.call(this,au)}}};H.prototype.InvokeMethod=function(ay,ax){var aw=CCFMiscUtil_CreatePropSet();if(!ay){$.setReturnValue({err:false,retVal:false});return}if(ay==="CallValidate"){h=[];var av=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp();this.ExecuteAllBCs(av);$.callback(this,function(aA){var az=aA.err;if(az!==true){this.CallValidate(ax);$.callback(this,function(aB){aw=aB.retVal;this.CleanUp();$.setReturnValue({err:false,retVal:aw});return})}})}else{if(ay==="CanAddSample"){var au=this.GetContext().GetBusComp().GetParentBusComp();if(au&&au.CheckActiveRow()===true){ak.call(this,ax);$.callback(this,function(az){$.setReturnValue({err:az.err,retVal:az.retVal});return})}}else{return SiebelApp.PharmaCallValidatorsvc.superclass.InvokeMethod.call(this,ay,ax)}}};function D(au){var av=function(){au.DeleteRecord();$.callback(this,function(){if(au.GetWS().length>0){av.call(this)}})};if(au.CheckActiveRow()===true){av.call(this)}}H.prototype.ExecuteAllBCs=function(aH){var aC=[];d=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var av=d.GetBusComp("Pharma Attendee Call Mobile");var aD=d.GetBusComp("Pharma Call Products Detailed");var aI=d.GetBusComp("Pharma Promotional Items Dropped");var au=d.GetBusComp("Pharma Call Sample Dropped");var aA=d.GetBusComp("LS Pharma Call Validation Results");var aF=d.GetBusComp("LS PCD Presentation Details BC");p=SiebelApp.S_App.Model.GetBusObj("Contact");var ax=p.GetBusComp("Pharma Professional State Licenses");var aE=p.GetBusComp("Pharma Address Inter Table - CE");var aB=p.GetBusComp("Contact");var aG=d.GetBusComp("Employee");x=SiebelApp.S_App.Model.GetBusObj("Account");var az=x.GetBusComp("CUT Address - CE");var aw=[];var ay=0;aH.FieldValue("Id");$.callback(this,function(aK){var aJ=aK.retVal;aH.FieldValue("Category");$.callback(this,function(aL){var aM=aL.retVal;aH.FieldValue("Contact Id");$.callback(this,function(aO){var aN=aO.retVal;am(aH);$.callback(this,function(aP){var aQ=aP.retVal;aH.FieldValue("Contact Address Id");$.callback(this,function(aS){var aR=aS.retVal;aH.FieldValue("Account Address Id");$.callback(this,function(aU){var aT=aU.retVal;aH=d.GetBusComp("Pharma Professional Call - Mobile");aH.SetFldSearchSpec("Id",aJ);aH.Execute();$.callback(this,function(aV){aH.Home();$.callback(this,function(a6){if(aH&&!ar.IsEmpty(aH)){h.push(aH)}var bh=function(){au.ActivateField("Activity Id");au.ActivateField("Lot Name");au.ActivateField("Parent Inventory Flag");au.ActivateField("Parent Lots Defined Flag");au.ActivateField("Cutoff Date");au.ActivateField("Call Date");au.ActivateField("Max Per Call");au.ActivateField("Max Per Allocation");au.ActivateField("Sum Qty Alloc");au.ActivateField("Stop Sampling Flag");au.ActivateField("Controlled Substance");au.SetFldSearchSpec("Activity Id",aJ)};var a3=function(){h.push(au)};var be=function(){aA.ActivateField("Object Id");aA.ActivateField("Object Type");aA.ActivateField("Rule Number");aA.ActivateField("Message Type");aA.ActivateField("Message Type LIC");aA.ActivateField("Message");aA.ActivateField("Call Id");aA.SetFldSearchSpec("Call Id",aJ)};var a1=function(){h.push(aA)};var bc=function(){return[aA]};var bb=function(){aD.SetFldSearchSpec("Activity Id",aJ)};var aX=function(){h.push(aD)};var ba=function(){aI.ActivateField("Max Per Call");aI.ActivateField("Max Per Allocation");aI.ActivateField("Stop Sampling Flag");aI.ActivateField("Sum Qty Alloc");aI.SetFldSearchSpec("Activity Id",aJ)};var a9=function(){h.push(aI)};var a8=function(){av.ActivateField("Parent Activity Id");av.SetSearchExpr("[Parent Activity Id] = '"+aJ+"'")};var a7=function(){h.push(av)};var a5=function(){var bk=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var bl=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var bm=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));ax.ActivateField(bk);ax.ActivateField(bl);ax.ActivateField(bm);ax.ActivateField("One Time Sample Flag");ax.SetFldSearchSpec("Professional Id",aN);ax.SetFldSearchSpec("State",aQ)};var a4=function(){h.push(ax)};var a2=function(){var bk=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aE.ActivateField(bk);bk=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aE.ActivateField(bk);aE.SetFldSearchSpec("Professional Id",aN);aE.SetFldSearchSpec("Address Id",aR)};var a0=function(){h.push(aE)};var aZ=function(){var bk=SiebelApp.S_App.Model.GetLoginId();aG.ActivateField("Id");aG.ActivateField("OK to Sample");aG.SetFldSearchSpec("Id",bk)};var aY=function(){h.push(aG)};var aW=function(){var bl=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");var bk=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");if((aM===bk)&&aR){az.SetFldSearchSpec("Id",aR)}else{az.SetFldSearchSpec("Id",aT)}};var bj=function(){h.push(az)};var bi=function(){aB.SetSearchSpec("[Id] = '"+aN+"'")};var bg=function(){aB.PositionById(aN);h.push(aB)};var bf=function(){aF.ActivateField("Response");aF.SetFldSearchSpec("Activity Id",aJ)};var bd=function(){h.push(aF)};if(au&&!ar.IsEmpty(au)){aw[ay++]={execute:au.Execute,executeScope:au,preExecute:bh};aw[ay++]={execute:au.Home,executeScope:au,postExecute:a3}}if(aA&&!ar.IsEmpty(aA)){aw[ay++]={execute:aA.Execute,executeScope:aA,preExecute:be};aw[ay++]={execute:aA.Home,executeScope:aA,postExecute:a1}}aw[ay++]={execute:D,executeScope:this,preExecute:bc};if(aD&&!ar.IsEmpty(aD)){aw[ay++]={execute:aD.Execute,executeScope:aD,preExecute:bb};aw[ay++]={execute:aD.Home,executeScope:aD,postExecute:aX}}if(aI&&!ar.IsEmpty(aI)){aw[ay++]={execute:aI.Execute,executeScope:aI,preExecute:ba};
aw[ay++]={execute:aI.Home,executeScope:aI,postExecute:a9}}if(av&&!ar.IsEmpty(av)){aw[ay++]={execute:av.Execute,executeScope:av,preExecute:a8};aw[ay++]={execute:av.Home,executeScope:av,postExecute:a7}}if(ax&&!ar.IsEmpty(ax)){aw[ay++]={execute:ax.Execute,executeScope:ax,preExecute:a5};aw[ay++]={execute:ax.Home,executeScope:ax,postExecute:a4}}if(aE&&!ar.IsEmpty(aE)){aw[ay++]={execute:aE.Execute,executeScope:aE,preExecute:a2};aw[ay++]={execute:aE.Home,executeScope:aE,postExecute:a0}}if(aG&&!ar.IsEmpty(aG)){aw[ay++]={execute:aG.Execute,executeScope:aG,preExecute:aZ};aw[ay++]={execute:aG.Home,executeScope:aG,postExecute:aY}}if(az&&!ar.IsEmpty(az)){aw[ay++]={execute:az.Execute,executeScope:az,preExecute:aW};aw[ay++]={execute:az.Home,executeScope:az,postExecute:bj}}if(aB&&!ar.IsEmpty(aB)){aw[ay++]={execute:aB.Execute,executeScope:aB,preExecute:bi};aw[ay++]={execute:aB.Home,executeScope:aB,postExecute:bg}}if(aF&&!ar.IsEmpty(aF)){aw[ay++]={execute:aF.Execute,executeScope:aF,preExecute:bf};aw[ay++]={execute:aF.Home,executeScope:aF,postExecute:bd}}$.eachAsyncOp(this,aw);$.callback(this,function(bk){$.setReturnValue({err:false,retval:"success"})})})})})})})})})})};H.prototype.CallValidate=function(ax){SiebelJS.Log("Invoked CallValidateOverride ");var aw="Submit";var av=CCFMiscUtil_CreatePropSet();e=0;u=0;aw=ax.GetProperty("EventName");var au=aq("Pharma Professional Call - Mobile");al(au);$.callback(this,function(az){var ay=az.retVal;if(ay){this.ValidateAttendeeCall(au,aw);$.callback(this,function(aC){var aA=e;var aB=u;av.SetProperty("ErrorCount",aA);av.SetProperty("WarningCount",aB);e=u=0;$.setReturnValue({err:false,retVal:av})})}else{G(au);$.callback(this,function(aB){var aA=aB.retVal;if(aA){this.ValidateAccountCall(au,aw);$.callback(this,function(aE){var aC=e;var aD=u;av.SetProperty("ErrorCount",aC);av.SetProperty("WarningCount",aD);e=u=0;$.setReturnValue({err:false,retVal:av})})}else{this.ValidateProfCall(au,aw);$.callback(this,function(aE){var aC=e;var aD=u;av.SetProperty("ErrorCount",aC);av.SetProperty("WarningCount",aD);e=u=0;$.setReturnValue({err:false,retVal:av})})}})}})};H.prototype.ValidateAttendeeCall=function(aw,ax){SiebelJS.Log("Invoked ValidateAttendeeCall Method");var av=[];var au=false;this.ExecuteAllBCs(aw);$.callback(this,function(ay){this.PreValidate();$.callback(this,function(az){this.SetValidateEventCode(ax);$.callback(this,function(aG){for(var aE=1;aE<=20;aE++){var aA="Validation Rule "+aE;var aF=SiebelApp.Metadata.GetUserProperty(aA,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));av.push(aF)}var aC=av.length;var aB=0;var aD=function(){var aH=av[aB];if(!ar.IsEmpty(aH)){var aJ=aH.split(",");if((aJ[4].valueOf()&b)===b){au=true;ap(aH,true);var aI=this.ValidateRule(aH);$.callback(this,function(aK){var aL=aK.retVal;ap(aH,false);aB++;if(aB<aC){aD.call(this)}else{if(!au){w=""}aw.FieldValue("Id");$.callback(this,function(aN){var aM=aN.retVal;this.UpsertResult(aM)})}})}else{aB++;aD.call(this)}}else{aB++;if(aB<aC){aD.call(this)}}};aD.call(this)})})})};H.prototype.ValidateAccountCall=function(aw,ay){SiebelJS.Log("Invoked ValidateAccountCall Method");var av=[];var au=false;var ax;this.PreValidate();$.callback(this,function(az){this.SetValidateEventCode(ay);$.callback(this,function(aG){for(var aE=1;aE<=21;aE++){var aA="Validation Rule "+aE;var aF=SiebelApp.Metadata.GetUserProperty(aA,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));av.push(aF)}var aC=av.length;var aB=0;var aD=function(){var aH=av[aB];if(!ar.IsEmpty(aH)){var aJ=aH.split(",");if((aJ[4].valueOf()&i)===i){au=true;ap(aH,true);var aI=this.ValidateRule(aH);$.callback(this,function(aK){var aL=aK.retVal;ap(aH,false);aB++;if(aB<aC){aD.call(this)}else{if(!au){w=""}}})}else{aB++;aD.call(this)}}else{aB++;if(aB<aC){aD.call(this)}}};aD.call(this);$.callback(this,function(){aw.FieldValue("Id");$.callback(this,function(aI){var aH=aI.retVal;this.UpsertResult(aH);$.callback(this,function(aM){SiebelApp.OfflineAppMgr.PostActions("ActionRPCCompleted");var aN=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var aK=aN.GetBusComp("Pharma Professional Call - Mobile");var aL=function(){this.CleanUp();this.ValidateAttendeeCall(aK,"SUBMIT");$.callback(this,function(aO){aK.NextRecord();$.callback(this,function(aQ){var aP=aQ.err;if(!aP){aL.call(this)}})})};var aJ=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");aK.SetSearchExpr("[Parent Activity Id] = '"+aH+"' AND [Category] = '"+aJ+"'");aK.Execute();$.callback(this,function(aO){aK.Home();$.callback(this,function(aP){if(aK.CheckActiveRow()===true){aL.call(this);$.callback(this,function(aQ){this.CleanUp();SiebelApp.S_App.Model.ReleaseBO(aN)})}})})})})})})})};function aq(aw){var au;for(var av=0;av<h.length;av++){if(h[av].GetName().trim()===aw){au=h[av]}}return au}H.prototype.ValidateProfCall=function(aw,ax){SiebelJS.Log("Invoked ValidateProfCall Method");var av=[];var au=false;this.PreValidate();$.callback(this,function(ay){this.SetValidateEventCode(ax);$.callback(this,function(aF){for(var aD=1;aD<=21;aD++){var az="Validation Rule "+aD;var aE=SiebelApp.Metadata.GetUserProperty(az,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));av.push(aE)}var aB=av.length;var aA=0;var aC=function(){var aG=av[aA];if(!ar.IsEmpty(aG)){var aI=aG.split(",");if((aI[4].valueOf()&q)===q){au=true;ap(aG,true);var aH=this.ValidateRule(aG);$.callback(this,function(aJ){var aK=aJ.retVal;ap(aG,false);aA++;if(aA<aB){aC.call(this)}else{if(!au){w=""}}})}else{aA++;aC.call(this)}}else{aA++;if(aA<aB){aC.call(this)}}};aC.call(this);$.callback(this,function(aG){aw.FieldValue("Id");$.callback(this,function(aI){var aH=aI.retVal;this.UpsertResult(aH);$.callback(this,function(aJ){SiebelApp.OfflineAppMgr.PostActions("ActionRPCCompleted")})})})})})};function al(au){J(au,"Attendee Call");$.callback(this,function(av){$.setReturnValue({err:false,retVal:av.retVal})})}function G(au){J(au,"Account Call");$.callback(this,function(av){$.setReturnValue({err:false,retVal:av.retVal})})}function J(av,au){var aw="";var ax="";if(!ar.IsEmpty(av)){aw=av.FieldValue("Category");$.callback(this,function(az){aw=az.retVal;ax=SiebelApp.S_App.Model.GetLovValName(au,"TODO_TYPE");var ay=false;if(aw===ax){ay=true}$.setReturnValue({err:false,retVal:ay})})}}H.prototype.CleanUp=function(){SiebelJS.Log("Invoked CleanUp Method");w=[];h=[];SiebelApp.S_App.Model.ReleaseBO(d);SiebelApp.S_App.Model.ReleaseBO(p);SiebelApp.S_App.Model.ReleaseBO(x);if(m){SiebelApp.S_App.Model.ReleaseBO(m)}};H.prototype.PreValidate=function(){SiebelJS.Log("Invoked PreValidate Method");var au=aq("Pharma Professional Call - Mobile");au.FieldValue("Category");$.callback(this,function(ax){var aw=ax.retVal;var av=SiebelApp.S_App.Model.GetLovValName(aw,"TODO_TYPE");if(av==="Attendee Call"||av==="Professional Call"){this.SaveCallProductState("Pharma Call Products Detailed");$.callback(this,function(ay){this.SetCtrledSamplingFlags();$.callback(this,function(az){this.ProcessSREProfTypeException();$.callback(this,function(aA){this.SetCallType();
$.callback(this,function(aB){})})})})}else{c=false;n=false}})};H.prototype.SaveCallProductState=function(){SiebelJS.Log("Invoked SaveCallProductState Method")};H.prototype.SetCallType=function(){SiebelJS.Log("Invoked SetCallType Method");var ax,aw;var az=false;var au=false;var aA=false;var av;var ay;ax=aq("Pharma Professional Call - Mobile");aw=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp();az=N("Pharma Call Products Detailed");au=N("Pharma Call Sample Dropped");if(az&&au&&aA){av=SiebelApp.S_App.Model.GetLovNameVal("DETAIL WITH SAMPLES","TODO_TYPE")}else{if((az&&au)||(az&&aA)){av=SiebelApp.S_App.Model.GetLovNameVal("Detail With Sample Drop","TODO_TYPE")}else{if(az){av=SiebelApp.S_App.Model.GetLovNameVal("Detail","TODO_TYPE")}else{if(au||aA){av=SiebelApp.S_App.Model.GetLovNameVal("Sample Drop","TODO_TYPE")}else{av=SiebelApp.S_App.Model.GetLovNameVal("Call","TODO_TYPE")}}}}ax.SetFieldValue("Type",av,true);$.callback(this,function(aB){aw.SetFieldValue("Type",av,true)})};H.prototype.ProcessSREProfTypeException=function(){SiebelJS.Log("Invoked ProcessSREProfTypeException Method");var ax=true;var av=true;var aw="";var au=aq("Pharma Professional Call - Mobile");U();$.callback(this,function(ay){var az=ay.retVal;au.FieldValue("Professional Type");$.callback(this,function(aB){var aE=aB.retVal;var aF=SiebelApp.S_App.Model.GetLovValName(aE,"CONTACT_TYPE");var aD=SiebelApp.S_App.Model.GetLovValName(az,"STATE_ABBREV");var aA="SRE PT Exception - License: "+aF;var aC=SiebelApp.Metadata.GetUserProperty(aA,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(!ar.IsEmpty(aC)){aw=aC.split("|");if(aw[0]===aD||aw[1]===aD){o=false}}aA="SRE PT Exception - DEA: "+aF;aC=SiebelApp.Metadata.GetUserProperty(aA,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(!ar.IsEmpty(aC)){aw=aC.split("|");if(aw[0]===aD||aw[1]===aD){s=false}}})})};H.prototype.CopyStateLicenseInfo=function(){SiebelJS.Log("Invoked CopyStateLicenseInfo Method");var au="";var av="";var ax="";var aw=aq("Pharma Professional Call - Mobile");var ay=U();aw.FieldValue("Contact Id");$.callback(this,function(aF){var aA=aF.retVal;aw.SetCommitPending(true);aw.WriteRecord();if(!ar.IsEmpty(ay)){var aD=aq("Pharma Professional State Licenses");var az=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aC=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aE=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(aD.CheckActiveRow()===true){au=aD.FieldValue(az);av=aD.FieldValue(aC);ax=aD.FieldValue(aE);var aB=aD.FieldValue("One Time Sample Flag")}if(aw.IsCommitPending()===true){aw.WriteRecord()}aw.SetFieldValue("License Number",au);aw.SetFieldValue("License Expiry Date",av);aw.SetFieldValue("License Status",ax);aw.WriteRecord()}})};H.prototype.CopyDEAInfo=function(){SiebelJS.Log("Invoked CopyDEAInfo Method");var av=aq("Pharma Professional Call - Mobile");var ax=av.FieldValue("Contact Id");var ay=av.FieldValue("Contact Address Id");if(!ar.IsEmpty(ax)&&!ar.IsEmpty(ay)){var az=aq("Pharma Address Inter Table - CE");if(az.CheckActiveRow()!==true){return}var aw=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var au=az.FieldValue(aw);aw=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aA=az.FieldValue(aw);if(!ar.IsEmpty(au)&&!ar.IsEmpty(aA)){av.SetFieldValue("DEA#",au);av.SetFieldValue("DEA Expiry Date",aA);av.WriteRecord()}}};H.prototype.SetCtrledSamplingFlags=function(){SiebelJS.Log("Invoked SetCtrledSamplingFlags Method");c=false;n=false;var au=aq("Pharma Call Sample Dropped");if(!ar.IsEmpty(au)){var av=function(aw){if(au.CheckActiveRow()===true){au.FieldValue("Controlled Substance");$.callback(this,function(ax){var ay=ax.retVal;if(ay==="Y"){c=true}else{n=true}au.NextRecord();$.callback(this,function(aA){var az=aA.err;if(!az){av.call(this)}else{au.Home()}})})}};if(au.CheckActiveRow()===true){av.call(this)}}};H.prototype.SetValidateEventCode=function(aw){SiebelJS.Log("Invoked SetValidateEventCode Method");var au=false;var ay=false;var ax=false;var av=aq("Pharma Professional Call - Mobile");av.FieldValue("Category");$.callback(this,function(aB){var aA=aB.retVal;var az=SiebelApp.S_App.Model.GetLovValName(aA,"TODO_TYPE");if(az==="Account Call"){a=v;return}if(!ar.IsEmpty(aw)){if(aw.toLowerCase()==="sign"){a=g}else{a=v}}else{av.FieldValue("Signature Captured");$.callback(this,function(aC){ax=aC.retVal;if(ax===false){av.FieldValue("Paper Signature");$.callback(this,function(aD){ax=aD.retVal})}au=ax?true:false;if(au){a=v}else{a=g}})}})};H.prototype.UpsertResult=function(aL){SiebelJS.Log("Invoked UpsertResult Method");var aE=false;var aC={};var ay="";var aK=SiebelApp.S_App.OfflineErrorObject;var av=aq("LS Pharma Call Validation Results");if(av.CheckActiveRow()===true){aE=true}var aA=w.length;var az=0;var aF=1;var aB=[];var au=[];var aM=[];var ax=["Message Type","Message Type LIC","Message","Call Id","Rule Number"];var aw=["strTemp","ErrMsgType","Message","Call Id"];var aI,aG;for(aI=0;aI<aA*2;aI=aI+2){aG=aI;var aJ=function(aN){aC=w[az];if((aC.ErrMsgType).toLowerCase()==="error"){ay=SiebelApp.S_App.Model.GetLovNameVal("ERROR","LS_VALIDATION_MESSAGE_TYPE")}else{if((aC.ErrMsgType).toLowerCase()==="ignore"){ay=SiebelApp.S_App.Model.GetLovNameVal("IGNORE","LS_VALIDATION_MESSAGE_TYPE")}else{if((aC.ErrMsgType).toLowerCase()==="warning"){ay=SiebelApp.S_App.Model.GetLovNameVal("WARNING","LS_VALIDATION_MESSAGE_TYPE")}else{ay=SiebelApp.S_App.Model.GetLovNameVal("SUCCESS","LS_VALIDATION_MESSAGE_TYPE")}}}if(aN===0){av.NewRecord(false)}au[0]=ax[aN];if(aN===0){au[1]=ay}else{if(aN===1){au[1]=aC.ErrMsgType}else{if(aN===2){au[1]=aC.Message}else{if(aN===3){au[1]=aL}else{if(aN===4){au[1]=aF;aF++}}}}}au[2]=true;return au};var aH=function(){av.SetCommitPending(true);aM[0]=false;return aM};var aD=function(){az++};aB[aG]={execute:av.SetFieldValue,executeScope:av,preExecute:aJ,iterations:5};aB[aG+1]={execute:av.WriteRecord,executeScope:av,preExecute:aH,postExecute:aD}}if(aA>0){$.eachAsyncOp(this,aB);$.callback(this,function(aN){$.setReturnValue({err:false,retVal:"Success"})})}};H.prototype.PostValidate=function(){SiebelJS.Log("Invoked PostValidate Method");this.RestoreCallProductState("Pharma Call Products Detailed")};H.prototype.RestoreCallProductState=function(au){SiebelJS.Log("Invoked RestoreCallProductState Method")};H.prototype.ValidateRule=function(au){SiebelJS.Log("Invoked LogValidationMsg Method");var av=false;av=ag(au);if(av===true){var ax=au.split(",");var aw=ax[2].trim();switch(aw){case"IsValidCallDate":C();break;case"AreProductsDetailed":ab();break;case"IsValidPositionToSubmit":y();break;case"AreProdDetailedValid":ae();break;case"ValidateReqFields":P();
break;case"ValidateSampRefNum":K();break;case"IsCallDateInReconciled":ah();break;case"IsValidSREProfType":T();break;case"AreSamplesRequestedValid":W();break;case"ArePromoItemsDroppedValid":V.call(this);break;case"IsLicenseExpired":A();break;case"IsValidLicenseNumber":an();break;case"IsValidLicenseStatus":ad();break;case"IsValidProfProfile":aj();break;case"IsValidEmpToSample":ao.call(this);break;case"IsValidDEANumber":z();break;case"IsDEAExpired":Y();break;case"IsValidProfToSample":Q();break;case"AreSamplesDropped":ai();break;case"AreSamplesDroppedValid":S();break;case"IsDetailingFeedbackSubmitted":ac();break;default:break}}};function ag(au){var av=false;if(!ar.IsEmpty(au)){var aw=au.split(",");if(aw[1].valueOf()&a){av=true}}return av}function ap(au,aw){var av={};if(aw){var ax=au.split(",");av.RuleName=ax[0];av.EventToCheck=ax[1];av.MethodName=ax[2];av.ErrMsgType=ax[3];av.RuleType=ax[4];r=av}else{av.RuleName="";av.EventToCheck="";av.MethodName="";av.ErrMsgType="";av.RuleType="";r=av}}function I(){return r}function Z(au){SiebelJS.Log("Invoked InitValidationMsg Method");var av;var aw;t={};t.RuleName=r.RuleName;t.ObjectType=au;if(au==="CONTACT"){av=aq("Pharma Professional Call - Mobile");av.FieldValue("Contact Id");$.callback(this,function(ax){aw=ax.retVal;t.ObjectId=aw})}else{if(au==="PHARMA CALL"){av=aq("Pharma Professional Call - Mobile");av.FieldValue("Id");$.callback(this,function(ax){aw=ax.retVal;t.ObjectId=aw})}else{if(au==="EMPLOYEE"){av=aq("Employee")}}}}function X(av,aA,az,au){SiebelJS.Log("Invoked LogValidationMsg Method");if(ar.IsEmpty(aA)){aA=""}if(ar.IsEmpty(az)){az=""}if(l===false){return}var aw="";var ay={};var aC=SiebelApp.S_App.OfflineLocaleObject;var aB=aC.GetLocalString(av);if(!ar.IsEmpty(aB)){var ax=SiebelApp.S_App.Model.GetLovNameVal(t.RuleName,"LS_VALIDATION_RULE_NAME");aw=ax+" : "+aB}if(av==="SSAPhmaValidationRuleIgnored"){SiebelJS.Log("LogValidationMsg  Rule Ignored ");t.ErrMsgType="IGNORE";aw=t.RuleName+" : Rule Ignored"}else{if(av==="SSAPhmaValidationRulePassed"){SiebelJS.Log("LogValidationMsg Success");t.ErrMsgType="SUCCESS";aw=t.RuleName+" : Rule Passed"}else{SiebelJS.Log("LogValidationMsg Failed");if(!au){t.ErrMsgType=r.ErrMsgType.trim()}else{t.ErrMsgType=au.trim()}if(t.ErrMsgType==="ERROR"){e++}else{if(t.ErrMsgType==="WARNING"){u++}}}}if(!ar.IsEmpty(aA)){aw=aw.replace(/%1/g,aA)}if(!ar.IsEmpty(az)){aw=aw.replace(/%2/g,az)}t.Message=aw;ay=t;if(t.ErrMsgType==="ERROR"||t.ErrMsgType==="WARNING"){w.push(ay)}}function ab(){Z("PHARMA CALL");var au="";var ax="";var aw=N("Pharma Call Products Detailed");var av=aq("Pharma Professional Call - Mobile");av.FieldValue("Type");$.callback(this,function(ay){au=ay.retVal;ax=SiebelApp.S_App.Model.GetLovValName(au,"TODO_TYPE");if(aw||ax.indexOf("Sample Drop")!==-1){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhmaErrDetailProd")}})}function N(aw){var av=false;var au=aq(aw);if(au.CheckActiveRow()===true){av=true}return av}function C(){Z("PHARMA CALL");var au=aq("Pharma Professional Call - Mobile");if(!ar.IsEmpty(au)){au.FieldValue("Start Date");$.callback(this,function(aw){var av=aw.retVal;if((new Date(av).getTime()>new Date().getTime())){return X("SSAPhmaErrNoSignAfterToday")}})}}function y(){var au="";Z("EMPLOYEE");var av=aq("Pharma Professional Call - Mobile");av.FieldValue("Primary Owner Id");$.callback(this,function(aw){au=aw.retVal;if(ar.IsEmpty(au)){au="1-7D"}if(au!==SiebelApp.S_App.Model.GetLoginId()){return X("SSAPhmaErrNoSignUnlessOwn")}else{return X("SSAPhmaValidationRulePassed")}})}function ae(){var ax=1;var aw={};var ay=false;Z("PHARMA CALL");var au=aq("Pharma Call Products Detailed");var av=function(){au.FieldValue("Priority");$.callback(this,function(aA){var aB=aA.retVal;var az=parseInt(aB,10);if((ar.IsEmpty(aB))||az===0||aw[az]){X("IDS_LS_TARGET_PRIORITY_VALIDATION_FAILED");ay=true;return}else{aw[az]=az;au.NextRecord();$.callback(this,function(aD){var aC=aD.err;if(!aC){ax++;av.call(this)}})}})};if(au.CheckActiveRow()===true){av.call(this)}else{ay=true}$.callback(this,function(aA){if(!ay&&aw!=="undefined"&&aw!==null){for(var az=1;az<=ax;az++){if(!aw[az]){X("IDS_LS_TARGET_PRIORITY_VALIDATION_FAILED");break}}}})}function P(){var ax=false;var aw="";var ay="";var au="";Z("PHARMA CALL");var av=aq("Pharma Professional Call - Mobile");av.FieldValue("Category");$.callback(this,function(aC){au=aC.retVal;au="Required Fields To Submit: "+au;ay=SiebelApp.Metadata.GetUserProperty(au,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ay)){return}var aB=ay.split(",");var az=aB.length;for(var aA=0;aA<az;aA++){aw=av.FieldValue(aB[aA]);if(ar.IsEmpty(aw)){ax=true;return X("SSAFReqFieldNotExist",aB[aA])}}})}function K(){var av="";Z("PHARMA CALL");if(c||n){var au=aq("Pharma Professional Call - Mobile");au.FieldValue("Contact Full Name");$.callback(this,function(ax){var aw=ax.retVal;au.FieldValue("Paper Signature");$.callback(this,function(ay){var az=ay.retVal;au.FieldValue("Signature Captured");$.callback(this,function(aB){var aA=aB.retVal;au.FieldValue("Sample Reference Number");$.callback(this,function(aC){var aD=aC.retVal;if(az===true){av=SiebelApp.Metadata.GetUserProperty("Enable Paper Reference Required",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(av.toLowerCase()==="y"){if(ar.IsEmpty(aD)){return X("SSAPhrmaErrRefNumIfSamp",aw)}}else{if(ar.IsEmpty(aD)){au.FieldValue("Id");$.callback(this,function(aE){av=aE.retVal;au.SetFieldValue("Sample Reference Number",av)})}}}else{if(aA.toLowerCase()==="y"){if(av.toLowerCase()==="y"){if(ar.IsEmpty(aD)){return X("SSAPhrmaErrRefNumIfSamp",aw)}}else{if(ar.IsEmpty(aD)){au.FieldValue("Id");$.callback(this,function(aE){av=aE.retVal;au.SetFieldValue("Sample Reference Number",av)})}}}else{t.RuleName="CALL NEED SIGN RULE";return X("SSAPhmaErrCallNeedsSign",aw)}}return X("SSAPhmaValidationRulePassed")})})})})}else{return X("SSAPhmaValidationRuleIgnored")}}function ah(){var ax=false;var aw="";var au="";Z("PHARMA CALL");var av=aq("Pharma Professional Call - Mobile");if(!ar.IsEmpty(av)){av.FieldValue("Signature Captured");$.callback(this,function(aA){ax=aA.retVal;if(ax===false){ax=av.FieldValue("Paper Signature");$.callback(this,function(aB){ax=aB.retVal})}var ay=ax?true:false;if(!c&&!n&&!ay){return X("SSAPhmaValidationRuleIgnored")}if(true){ay=av.FieldValue("Signature Captured");if(ay){var az=aq("Pharma Promotional Items Dropped");if(az.CheckActiveRow()!==true){return X("SSAPhmaValidationRuleIgnored")}}}})}}function T(){var az=false;var ay="";var ax="";var av="";var aw="";Z("CONTACT");ay=SiebelApp.Metadata.GetUserProperty("SRE Professional Types",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ay)){X("SSAPhmaValidationRuleIgnored");az=true;$.setReturnValue({err:false,retVal:az});return}var au=aq("Pharma Professional Call - Mobile");au.FieldValue("Professional Type");$.callback(this,function(aC){ax=aC.retVal;var aD=SiebelApp.S_App.Model.GetLovValName(ax,"CONTACT_TYPE");var aB=","+aD+",";
var aA=ay.indexOf(aB);if(!ar.IsEmpty(ax)&&(aA!==-1)){X("SSAPhmaValidationRulePassed");az=true;$.setReturnValue({err:false,retVal:az});return}U();$.callback(this,function(aF){var aH=aF.retVal;var aG=SiebelApp.S_App.Model.GetLovValName(aH,"STATE_ABBREV");var aE="SRE PT Exception - License: "+aD;av=SiebelApp.Metadata.GetUserProperty(aE,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aE="SRE PT Exception - DEA: "+aD;aw=SiebelApp.Metadata.GetUserProperty(aE,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(av)){av=""}if(ar.IsEmpty(aw)){aw=""}if(!ar.IsEmpty(aH)&&((aw.indexOf(aG)<0)&&c)){X("SSAPhrmaErrNotValidProfTypeForSRE");$.setReturnValue({err:az,retVal:az})}else{if(!ar.IsEmpty(aH)&&((av.indexOf(aG)<0)&&(c||n))){X("SSAPhrmaErrNotValidProfTypeForSRE");$.setReturnValue({err:az,retVal:az})}else{if(!ar.IsEmpty(aH)){X("SSAPhmaValidationRulePassed");$.setReturnValue({err:az,retVal:az})}}}if(!c&&!n){X("SSAPhmaValidationRuleIgnored");$.setReturnValue({err:az,retVal:az})}if(!ar.IsEmpty(aH)&&(av.indexOf(aG)>=0||aw.indexOf(aG)>=0)){az=true;$.setReturnValue({err:false,retVal:true});return}})})}function U(){var aw="";var av=aq("Pharma Professional Call - Mobile");var au=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");av.FieldValue("Category");$.callback(this,function(ay){var aA=ay.retVal;if(aA===au){var az=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var ax=az.GetBusComp("Pharma Professional Call - Mobile");av.FieldValue("Parent Activity Id");$.callback(this,function(aC){var aB=aC.retVal;ax.SetFldSearchSpec("Id",aB);ax.Execute();$.callback(this,function(aD){ax.Home();$.callback(this,function(aE){if(ax.CheckActiveRow()===true){ax.FieldValue("State");$.callback(this,function(aF){var aG=aF.retVal;SiebelApp.S_App.Model.ReleaseBO(az);$.setReturnValue({err:false,retVal:aG})})}})})})}else{av.FieldValue("State");$.callback(this,function(aB){aw=aB.retVal;if(!ar.IsEmpty(aw)){$.setReturnValue({err:false,retVal:aw})}else{var aD="State";var aC=aq("CUT Address - CE");aC.FieldValue(aD);$.callback(this,function(aE){var aF=aE.retVal;$.setReturnValue({err:false,retVal:aF})})}})}})}function W(){Z("PHARMA CALL")}function V(){Z("PHARMA CALL");var au=false;var aw=false;var ay=false;var av=I().ErrMsgType;if(av!=="IGNORE"){var az=aq("Pharma Promotional Items Dropped");var ax=function(){az.FieldValue("Sum Qty Alloc");$.callback(this,function(aA){var aB=aA.retVal;az.SetFieldValue("Calc Sum Qty Alloc",aB);$.callback(this,function(aC){az.FieldValue("Max Per Allocation");$.callback(this,function(aD){aB=aD.retVal;az.SetFieldValue("Alloc Max Qty Per Period",aB,true);$.callback(this,function(aE){az.FieldValue("Max Per Call");$.callback(this,function(aF){aB=aF.retVal;az.SetFieldValue("Alloc Max Qty Per Call",aB,true);az.FieldValue("Quantity");$.callback(this,function(aH){var aG=aH.retVal;if(aG<=0){return}E.call(this,az,true);$.callback(this,function(aI){ay=aI.retVal;au=!ay;O(az);$.callback(this,function(aJ){aw=aJ.retVal;au=!aw;F(az);$.callback(this,function(aK){aw=aK.retVal;au=!aw;az.NextRecord();$.callback(this,function(aM){var aL=aM.err;if(!aL){ax.call(this)}})})})})})})})})})})};if(az.CheckActiveRow()===true){ax.call(this)}}}function ac(){Z("PHARMA CALL");var ax=false;var av=I().ErrMsgType;if(av!=="IGNORE"){var au=aq("LS PCD Presentation Details BC");var aw=function(){au.FieldValue("Response");$.callback(this,function(ay){var az=ay.retVal;if(ar.IsEmpty(az)){ax=true}else{au.NextRecord();$.callback(this,function(aB){var aA=aB.err;if(!aA){aw.call(this)}})}})};if(au&&!ar.IsEmpty(au)){if(au.CheckActiveRow()===true){aw.call(this)}}if(ax===true){return X("IDS_LS_PHARMA_EDT_RSP_REQD")}else{return X("SSAPhmaValidationRulePassed")}}else{return X("SSAPhmaValidationRuleIgnored")}}function at(){m=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var ay=m.GetBusComp("Pharma Professional Call - Mobile");var av=this.GetContext().GetBusComp().GetParentBusComp();var aw=m.GetBusComp("Employee");x=SiebelApp.S_App.Model.GetBusObj("Account");var az=x.GetBusComp("CUT Address - CE");var ax=SiebelApp.S_App.Model.GetLovNameVal("Account Call","TODO_TYPE");var au=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");av.FieldValue("Parent Activity Id");$.callback(this,function(aB){var aA=aB.retVal;av.FieldValue("Category");$.callback(this,function(aC){var aD=aC.retVal;av.FieldValue("Contact Address Id");$.callback(this,function(aF){var aE=aF.retVal;h.push(av);aw.ActivateField("OK to Sample");aw.Execute();$.callback(this,function(aG){aw.Home();$.callback(this,function(aH){h.push(aw);if((aD===au)&&aE){az.SetFldSearchSpec("Id",aE)}else{ay.SetSearchExpr("[Parent Activity Id] = '"+aA+"' AND [Category] = '"+ax+"'");ay.ActivateField("Contact Address Id");ay.ActivateField("Account Address Id");ay.Execute();$.callback(this,function(aI){ay.Home();$.callback(this,function(aJ){if(ay.CheckActiveRow()===true){ay.FieldValue("Contact Address Id");$.callback(this,function(aK){aE=aK.retVal;ay.FieldValue("Account Address Id");$.callback(this,function(aM){var aL=aM.retVal;if(aE){az.SetFldSearchSpec("Id",aE)}else{az.SetFldSearchSpec("Id",aL)}})})}})})}$.callback(this,function(aI){az.Execute();$.callback(this,function(aJ){az.Home();$.callback(this,function(aK){h.push(az)})})})})})})})})}function ak(av){var ay=false;l=false;var aw=SiebelApp.Metadata.GetUserProperty("Enable Stop Sampling Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(aw)){return}var aA=aw.split(",");var au=aA[0];var ax=aA[1];var az=aA[2];r.RuleName=au;r.ErrMsgType=az;if(ax==="N"){return}r.RuleName=au;at.call(this);$.callback(this,function(){ao();$.callback(this,function(aB){ay=aB.retVal;if(ay){Q();$.callback(this,function(aC){ay=aC.retVal;if(ay){T();$.callback(this,function(aD){ay=aD.retVal;$.setReturnValue({err:false,retVal:ay});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return})}else{$.setReturnValue({err:false,retVal:ay});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return}})}else{$.setReturnValue({err:false,retVal:ay});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return}})});l=true}function O(aw){var av;Z("PHARMA CALL");var ax=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Call Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ax)){$.setReturnValue({err:false,retVal:true});return}var aA=ax.split(",");var au=aA[0];var ay=aA[1];var az=aA[2];r.RuleName=au;r.ErrMsgType=az;if(ay==="N"){$.setReturnValue({err:false,retVal:true});return}aw.FieldValue("Quantity");$.callback(this,function(aC){var aB=aC.retVal;aw.FieldValue("Max Per Call");$.callback(this,function(aG){var aD=aG.retVal;var aF=parseInt(aD,10);var aE=parseInt(aB,10);if((aF>0)&&(aE<=aF)||ar.IsEmpty(aD)){av=true;$.setReturnValue({err:false,retVal:av});return}t.RuleName="MAX PER CALL SUB RULE";aw.FieldValue("Name");$.callback(this,function(aI){var aH=aI.retVal;
if(!ar.IsEmpty(ax)){$.setReturnValue({err:false,retVal:false});X("SSAPhmaErrMaxQtyPerCallExceeded",aH,aD,az);return}})})})}function F(aw){var av=true;var ax=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Allocation Period Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ax)){return}var aA=ax.split(",");var au=aA[0];var ay=aA[1];var az=aA[2];if(ay==="N"){return}aw.FieldValue("Sum Qty Alloc");$.callback(this,function(aC){var aB=aC.retVal;aw.FieldValue("Max Per Allocatio");$.callback(this,function(aG){var aF=aG.retVal;if(ar.IsEmpty(aF)){$.setReturnValue({err:false,retVal:true});return}var aD=aF.valueOf();if((aD>0)&&(aB<=aD)||ar.IsEmpty(aF)){av=true;$.setReturnValue({err:false,retVal:av});return}av=false;t.RuleName=au;t.ErrMsgType=az;var aE=aw.FieldValue("Name");if(!ar.IsEmpty(ax)){$.setReturnValue({err:false,retVal:false});X("SSAPhmaErrMaxQtyPerAllocPeriodExceeded",aE,aF,az);return}})})}function ao(){var au=false;Z("EMPLOYEE");$.callback(this,function(){R();$.callback(this,function(av){au=av.retVal;if(c||n){if(au){X("SSAPhmaValidationRulePassed")}else{X("SSAPhmaValdnMsgInValidEmpToSample")}}else{X("SSAPhmaValidationRuleIgnored")}$.setReturnValue({err:false,retVal:au});return})})}function R(){var au=aq("Employee");var av;var ax=false;var aw="OK to Sample";if(au.CheckActiveRow()===true){au.FieldValue(aw);$.callback(this,function(ay){av=ay.retVal;if((av.toLowerCase()==="y")||(av.toLowerCase()==="true")){ax=true}$.setReturnValue({err:false,retVal:ax});return})}else{$.setReturnValue({err:false,retVal:ax})}}function Q(){var au=false;Z("CONTACT");$.callback(this,function(){B();$.callback(this,function(av){au=av.retVal;if(c||n){if(au){X("SSAPhmaValidationRulePassed")}else{X("SSAPhrmaErrOKToSampleFlgNotSet")}}else{X("SSAPhmaValidationRuleIgnored")}$.setReturnValue({err:false,retVal:au});return})})}function B(){var au=aq("Pharma Professional Call - Mobile");var av;var ax=false;var aw="OK To Sample";au.FieldValue(aw);$.callback(this,function(ay){av=ay.retVal;if((av.toLowerCase()==="y")||(av.toLowerCase()==="true")){ax=true}$.setReturnValue({err:false,retVal:ax});return})}function A(){var av=false;var au=false;Z("CONTACT");U();$.callback(this,function(ay){var az=ay.retVal;if(!ar.IsEmpty(az)){if((n||c)&&o){var aw=aq("Pharma Professional State Licenses");var ax=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aw.FieldValue(ax);$.callback(this,function(aB){var aA=aB.retVal;if(!ar.IsEmpty(aA)){if((new Date(aA).getTime()<new Date().getTime())){au=true}}else{av=true}if(!av&&!au){return X("SSAPhmaValidationRulePassed")}else{if(av){return X("SSAPhrmaErrLicFldsNotFilled","License Expiry Date")}else{return X("SSAPhrmaErrLicNumExpDtExpired")}}})}else{return X("SSAPhmaValidationRuleIgnored")}}else{return X("SSAPhrmaErrLicNumExpDtExpired")}})}function an(){var au=false;var av=false;Z("CONTACT");U();$.callback(this,function(ay){var az=ay.retVal;if(!ar.IsEmpty(az)){if((n||c)&&o){var ax=aq("Pharma Professional State Licenses");var aw=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));ax.FieldValue(aw);$.callback(this,function(aB){var aA=aB.retVal;if(!ar.IsEmpty(aA)){au=true}else{av=true}if(!av&&au){return X("SSAPhmaValidationRulePassed")}else{if(av){return X("SSAPhrmaErrLicFldsNotFilled","License Number")}}})}else{return X("SSAPhmaValidationRuleIgnored")}}else{return X("SSAPhrmaErrLicFldsNotFilled","License Number")}})}function ad(){var ax=false;var av=false;var aw="";var ay="";Z("CONTACT");var au=aq("Pharma Professional State Licenses");U();$.callback(this,function(aA){var aB=aA.retVal;if(!ar.IsEmpty(aB)){var az=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));au.FieldValue(az);$.callback(this,function(aD){var aF=aD.retVal;if(ar.IsEmpty(aF)){ax=true}else{aw=SiebelApp.S_App.Model.GetLovValName(aF,"STATE_LICENSE_STATUS");ay=SiebelApp.Metadata.GetUserProperty("Valid License Status",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ay)){if(aw==="Active"){av=true}}else{var aE=ay.split(",");for(var aC=0;aC<aE.length;aC++){if(aw===aE[aC]){av=true;break}}}}if(ax){return X("SSAPhrmaErrLicFldsNotFilled","License Status")}else{if(!av){return X("SSAPhrmaErrLicStatusInactive")}else{if(!ax&&av){return X("SSAPhmaValidationRulePassed")}}}})}else{return X("SSAPhrmaErrLicStatusInactive")}})}function z(){var av=false;Z("CONTACT");var au=aq("Pharma Professional Call - Mobile");au.FieldValue("Category");$.callback(this,function(ay){var ax=ay.retVal;var aw=SiebelApp.S_App.Model.GetLovValName(ax,"TODO_TYPE");if(c&&s&&aw!=="Attendee Call"){af();$.callback(this,function(az){av=az.retVal;if(av){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhrmaErrDEANumNotValid")}})}else{return X("SSAPhmaValidationRuleIgnored")}})}function af(){var av=false;var au=aq("Pharma Address Inter Table - CE");au.FieldValue("DEA#");$.callback(this,function(ay){var az=ay.retVal;var aI,aH,aG,aF,aE,aD,aC,aB,aA;var aQ,aP,aO,aN,aM,aL,aK,ax,aw,aJ;if(az.length!==9){$.setReturnValue({err:false,retVal:av});return}aI=az.charAt(0);aH=az.charAt(1);aG=az.charAt(2);aF=az.charAt(3);aE=az.charAt(4);aD=az.charAt(5);aC=az.charAt(6);aB=az.charAt(7);aA=az.charAt(8);if((aI===aI.toUpperCase())&&(aH===aH.toUpperCase())){if(isNaN(aG)||isNaN(aF)||isNaN(aE)||isNaN(aD)||isNaN(aC)||isNaN(aB)||isNaN(aA)){$.setReturnValue({err:false,retVal:av});return}aQ=aG.valueOf();aP=aF.valueOf();aO=aE.valueOf();aN=aD.valueOf();aM=aC.valueOf();aL=aB.valueOf();aK=aA.valueOf();ax=parseInt(aQ,10)+parseInt(aO,10)+parseInt(aM,10);aw=parseInt(aP,10)+parseInt(aN,10)+parseInt(aL,10);aK=parseInt(aK,10);aJ=ax+(2*aw);if(aJ%10===aK){av=true}}$.setReturnValue({err:false,retVal:av});return})}function Y(){var ay=false;var aw=false;var ax="";var aA="";var au;var az;Z("CONTACT");var av=aq("Pharma Professional Call - Mobile");av.FieldValue("Category");$.callback(this,function(aD){var aC=aD.retVal;var aB=SiebelApp.S_App.Model.GetLovValName(aC,"TODO_TYPE");if(c&&s&&aB!=="Attendee Call"){av=aq("Pharma Address Inter Table - CE");av.FieldValue("DEA Expr");$.callback(this,function(aF){var aE=aF.retVal;if(!ar.IsEmpty(aE)){if((new Date(aE).getTime()<new Date().getTime())){au=true}}else{az=true}if(ay){return X("SSAPhrmaErrDEANumFldsNotFilled","DEA Expiry Date")}else{if(au){return X("SSAPhrmaErrDEANumExpDtExpired")}else{return X("SSAPhmaValidationRulePassed")}}})}else{return X("SSAPhmaValidationRuleIgnored")}})}function S(){Z("PHARMA CALL");var au=false;var aw=false;var ax=false;var av=I().ErrMsgType;if(av!=="IGNORE"){var ay=aq("Pharma Call Sample Dropped");if(ay.CheckActiveRow()===true){ay.FieldValue("Sum Qty Alloc");$.callback(this,function(az){var aA=az.retVal;ay.SetFieldValue("Calc Sum Qty Alloc",aA);$.callback(this,function(aB){ay.FieldValue("Max Per Allocation");$.callback(this,function(aC){aA=aC.retVal;
ay.SetFieldValue("Alloc Max Qty Per Period",aA);$.callback(this,function(aD){ay.FieldValue("Max Per Call");$.callback(this,function(aE){aA=aE.retVal;ay.SetFieldValue("Alloc Max Qty Per Call",aA);ay.FieldValue("Quantity");$.callback(this,function(aG){var aF=aG.retVal;if(aF<=0){return}E.call(this,ay,true);$.callback(this,function(aH){ax=aH.retVal;au=!ax;M(ay);$.callback(this,function(aI){aw=aI.retVal;au=!aw;if(aw){L(ay);$.callback(this,function(aJ){aw=aJ.retVal;au=!aw})}O(ay);$.callback(this,function(aJ){aw=aJ.retVal;au=!aw;F(ay);$.callback(this,function(aK){aw=aK.retVal;au=!aw})})})})})})})})})})}}}function M(aF){var av=false;var aA=SiebelApp.Metadata.GetUserProperty("Enable Lot Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(aA)){$.setReturnValue({err:false,retVal:true});return}var aE=aA.split(",");var aB=aE[0];var az=aE[1];var aC=aE[2];if(ar.IsEmpty(aA)||az.toLowerCase()!=="y"){av=true;return}t.RuleName=aB;var aI=aF.FieldValue("Name");var aG=aF.FieldValue("Lot Name");var ax=aF.FieldValue("Call Date");var au=aF.FieldValue("Parent Inventory Flag");var aD=aF.FieldValue("Parent Lots Defined Flag");var aw=SiebelApp.Metadata.GetUserProperty("Validate Lot# Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aH=aF.FieldValue("Parent Lots Defined Flag");if(!ar.IsEmpty(aG)){if(new Date(aH).getTime()<new Date().getTime()){t.RuleName="LOT EXPIRY RULE";return X("IDS_LS_PHARMA_EXPIRED_LOT")}}else{if(ar.IsEmpty(aG)&&(aD)){var ay=SiebelApp.S_App.Model.GetSystemPreference("Samples Lots Enabled");var aJ=SiebelApp.S_App.Model.GetSystemPreference("Lots For Disperse Only");if(ay.toLowerCase()===true&&aJ.toLowerCase()!==true){return X("IDS_LS_PHARMA_LOT_NUMBER_REQ","Lot #")}}}av=true;return av}function L(aB){var au=false;var ay=SiebelApp.Metadata.GetUserProperty("Enable Lot Cutoff Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(ay)){$.setReturnValue({err:false,retVal:true});return}var aE=ay.split(",");var aw=aE[0];var ax=aE[1];var az=aE[2];if(ar.IsEmpty(ay)||ax.toLowerCase!=="y"){au=true;return}t.RuleName=aw;var av=new Date();var aC=aB.FieldValue("Lot Name");if(!ar.IsEmpty(aC)){var aA=aB.FieldValue("Cutoff Date");var aD=aB.FieldValue("Name");if(!ar.IsEmpty(aA)&&(new Date(aA).getTime()<new Date().getTime())){return X("SSAPhmaValdnMsgLotCutOff",aD)}}au=true}function aj(){var ax=["Last Name","Contact First Name","Address","Title"];var ay;var au=0;Z("CONTACT");if(c||n){var av=aq("Pharma Professional Call - Mobile");var aw=function(){av.FieldValue(ax[au]);$.callback(this,function(az){ay=az.retVal;if(ar.IsEmpty(ay)){if(ax[au]==="Title"){aa(av);$.callback(this,function(aA){ay=aA.retVal;if(ar.IsEmpty(ay)){return X("SSAPhrmaErrProfProfileNotFilled",ax[au])}else{return X("SSAPhmaValidationRulePassed")}})}else{return X("SSAPhrmaErrProfProfileNotFilled",ax[au])}}else{if(au<3){au++;aw.call(this)}else{return X("SSAPhmaValidationRulePassed")}}})};if(av.CheckActiveRow()===true){aw.call(this)}}else{return X("SSAPhmaValidationRuleIgnored")}}function ai(){Z("PHARMA CALL");var au=false;au=N("Pharma Call Sample Dropped");if(au){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhmaErrSampDropSign")}}function E(av,ax){Z("PHARMA CALL");ax=true;var aw=SiebelApp.Metadata.GetUserProperty("Enable Stop Sampling Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ar.IsEmpty(aw)){return}var aA=aw.split(",");var au=aA[0];var ay=aA[1];var az=aA[2];r.RuleName=au;r.ErrMsgType=az;if(ay==="N"){return}r.RuleName=au;av.FieldValue("Name");$.callback(this,function(aB){var aC=aB.retVal;av.FieldValue("Stop Sampling Flag");$.callback(this,function(aE){var aD=aE.retVal;if(aD.toLowerCase()==="y"){ax=false}if(!ax){if(ar.IsEmpty(az)){X("SSAPhmaValdnMsgStopSampling",aC)}else{X("SSAPhmaValdnMsgStopSampling",aC,null,az)}$.setReturnValue({err:false,retVal:ax});return}})})}function aa(au){var av=aq("Contact");if(av.CheckActiveRow()===true){av.FieldValue("M/M");$.callback(this,function(ax){var aw=ax.retVal;$.setReturnValue({err:false,retVal:aw});return})}}function am(aw){var ax="";var av=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var au=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");aw.FieldValue("Category");$.callback(this,function(az){var aA=az.retVal;if(aA===au){var ay=av.GetBusComp("Pharma Professional Call - Mobile");aw.FieldValue("Parent Activity Id");$.callback(this,function(aC){var aB=aC.retVal;ay.SetFldSearchSpec("Id",aB);ay.Execute();$.callback(this,function(aD){ay.Home();$.callback(this,function(aE){if(ay.CheckActiveRow()===true){ay.FieldValue("State");$.callback(this,function(aF){var aG=aF.retVal;SiebelApp.S_App.Model.ReleaseBO(av);$.setReturnValue({err:false,retVal:aG})})}})})})}else{aw.FieldValue("State");$.callback(this,function(aB){ax=aB.retVal;if(!ar.IsEmpty(ax)){$.setReturnValue({err:false,retVal:ax})}else{var aD="State";var aC=av.GetBusComp("CUT Address - CE");aw.FieldValue("Contact Address Id");$.callback(this,function(aF){var aE=aF.retVal;aw.FieldValue("Account Address Id");$.callback(this,function(aH){var aG=aH.retVal;if(aE){aC.SetFldSearchSpec("Id",aE)}else{aC.SetFldSearchSpec("Id",aG)}aC.FieldValue(aD);$.callback(this,function(aI){ax=aI.retVal;SiebelApp.S_App.Model.ReleaseBO(av);$.setReturnValue({err:false,retVal:ax})})})})}})}})}return H}());return"SiebelAppFacade.PharmaCallValidatorsvc"})};