/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2014
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 8.1.1.14SIA[23044]PATCHSET13 */
if(typeof(SiebelAppFacade.ChatPhyRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.ChatPhyRenderer");define("siebel/chatprenderer",["siebel/basephyrenderer"],function(){SiebelAppFacade.ChatPhyRenderer=(function(){var F=SiebelJS.Dependency("SiebelApp.Constants");var aj=SiebelJS.Dependency("SiebelApp.Utils");var E=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject");var I;var X;function N(ak){SiebelAppFacade.ChatPhyRenderer.superclass.constructor.call(this,ak)}SiebelJS.Extend(N,SiebelAppFacade.BasePR);N.prototype.Init=function(){SiebelAppFacade.ChatPhyRenderer.superclass.Init.call(this);this.AttachPMBinding("NewChatMessage",j,{scope:this});this.AttachPMBinding("ShowTypingMsg",ab,{scope:this});this.AttachPMBinding("ChatResumed",Z,{scope:this});this.AttachPMBinding("ChatIdHold",K,{scope:this});this.AttachPMBinding("ChatIdRemoved",f,{scope:this});this.AttachPMBinding("ChatUpdated",Q,{scope:this});this.AttachPMBinding("ChatClearLog",r,{scope:this});this.AttachPMBinding("TextInput4Set",u,{scope:this});this.AttachPMBinding("UrlInput4Set",v,{scope:this});this.AttachPMBinding("GetTextInputValue",function(ak){ae.call(this,ak)},{scope:this});this.AttachPMBinding("GetUrlInputValue",function(ak){p.call(this,ak)},{scope:this});this.AttachPMBinding("ChatTabMap",Y,{scope:this});this.AttachPMBinding("CurrentChat",h,{scope:this});this.AttachPMBinding("ReadLastMessage",l,{scope:this});this.AttachPMBinding("SetFocus",g,{scope:this});this.AttachPMBinding("SetFocusToTextInput",s,{scope:this});this.AttachPMBinding("ChatConfigPS",ah,{scope:this});this.AttachPMBinding("UpdateDashboard",C,{scope:this});this.AttachPMBinding("UpdateSmartShare",R,{scope:this});this.AttachPMBinding("UpdateFrequentlyUsedText",D,{scope:this});this.AttachPMBinding("UpdatePushUrl",V,{scope:this});this.AttachPMBinding("UpdateKBVisited",y,{scope:this});this.AttachPMBinding("SwitchDisabled",x,{scope:this})};N.prototype.ShowUI=function(){SiebelAppFacade.ChatPhyRenderer.superclass.ShowUI.call(this);O.init({renderer:this,onTitleBarFocus:ai,onHoldTab:ad,onSwitchTab:t,onAgentTyping:B,onSendMessage:W,onKBClick:ag,onActionClick:U,onSmartShareClick:m,onFrequentlyUsedText:af,onPushUrl:i,onImplicitSave:d});O.showUI();var an=$("#s_chatpane").parent();var al=an.siblings("a.next-item-applet").attr("title")+" "+SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_FORM_APPLET");an.attr({role:"region",title:al});var am=$("#SS_ChatUI");if(am){am.attr("role","application")}var ak=$("#s_chatcaption");if(ak){ak.attr({tabindex:"0",role:"label"})}var ao=$("#s_chatpane").find("#s_chatclose");if(ao){ao.attr({tabindex:"0",role:"button"})}};N.prototype.BindEvents=function(){SiebelAppFacade.ChatPhyRenderer.superclass.BindEvents.call(this);var an=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(an){var am=$("#SS_ChatUI");if(am){var ap=$("#s_chatpane").find("#s_chatclose");var ao=$("#s_toolbar").find("[name='Toggle Chat Pane']");var al=$("#s_chatpane").find("#s_chatpaneheader");if(ap.length>0){an.Manage(ap,"click",{ctx:this},e);an.Manage(ap,"keydown",{ctx:this},A)}if(ao.length>0){if(I===undefined||I==="CLOSED"){I="DOCK"}if(I==="DOCK"){M.call(this,am);am.css({top:0,right:"",bottom:"",left:0})}else{if(I==="FLOAT"){aa.call(this,am)}}ao.off("mouseup");an.Manage(ao,"mouseup",{ctx:this},ac)}if(al.length>0){H.call(this,al,am);an.Manage(al,"dblclick",{ctx:this},c)}var ak=$("#CommunicationPanelContainer #commPanelChatToggle");if(ak.length>0){an.Manage(ak,"click",{ctx:this},J);an.Manage(ak,"keydown",{ctx:this},L)}}}};N.prototype.BindData=function(){this.GetPM().ExecuteMethod("LoadChatData")};function e(ak){ak.data.ctx.GetPM().OnControlEvent(F.get("CHAT_PANE_CLOSE"));I="CLOSED";M.call(ak.data.ctx,$("#SS_ChatUI"))}function A(ak){if(ak.which===$.ui.keyCode.ENTER||ak.which===$.ui.keyCode.SPACE){$(this).trigger("click")}}function ac(ak){if(I==="DOCK"){I="HIDDEN";M.call(ak.data.ctx,$("#SS_ChatUI"))}else{if(I==="HIDDEN"){I="DOCK"}else{if(I==="FLOAT"){ak.data.ctx.GetPM().ExecuteMethod("CloseChatPane");I="DOCK"}}}}function J(am){var ak=$(am.target);var al=ak.attr("id");am.preventDefault();if(al==="commPanelChatToShowMore"){O.showMoreMode(am,ak)}else{if(al==="commPanelChatToShowLess"){O.showLessMode(am,ak)}}}function L(ak){if(ak.which===$.ui.keyCode.ENTER||ak.which===$.ui.keyCode.SPACE){J(ak)}}function n(ak){if($("#CommunicationPanelContainer").length>0){$(window).trigger("resize.commpanel",ak)}}function H(al,an){var ak=this;if(an.data("uiDraggable")===undefined){an.draggable({handle:al,start:function(){if(I==="FLOAT"){an.css({right:"",bottom:""})}},drag:function(ao,ap){if(I==="DOCK"){I="FLOAT";aa.call(ak,an)}ap.position=ap.offset},stop:function(av,aw){var aq=aw.offset.top;var au=aw.offset.left;var ap=$(window).width();var ao=an.outerWidth(true);var at=50-ao+parseInt(an.css("marginRight"),10);var ar=$(window).height()-$("#s_chatpane").find("#s_chatpaneheader").outerHeight(true)-$("#s_chatpane").find(".siebui-chat-tab-head").outerHeight(true)-parseInt(an.css("marginTop"),10)-5;if(aq<0){an.css("top",0)}else{if(aq>ar){an.css("top",ar)}}if(SiebelApp.S_App.GetDirection()){if(au<at){an.css("left",at)}else{if(au>(ap-ao)){an.css("left",ap-ao)}}}else{if(au<5){an.css("left",5)}else{if(au>(ap-50)){an.css("left",ap-50)}}}}})}else{an.draggable("option","handle",al)}var am=$("#s_chatpane").find("#s_chatwrap");am.css("cursor","default")}function c(am){var ap=$("#s_chatpane").find("#s_chatwrap");var al=$("#SS_ChatUI");if(I==="FLOAT"){if(X===undefined||X==="MAXIMIZED"){X="MINIMIZED";ap.css("display","none");al.css({top:"",bottom:5})}else{if(X==="MINIMIZED"){X="MAXIMIZED";ap.css("display","");al.css({top:5,bottom:""});var ak=am.data.ctx.GetPM();var an=ak.Get("TextAreaToBeFocusedId");var ao=ak.ExecuteMethod("GetCurrChatId");if(an&&ao===an&&O.exists(an)){O.setFocus(an)}ak.SetProperty("TextAreaToBeFocusedId",null)}}}}function B(al,ak){al.GetPM().ExecuteMethod("AgentTyping",ak)}function ad(am,al,ak){P.call(am,3,"OnHoldTab: "+al);am.GetPM().ExecuteMethod("HoldTab",al,ak)}function W(am,al){var ak=am.GetPM().ExecuteMethod("GetCurrChatId");P.call(am,3,"OnSendMessage: "+al.toString());SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+ak+"] Send Message.");am.GetPM().ExecuteMethod("SendMessage",al)}function d(ak){return ak.GetPM().ExecuteMethod("ImplicitSave")}function t(an,ao,am){var al=an.GetPM();var ap;var ak=al.Get("RestoreScreenEnabled");if(!al.Get("SwitchDisabled")){P.call(an,3,"OnSwitchTab: "+ao+", "+am);SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+am+"] Switch Tab.");if(ak){al.SetProperty("SwitchDisabled",true)}al.ExecuteMethod("SwitchChat",ao,am);if(ak){ap=setTimeout(function(){al.SetProperty("SwitchDisabled",false);al.SetProperty("SwitchTimer",null);P.call(an,2,"OnSwitchChat: No SwitchDone event came in 3 seconds, force switch enabled")},3000);al.SetProperty("SwitchTimer",ap)}}}function j(){var ak=this.GetPM().Get("NewChatMessage");if(ak){O.hideTypingIndicator(ak.chatId);O.appendMessage(ak.chatId,ak.userName,ak.text,ak.timestamp,ak.isAgent,ak.isUrl)
}}function ab(){var ak=this.GetPM().Get("ShowTypingMsg");if(ak){O.showTypingIndicator(ak.Id);setTimeout(function(){O.hideTypingIndicator(ak.Id)},this.GetPM().Get("ChatSysPref").nCustomerTypeDisplayTime)}}function Z(){var al=this.GetPM().Get("ChatResumed");if(al){var ak=al.Id;if(al.state===F.get("CHATUISVC_CHATSTATE_ACTIVE")){O.enableTab(ak)}else{if(al.state===F.get("CHATUISVC_CHATSTATE_WRAPUP")){O.wrapupTab(ak)}else{O.disableTab(ak)}}O.activeTab(ak);if(I==="FLOAT"&&X==="MINIMIZED"){this.GetPM().SetProperty("TextAreaToBeFocusedId",ak)}P.call(this,3,ak+" is resumed")}}function K(){var ak=this.GetPM().Get("ChatIdHold");if(ak){O.disableTab(ak);P.call(this,3,ak+" is held")}}function f(){var ak=this.GetPM().Get("ChatIdRemoved");if(ak){O.closeTab(ak);P.call(this,3,ak+" is removed")}}function Q(){var al=this.GetPM().Get("ChatUpdated");if(al){var ak=al.Id;if(!O.existTab(ak)){O.newTab(ak,al.caption);P.call(this,3,ak+" is added")}else{O.setTabCaption(ak,al.caption);P.call(this,3,ak+" is updated")}if(al.state===F.get("CHATUISVC_CHATSTATE_ACTIVE")){O.enableTab(ak)}else{if(al.state===F.get("CHATUISVC_CHATSTATE_WRAPUP")){O.wrapupTab(ak)}else{O.disableTab(ak)}}if(al.newMsgCnt>0){O.updateUnread(ak,al.newMsgCnt)}O.setTabTooltip(ak,G(al))}}function h(){var al=this.GetPM().Get("CurrentChat");if(al){var ak=al.Id;if(O.existTab(ak)){O.activeTab(ak);P.call(this,3,"Current chat is set to: "+ak)}}}function G(ak){return(ak.newMsgCnt>0)?ak.newMsg:ak.caption}function a(am,al){var ak=this.GetPM().Get("ChatSysPref");if(ak&&ak.bEnableBlinkTab){if(al){am.addEffectForCommToolbar("blink")}else{am.addEffectForCommToolbar("stopblink")}}}function Y(){var ak=this.GetPM().Get("ChatTabMap"),al;for(al in ak){if(ak.hasOwnProperty(al)){var am=ak[al];if(!am){continue}var an=this.GetPM().ExecuteMethod("GetCurrChatId");if(am.Id===an&&am.state!==F.get("CHATUISVC_CHATSTATE_HOLDNEW")){O.changeTabState(al,"terminate holdNew newMsg newMsgHoldNew","remove")}else{if(am.state===F.get("CHATUISVC_CHATSTATE_WRAPUP")||am.state===F.get("CHATUISVC_CHATSTATE_TERMINATE")){O.changeTabState(al,"terminate holdNew newMsg newMsgHoldNew","remove");O.changeTabState(al,"terminate","add")}else{if(am.newMsgCnt>0||am.state===F.get("CHATUISVC_CHATSTATE_HOLDNEW")){if(am.newMsgCnt<=0){O.changeTabState(al,"holdNew","add")}else{if(am.state!==F.get("CHATUISVC_CHATSTATE_HOLDNEW")){O.changeTabState(al,"newMsg","add")}else{O.changeTabState(al,"holdNew","add");O.changeTabState(al,"newMsgHoldNew","add")}}}}}}}}function r(){var ak=this.GetPM().Get("ChatClearLog");if(ak){O.clearMessage(ak.chatId)}}function u(){var ak=this.GetPM().ExecuteMethod("GetCurrChatId");var al=this.GetPM().Get("TextInput4Set");O.setInputText(ak,al)}function v(){var al=this.GetPM().ExecuteMethod("GetCurrChatId");var ak=this.GetPM().Get("UrlInput4Set");O.setInputUrl(al,ak)}function ae(ak){var al=O.getInputText(ak);this.GetPM().AddProperty("TextInput4Get",al)}function p(al){var ak=O.getInputUrl(al);this.GetPM().AddProperty("UrlInput4Get",ak)}function l(){var ak=this.GetPM().Get("ReadLastMessage");O.readLastMessage(ak)}function g(){if(I==="DOCK"||I==="FLOAT"){var ak=this.GetPM().ExecuteMethod("GetCurrChatId");if(ak&&O.existTab(ak)){O.setFocus(ak)}else{ai()}}}function ai(){$("#s_chatcaption").focus()}function P(al,ak){this.GetPM().ExecuteMethod("LogMsg",al,"chatprenderer.js: "+ak)}function aa(ak){ak.css("position","fixed");ak.css("z-index","99");$("#_sweview").removeClass("siebui-chatpane-content-indent")}function M(ak){ak.css("position","");ak.css("z-index","")}function s(){var al=this.GetPM();var ak=al.ExecuteMethod("GetCurrChatId");if(ak&&O.existTab(ak)){if(I==="DOCK"||(I==="FLOAT"&&X!=="MINIMIZED")){O.setFocus(ak)}else{if(I==="FLOAT"&&X==="MINIMIZED"){al.SetProperty("TextAreaToBeFocusedId",ak)}}}}function ah(){var ar=this.GetPM().Get("ChatConfigPS"),au=[];var an=$("#s_chatcaption");if(an){var av=q(F.get("CHATCC_METADATA_CTRLNAME_CHATTITLE"),ar);an.html(av);an.attr({"aria-label":av,title:av})}var ap=$("#s_chatpane").find("#s_chatclose");if(ap){var al=q(F.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),ar);var aq=k(F.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),ar);var am=S(F.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),ar);ap.attr({"aria-label":al,title:O.getButtonTooltip(al,aq)});if(am!==F.get("CHATUISVC_VALUE_YES")){ap.hide()}O.bindHotkey(O.$dom.chatPaneEl,aq,"closeChat")}O.updateDashboardSwitch({display:q(F.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),ar)},{display:q(F.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),ar)});O.updateTextLabel({display:q(F.get("CHATCC_METADATA_CTRLNAME_TEXT"),ar)});O.updateTextLinks([{display:q(F.get("CHATCC_METADATA_CTRLNAME_PASTE"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_PASTE"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_PASTE"),ar),fnName:"smartShare",fnType:"mousedown",className:"siebui-chat-toolbar-share"},{display:q(F.get("CHATCC_METADATA_CTRLNAME_FUT"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_FUT"),ar),fnName:"frequentlyUsedText",visible:S(F.get("CHATCC_METADATA_CTRLNAME_FUT"),ar),fnType:"click",className:"siebui-chat-toolbar-used-txt"},{display:q(F.get("CHATCC_METADATA_CTRLNAME_SEND"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_SEND"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_SEND"),ar),fnName:"sendText",fnType:"click",className:"siebui-chat-toolbar-send-txt"}]);O.updateUrlLabel({display:q(F.get("CHATCC_METADATA_CTRLNAME_URL"),ar)});O.updateUrlLinks([{display:q(F.get("CHATCC_METADATA_CTRLNAME_URLLIB"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_URLLIB"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_URLLIB"),ar),fnName:"pushUrl",fnType:"click",className:"siebui-chat-toolbar-push-url"},{display:q(F.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),ar),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),ar),visible:S(F.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),ar),fnName:"sendUrl",fnType:"click",className:"siebui-chat-toolbar-send-url"}]);var at=ar.GetChildByType(F.get("CHATCC_METADATA_CTRLNAME_DASHBOARDFIELDS"));if(at){au=z.call(this,at,ar);var ak=ar.GetChildByType(F.get("CHATCC_METADATA_CTRLNAME_ACTIONLABEL"));if(ak){var ao=w.call(this,ak,ar);if(ao){au.push(ao)}}O.createDashboard(au)}O.setSystemMessage(q(F.get("CHATCC_METADATA_CTRLNAME_SYSTEMMESSAGE"),ar));O.setTypingIndicator(q(F.get("CHATCC_METADATA_CTRLNAME_CUSTOMERTYPINGMESSAGE"),ar))}function q(al,an){var ak=an.GetChildByType(al),am="";if(ak){am=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_DISPLAY"))}return am}function k(am,an){var al=an.GetChildByType(am),ak="";if(al){ak=al.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_HOTKEY"))}return ak}function S(al,am){var ak=am.GetChildByType(al),an=F.get("CHATUISVC_VALUE_YES");if(ak){an=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_VISIBLE"))}return an}function z(az,ax){var ay=[],al=[],au=az.GetChildCount(),ar,ao,av;for(ar=0;ar<au;++ar){var ak=az.GetChild(ar),am=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_CTRLNAME")),an=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_LENGTH")),aw=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_DISPLAY")),ap=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_VISIBLE")),aA=parseInt(ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_ROW")),10),aq=parseInt(ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_COLUMN")),10),at=(aA-1)*2+aq-1;
ay[at]={name:am,length:an.toLowerCase(),visible:ap,label:aw.replace(":",""),field:{type:"text"}}}for(ar in ay){if(ay.hasOwnProperty(ar)){al.push(ay[ar])}}av={display:q(F.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),ax),visible:S(F.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),ax),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),ax)};ao=q(F.get("CHATCC_METADATA_CTRLNAME_KB"),ax);al.push({name:F.get("CHATCC_METADATA_CTRLNAME_KB"),length:"full",visible:S(F.get("CHATCC_METADATA_CTRLNAME_KB"),ax),label:ao.replace(":",""),field:{type:"input"},button:av});return al}function w(an,au){var am,at,aq,al=[],av=[],ao;am=an.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_VISIBLE"));at=an.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_DISPLAY"));if(am===F.get("CHATUISVC_VALUE_YES")){var ar=an.GetChildCount(),ap;for(ap=0;ap<ar;++ap){var ak=an.GetChild(ap);if(ak){am=ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_VISIBLE"));if(am===F.get("CHATUISVC_VALUE_YES")){av.push(ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_CTRLNAME")));al.push(ak.GetPropertyAsStr(F.get("CHATCC_METADATA_TAG_DISPLAY")))}}}ao={display:q(F.get("CHATCC_METADATA_CTRLNAME_GO"),au),visible:S(F.get("CHATCC_METADATA_CTRLNAME_GO"),au),hotkey:k(F.get("CHATCC_METADATA_CTRLNAME_GO"),au)};aq={name:F.get("CHATCC_METADATA_CTRLNAME_ACTIONLABEL"),length:"full",visible:F.get("CHATUISVC_VALUE_YES"),label:at.replace(":",""),field:{type:"combo",options:al.join(","),actions:av.join(",")},button:ao};return aq}return null}function C(){var ak=this.GetPM().Get("UpdateDashboard");if(ak){O.updateDashboard(ak)}}function R(){O.appendInputText(this.GetPM().Get("UpdateSmartShare"))}function D(){O.appendInputText(this.GetPM().Get("UpdateFrequentlyUsedText"))}function V(){var al=this.GetPM().Get("UpdatePushUrl");var ak={text:al,chatId:O.currChatId,userName:O.currUserName,isUrl:true};O.onSendMessage(O.renderer,ak)}function y(){var ak=this.GetPM().Get("UpdateKBVisited");O.updateKBVisited(ak)}function x(){if(this.GetPM().Get("SwitchDisabled")){$(".siebui-chat-tab-head-item a").addClass("siebui-chat-tab-head-item-unclickable")}else{$(".siebui-chat-tab-head-item a").removeClass("siebui-chat-tab-head-item-unclickable")}}function o(ak){if(ak){SiebelApp.S_App.GetService("Communications Client").InvokeMethod(ak)}}function U(ao,an){var al=ao.GetPM(),ak=al.ExecuteMethod("GetCurrChatId"),am=CCFMiscUtil_CreatePropSet();am.SetPropertyStr(F.get("CHATUISVC_TAG_CURRCHATID"),ak);am.SetPropertyStr(F.get("CHATUISVC_TAG_ACTION"),an);al.ExecuteMethod("InvokeServiceMethod",F.get("CHATUISVC_METHOD_SERVERACTION"),am)}function ag(){o("PickKBVisited")}function m(ao){var ak=b();if(ak){O.appendInputText(ak);return}var am=ao.GetPM(),al=am.ExecuteMethod("GetCurrChatId"),an=CCFMiscUtil_CreatePropSet();an.SetPropertyStr(F.get("CHATUISVC_TAG_CURRCHATID"),al);am.ExecuteMethod("InvokeServiceMethod",F.get("CHATUISVC_METHOD_GETSMARTSHARETEXT"),an)}function af(){o("PickFrequentlyUsedText")}function i(){o("PickURLLibrary")}function b(){var ao="";try{if(window.getSelection){if(document.activeElement&&document.activeElement.tagName&&(document.activeElement.tagName.toLowerCase()==="textarea"||document.activeElement.tagName.toLowerCase()==="input")){var an=document.activeElement.value;ao=an.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ak=window.getSelection();ao=ak.toString()}}else{if(document.selection&&document.selection.createRange){var al=document.selection.createRange();ao=al.text}}}catch(am){SiebelApp.S_App.CommToolbarUtil.Log(3,"commToolbarprender.js: get selected text failed!")}return ao}var T={tmplTabArea:'<div class="siebui-chat-tabs"><div class="siebui-chat-tab-head"><ul id="chatTabItems" class="siebui-chat-tab-head-items" role="tablist"></ul><div class="siebui-chat-toggle-area"><div class="siebui-chat-dashboard-toggle" id="chatToggleDashboard"><div class="siebui-chat-title-wrap" title=""><a href="javascript:;" id="chatToHideDashboard" class="siebui-chat-dashboard-switch-visible" data-clickFn="hideDashboard" role="button" aria-hidden="false" aria-label="" tabindex="0"></a></div><div class="siebui-chat-title-wrap" title=""><a href="javascript:;" id="chatToShowDashboard" class="siebui-chat-dashboard-switch-hidden" data-clickFn="showDashboard" role="button" aria-hidden="true" aria-label="" tabindex="0" style="display: none;"></a></div></div></div></div><div class="siebui-chat-tab-body" role="tabpanel"><div id="chatDashboard" class="siebui-chat-dashboard" role="grid"></div><div id="chatMsg" class="siebui-chat-msg"><ul id="chatMsgLog" class="siebui-chat-msg-log" role="log" tabindex="-1"></ul><div id="chatTyping" class="siebui-chat-msg-typing" role="status" aria-live="assertive"></div><div id="chatNewMsg" class="siebui-chat-msg-reading" role="status" aria-live="assertive"></div></div></div></div>',tmplTextArea:'<div id="chatTextArea"><div id="chatTextToolbar" class="siebui-chat-toolbar siebui-chat-toolbar-txt" role="toolbar"><div id="chatTextLabel" class="siebui-chat-toolbar-label"><span tabindex="0" title="" aria-label=""></span></div><div id="chatTextLinks" class="siebui-chat-toolbar-links"></div></div><div id="chatInputWrap" class="siebui-chat-in siebui-chat-text-in"><textarea id="chatTextInput" class="siebui-chat-input siebui-chat-text-input" name="chatTextInput" tabindex="0" role="textbox" aria-label=""></textarea></div></div>',tmplTextLink:'<div class="siebui-chat-title-wrap" title="{{title}}"><a href="javascript:;" class="siebui-chat-toolbar-item {{className}}" data-mousedownFn="{{mousedownFnName}}" data-clickFn="{{clickFnName}}" aria-label="{{label}}" role="button" tabindex="-1">{{text}}</a></div>',tmplUrlArea:'<div id="chatUrlArea" class="siebui-chat-url-area"><div id="chatUrlToolbar" class="siebui-chat-toolbar siebui-chat-toolbar-url" role="toolbar"><div id="chatUrlLabel" class="siebui-chat-toolbar-label"><span tabindex="0" title="" aria-label=""></span></div><div id="chatUrlLinks" class="siebui-chat-toolbar-links"></div></div><div class="siebui-chat-in siebui-chat-url-in"><input id="chatUrlInput" class="siebui-chat-input siebui-chat-url-input" name="chatUrlInput" tabindex="0" role="textbox" aria-label="" /></div></div>',tmplUrlLink:'<div class="siebui-chat-title-wrap" title="{{title}}"><a href="javascript:;" class="siebui-chat-toolbar-item {{className}}" data-mousedownFn="{{mousedownFnName}}" data-clickFn="{{clickFnName}}" aria-label="{{label}}" role="button" tabindex="-1">{{text}}</a></div>',tmplMaskArea:'<div class="siebui-chat-mask" id="chatMask"></div>',tmplTabHeadItem:'<li class="siebui-chat-tab-head-item" tabindex="-1" role="tab" aria-selected="false" aria-label="{{userName}}" data-chatId="{{chatId}}" data-userName="{{userName}}" data-clickFn="clickTab clickTabItemTabindex"><div class="siebui-chat-title-wrap" title="{{userName}}"><a href="javascript:;" tabindex="-1">{{userName}}</a></div><span class="siebui-chat-tab-head-item-count" style="display: none;"></span></li>',tmplDashboardItemShort:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-short" data-clickFn="clickDashboardTabindex" tabindex="-1" aria-label="{{label}}:{{text}}" title="{{label}}:{{text}}"  role="row"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><p class="siebui-chat-dashboard-item-content-txt">{{text}}</p></div></div></div>',tmplDashboardItemLong:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long" data-clickFn="clickDashboardTabindex" tabindex="-1" aria-label="{{label}}:{{text}}" title="{{label}}:{{text}}"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content><div class="siebui-chat-dashboard-item-content-wrap"><p class="siebui-chat-dashboard-item-content-txt">{{text}}</p></div></div></div>',tmplDashboardItemRichInput:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name" tabindex="-1" aria-label="{{label}}" title="{{label}}" data-clickFn="clickDashboardTabindex">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><input id="chatKBVisited" class="siebui-chat-dashboard-item-content-rich" type="text" value="{{text}}" aria-label="{{text}}" title="{{text}}" data-clickFn="clickDashboardTabindex" tabindex="-1" role="textbox" readonly /><div class="siebui-chat-title-wrap" title="{{buttonTooltip}}"><a href="javascript:;" data-clickFn="clickKB clickDashboardTabindex" class="siebui-chat-dashboard-item-content-btn siebui-chat-dashboard-kb-btn" tabindex="-1" role="button" aria-label="{{buttonLabel}}">{{buttonLabel}}</a></div></div></div></div>',tmplDashboardItemRichSelect:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long {{className}}"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name" tabindex="-1" aria-label="{{label}}" data-clickFn="clickDashboardTabindex" title="{{label}}">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><select id="chatAction" class="siebui-chat-dashboard-item-content-rich" data-clickFn="clickDashboardTabindex" tabindex="-1" role="combobox">{{options}}</select><div class="siebui-chat-title-wrap" title="{{buttonTooltip}}"><a href="javascript:;" data-clickFn="clickAction clickDashboardTabindex" class="siebui-chat-dashboard-item-content-btn siebui-chat-dashboard-action-btn" tabindex="-1" role="button" aria-label="{{buttonLabel}}">{{buttonLabel}}</a></div></div></div></div>',tmplOption:'<option data-action="{{action}}" {{isSelect}} role="option" aria-label="{{option}}">{{option}}</option>',tmplMsgLogItem:'<li class="siebui-chat-msg-log-item {{agentClassName}}" tabindex="-1" aria-label="{{userName}} {{time}} {{msg}}" data-clickFn="clickTabindex"><span class="siebui-chat-msg-log-item-name" title="{{userName}}">{{userName}}</span><span class="siebui-chat-msg-log-item-date" title="{{time}}">({{time}})</span><span class="siebui-chat-msg-log-item-colon">:</span><p class="siebui-chat-msg-log-item-content" title="{{msg}}">{{msg}}</p></li>',tmplMsgLogUrlItem:'<li class="siebui-chat-msg-log-item {{agentClassName}}" tabindex="-1" aria-label="{{userName}} {{time}} {{msg}}" data-clickFn="clickTabindex"><span class="siebui-chat-msg-log-item-name" title="{{userName}}">{{userName}}</span><span class="siebui-chat-msg-log-item-date" title="{{time}}">({{time}})</span><span class="siebui-chat-msg-log-item-colon">:</span><a href="{{url}}" title="{{msg}}" class="siebui-chat-msg-log-item-content" target="_blank">{{msg}}</a></li>'};
var O={empty:function(){},getTotalHeight:function(al){if(!al||!al.length){return}var ao=parseInt(al.css("margin-top")||0,10)+parseInt(al.css("margin-bottom")||0,10);var an=parseInt(al.css("padding-top")||0,10)+parseInt(al.css("padding-bottom")||0,10);var am=parseInt(al.css("border-top")||0,10)+parseInt(al.css("border-bottom")||0,10);var ak=ao+an+am+(al.height()||0);return ak},getCursorPosition:function(ak){var am=0;var al=null;if(document.selection){al=document.selection.createRange();al.moveStart("character",-ak.value.length);am=al.text.length}else{if(ak.selectionStart||ak.selectionStart==="0"){am=ak.selectionStart}}return am},setCursorPosition:function(al,am){var ak=null;if(al.setSelectionRange){al.focus();al.setSelectionRange(am,am)}else{if(al.createTextRange){ak=al.createTextRange();ak.collapse(true);ak.moveEnd("character",am);ak.moveStart("character",am);ak.select()}}},isKeysEqual:function(al,ak){return al.sort().join("")===ak.sort().join("")},isKeyExist:function(an,am){if(an===""||an===undefined){return true}var al=0;var ak=0;var ao=null;for(al=0,ak=am.length;al<ak;al++){ao=am[al];if(ao.key===an){return true}}return false},compileTMPL:function(ap,ao,am){var aq="";var an=null;var al="";var ak=ap;for(aq in ao){if(ao.hasOwnProperty(aq)){al="{{\\s*"+aq+"\\s*}}";an=new RegExp(al,"g");ak=ak.replace(an,ao[aq])}}return ak},adaptSize:function(){var ak=$("#SS_ChatUI");if(ak.length){this.$dom.chatEl.width(ak.width())}},initEl:function(){this.$dom.chatUI=$("#CommunicationPanelContainer #SS_ChatUI");this.$dom.chatPaneEl=$("#s_chatpane");this.$dom.chatCloseEl=$("#s_chatclose");this.$dom.chatTabItems=$("#chatTabItems");this.$dom.chatDashboard=$("#chatDashboard");this.$dom.commPanelChatToggle=$("#commPanelChatToggle");this.$dom.commPanelChatToShowLess=$("#commPanelChatToShowLess");this.$dom.commPanelChatToShowMore=$("#commPanelChatToShowMore");this.$dom.chatToggleDashboard=$("#chatToggleDashboard");this.$dom.chatToShowDashboard=$("#chatToShowDashboard");this.$dom.chatToHideDashboard=$("#chatToHideDashboard");this.$dom.chatMsg=$("#chatMsg");this.$dom.chatMsgLog=$("#chatMsgLog");this.$dom.chatMask=$("#chatMask");this.$dom.chatTyping=$("#chatTyping");this.$dom.chatNewMsg=$("#chatNewMsg");this.$dom.chatTextArea=$("#chatTextArea");this.$dom.chatTextToolbar=$("#chatTextToolbar");this.$dom.chatTextLabel=$("#chatTextLabel");this.$dom.chatTextLinks=$("#chatTextLinks");this.$dom.chatInputWrap=$("#chatInputWrap");this.$dom.chatTextInput=$("#chatTextInput");this.$dom.chatUrlArea=$("#chatUrlArea");this.$dom.chatUrlToolbar=$("#chatUrlToolbar");this.$dom.chatUrlLabel=$("#chatUrlLabel");this.$dom.chatUrlLinks=$("#chatUrlLinks");this.$dom.chatUrlInput=$("#chatUrlInput")},bindHotkey:function(av,at,ak,au){if(at===""||ak===""){return}if(au){au="enabled "+au}else{au="enabled"}var an=this.keyFnArr;var aq=this.isKeyExist;var am=at.split(";");var al=0;var ao=0;var ar="";var ap=false;for(al=0,ao=am.length;al<ao;al++){ar=am[al].toLowerCase().replace(/\s/g,"");ap=aq(ar,an);if(!ap){an.push({key:ar,fnName:ak,triggerStatus:au.split(" ")})}}},bindListener:function(){this.eventHelper.Manage(this.$dom.chatPaneEl,"keydown",{ctx:this},this.chatKeyDown);this.eventHelper.Manage(this.$dom.chatEl,"click",{ctx:this},this.chatClick);this.eventHelper.Manage(this.$dom.chatEl,"mousedown",{ctx:this},this.chatMouseDown);this.eventHelper.Manage(this.$dom.chatTabItems,"keydown",{ctx:this},this.chatTabItemsKeyDown);this.eventHelper.Manage(this.$dom.chatDashboard,"keydown",{ctx:this},this.chatDashboardKeyDown);this.eventHelper.Manage(this.$dom.chatMsgLog,"keydown",{ctx:this},this.chatMsgLogKeyDown);this.eventHelper.Manage(this.$dom.chatTextLinks,"keydown",{ctx:this},this.chatTextLinksKeyDown);this.eventHelper.Manage(this.$dom.chatTextInput,"input",{ctx:this},this.chatTextInputChange);this.eventHelper.Manage(this.$dom.chatTextInput,"keyup",{ctx:this},this.chatTextInputKeyUp);this.eventHelper.Manage(this.$dom.chatTextInput,"click",{ctx:this},this.chatTextInputClick);this.eventHelper.Manage(this.$dom.chatTextInput,"keydown",{ctx:this},this.chatTextInputKeyDown);this.eventHelper.Manage(this.$dom.chatTextInput,"keypress",{ctx:this},this.chatTextInputKeyPress);this.eventHelper.Manage(this.$dom.chatUrlLinks,"keydown",{ctx:this},this.chatUrlLinksKeyDown);this.eventHelper.Manage(this.$dom.chatUrlInput,"input",{ctx:this},this.chatUrlInputChange);this.eventHelper.Manage(this.$dom.chatUrlInput,"keydown",{ctx:this},this.chatUrlInputKeyDown);this.eventHelper.Manage(this.$dom.chatUrlInput,"keypress",{ctx:this},this.chatUrlInputKeyPress);this.eventHelper.Manage(this.$dom.chatMsg,"resize",{ctx:this,child:this.$dom.chatMsgLog,diff:this.$dom.chatMsg.height()-this.$dom.chatMsgLog.height()},this.onChatControlResize);this.eventHelper.Manage(this.$dom.chatInputWrap,"resize",{ctx:this,child:this.$dom.chatTextInput,diff:this.$dom.chatInputWrap.height()-this.$dom.chatTextInput.height()},this.onChatControlResize)},chatKeyDown:function(al){var ak=al.data.ctx;if(al.keyCode===$.ui.keyCode.ENTER||al.keyCode===$.ui.keyCode.SPACE){ak.chatKeyDownFn(al)}ak.hotKeyFn(al);ak.preventTabFn(al)},hotKeyFn:function(ar){var aq=ar.data.ctx;var ao=aq.keyFnArr;var an=null;var av=null;var ak="";var au=-1;var at=null;var am;var ap=ao.length;var al=aq.storedMap[aq.currChatId].status;for(am=0;am<ap;am++){an=ao[am];av=an.key.toLowerCase().split("+");ak=av[av.length-1];au=ak.toUpperCase().charCodeAt(0);at=[ak];if(ar.keyCode===au){if(ar.ctrlKey){at.push("ctrl")}if(ar.shiftKey){at.push("shift")}if(ar.altKey){at.push("alt")}if(aq.isKeysEqual(av,at)){if(an.triggerStatus.indexOf(al)!==-1){aq[an.fnName]&&aq[an.fnName](ar)}ar.preventDefault();ar.stopPropagation()}}}},preventTabFn:function(an){var am=an.data.ctx;var ak=$(an.target);var al=ak.parent().attr("id");if(al==="chatTextLinks"&&!an.shiftKey&&an.keyCode===$.ui.keyCode.TAB){an.preventDefault();am.setChatTextInputFocus()}if(al==="chatUrlLabel"&&an.shiftKey&&an.keyCode===$.ui.keyCode.TAB){an.preventDefault();am.setChatTextInputFocus()}},chatClick:function(am){var al=am.data.ctx;var ak=$(am.target);var an="";while(ak.attr("id")!=="s_chatwrap"){an=ak&&ak.attr("data-clickFn");if(an){al.clickFn(am,ak)}ak=ak.parent()}},chatMouseDown:function(am){var al=am.data.ctx;var ak=$(am.target);var an="";while(ak.attr("id")!=="s_chatwrap"){an=ak&&ak.attr("data-mousedownFn");if(an){al.mousedownFn(am,ak)}ak=ak.parent()}},clickFn:function(ao,al){var ap=al.attr("data-clickFn");var an=ap.split(" ");var am;var ak=an.length;for(am=0;am<ak;am++){switch(an[am]){case"showDashboard":this.showDashboard(ao,al);break;case"hideDashboard":this.hideDashboard(ao,al);break;case"showLessMode":this.showLessMode(ao,al);break;case"showMoreMode":this.showMoreMode(ao,al);break;case"sendText":if(this.isDisabled()||this.isWrapup()){break}this.sendText(ao,al);break;case"frequentlyUsedText":if(this.isDisabled()||this.isWrapup()){break}this.frequentlyUsedText(ao,al);break;case"pushUrl":if(this.isDisabled()||this.isWrapup()){break}this.pushUrl(ao,al);break;case"sendUrl":if(this.isDisabled()||this.isWrapup()){break
}this.sendUrl(ao,al);break;case"clickTab":this.clickTab(ao,al);break;case"clickKB":if(this.isDisabled()||this.isWrapup()){break}this.clickKB(ao,al);break;case"clickAction":if(this.isDisabled()){break}this.clickAction(ao,al);break;case"clickTabindex":this.setTabindex(al);break;case"clickDashboardTabindex":this.setTabindexByArea(al,this.$dom.chatDashboard);break;case"clickTabItemTabindex":this.setTabindexByArea(al,this.$dom.chatTabItems);break}}},mousedownFn:function(ao,al){var ap=al.attr("data-mousedownFn");var an=ap.split(" ");var am;var ak=an.length;for(am=0;am<ak;am++){switch(an[am]){case"smartShare":if(this.isDisabled()||this.isWrapup()){break}this.smartShare(ao,al);break}}},chatKeyDownFn:function(ao){var an=ao.data.ctx;var ak=$(ao.target);var am="";var al="";am=ak&&ak.attr("data-clickFn");al=ak&&ak.attr("data-mousedownFn");if(am){ao.preventDefault();setTimeout(function(){an.clickFn(ao,ak)},1)}if(al){an.mousedownFn(ao,ak);ao.preventDefault()}},onLeftRightFn:function(ao,am,an,ak){var al=null;if(ao.keyCode===$.ui.keyCode.LEFT||(ao.ctrlKey&&ao.shiftKey&&ao.keyCode===$.ui.keyCode.TAB)){if(!this.isRtl){al=(an===undefined)?am.prev():an}else{al=(ak===undefined)?am.next():ak}}else{if(ao.keyCode===$.ui.keyCode.RIGHT||(ao.ctrlKey&&ao.keyCode===$.ui.keyCode.TAB)){if(!this.isRtl){al=(ak===undefined)?am.next():ak}else{al=(an===undefined)?am.prev():an}}}if(al&&al.length===1){am.attr("tabindex","-1");am.attr("aria-selected","false");al.attr("tabindex","0");al.attr("aria-selected","true");al.focus();ao.preventDefault();ao.stopPropagation()}},beforeLeftRightFn:function(aq,al){var ao=null;var ap=null;var am=null;var an;var ak=al.length;for(an=0;an<ak;an++){if($(al[an]).attr("tabindex")==="0"){ao=$(al[an]);ap=$(al[an-1]);am=$(al[an+1]);break}}this.onLeftRightFn(aq,ao,ap,am)},setTabindex:function(ak){if(!ak||ak.length===0){return}ak.attr("aria-selected","true").attr("tabindex",0);ak.siblings().attr("aria-selected",false).attr("tabindex","-1")},setTabindexByArea:function(al,am){if(!al||al.length===0||!am||am.length===0){return}var ak=am.find("[tabindex=0]");ak.attr("aria-selected","false").attr("tabindex",-1);al.attr("aria-selected","true").attr("tabindex",0)},setDefaultTabindex:function(am){var an=null;var ak=null;var al=null;switch(am){case"tabs":an=this.$dom.chatTabItems;ak=an.find("li[tabindex=0]");al=an.find("li[tabindex]").first();break;case"dashboard":an=this.$dom.chatDashboard;ak=an.find("[tabindex=0]");al=an.find("[tabindex]").first();break;case"msgLog":an=this.$dom.chatMsgLog;ak=an.find("li[tabindex=0]");al=an.find("li[tabindex]").last();break;case"textToolbar":an=this.$dom.chatTextLinks;ak=an.find("a[tabindex=0]");al=an.find("a[tabindex]").first();break;case"urlToolbar":an=this.$dom.chatUrlLinks;ak=an.find("a[tabindex=0]");al=an.find("a[tabindex]").first();break}if(ak&&ak.length===0){if(al&&al.length===1){al.attr("tabindex","0");al.attr("aria-selected","true")}}},chatTabItemsKeyDown:function(am){var al=am.data.ctx;var ak=al.$dom.chatTabItems.find("li[tabindex]");al.beforeLeftRightFn(am,ak)},chatDashboardKeyDown:function(am){var al=am.data.ctx;var ak=al.$dom.chatDashboard.find("[tabindex]");al.beforeLeftRightFn(am,ak)},chatMsgLogKeyDown:function(an){var am=an.data.ctx;var ao=am.$dom.chatMsgLog;var al=ao.children("li[tabindex=0]");var ak=null;if(an.keyCode===$.ui.keyCode.UP){ak=al.prev()}else{if(an.keyCode===$.ui.keyCode.DOWN){ak=al.next()}else{if(an.keyCode===$.ui.keyCode.HOME){ak=ao.children("li").first()}else{if(an.keyCode===$.ui.keyCode.END){ak=ao.children("li").last()}}}}if(ak&&ak.length===1){al.attr("tabindex","-1");al.attr("aria-selected","false");ak.attr("tabindex","0");ak.attr("aria-selected","true");ak.focus();an.preventDefault();an.stopPropagation()}},chatTextLinksKeyDown:function(am){var al=am.data.ctx;var ak=al.$dom.chatTextLinks.find("[tabindex]");al.beforeLeftRightFn(am,ak)},chatTextInputChange:function(an){var am=an?an.data.ctx:this;if(am.$dom.chatEl.length===0){return}var ao=am.$dom.chatTextInput.val();var ak=ao.replace(/\s/g,"").length;var al=am.$dom.chatTextLinks;if(ak){al.removeClass("siebui-chat-toolbar-links-send-disabled")}else{al.addClass("siebui-chat-toolbar-links-send-disabled")}if(ao.length>am.MESSAGE_COUNT){am.$dom.chatTextInput.val(ao.substring(0,am.MESSAGE_COUNT))}},chatTextInputClick:function(al){var ak=al.data.ctx;ak.chatTextInputKeyUp(al)},chatTextInputKeyUp:function(an){var al=an.data.ctx;var ak=al.$dom.chatTextInput;var am=al.getCursorPosition(ak[0]);al.storedMap[al.currChatId].toSendPos=am},chatTextInputKeyDown:function(al){var ak=al.data.ctx;if(ak.isDisabled()||ak.isWrapup()){return}if(!al.shiftKey&&al.keyCode===$.ui.keyCode.ENTER){al.preventDefault();al.stopPropagation();setTimeout(function(){ak.sendText(al)},1)}},setChatTextInputFocus:function(){var al=this;var ak=al.$dom.chatTextInput;var am=al.storedMap[al.currChatId].toSendPos||-1;if(am===-1){am=ak.val().length}al.setCursorPosition(ak[0],am)},chatTextInputKeyPress:function(al){var ak=al.data.ctx;if(ak.isDisabled()||ak.isWrapup()){return}ak.onTyping(ak.renderer,ak.currChatId)},chatUrlLinksKeyDown:function(am){var al=am.data.ctx;var ak=al.$dom.chatUrlLinks.find("[tabindex]");al.beforeLeftRightFn(am,ak)},chatUrlInputKeyDown:function(al){var ak=al.data.ctx;if(ak.isDisabled()||ak.isWrapup()){return}if(al.keyCode===13){al.preventDefault();al.stopPropagation();ak.sendUrl(al)}},chatUrlInputChange:function(an){var am=an?an.data.ctx:this;if(am.$dom.chatEl.length===0){return}var ak=am.$dom.chatUrlInput.val().replace(/\s/g,"").length;var al=am.$dom.chatUrlLinks;if(ak){al.removeClass("siebui-chat-toolbar-links-send-disabled")}else{al.addClass("siebui-chat-toolbar-links-send-disabled")}},chatUrlInputKeyPress:function(al){var ak=al.data.ctx;if(ak.isDisabled()||ak.isWrapup()){return}ak.onTyping(ak.renderer,ak.currChatId)},showDashboard:function(am,ak){var al=this.$dom.chatToHideDashboard.css("display")!=="none";if(al){return}else{this.$dom.chatToHideDashboard.show().attr("aria-hidden",false);this.$dom.chatToShowDashboard.hide().attr("aria-hidden",true);if(am&&ak){this.$dom.chatToHideDashboard.focus()}this.toggleDashboardArea("show")}},hideDashboard:function(am,ak){var al=this.$dom.chatToShowDashboard.css("display")!=="none";if(al){return}else{this.$dom.chatToShowDashboard.show().attr("aria-hidden",false);this.$dom.chatToHideDashboard.hide().attr("aria-hidden",true);if(am&&ak){this.$dom.chatToShowDashboard.focus()}this.toggleDashboardArea("hide")}},toggleDashboardArea:function(am){var an=this.$dom.chatDashboard;var al=this.$dom.chatMsgLog;var ak=this.getTotalHeight(an);if(am==="show"){al.height(al.height()-ak);an.show()}else{if(am==="hide"){al.height(al.height()+ak);an.hide()}}},showLessMode:function(am,ak){if(this.$dom.commPanelChatToShowMore.length===0||this.$dom.commPanelChatToShowLess.length===0){return}var al=this.$dom.commPanelChatToShowMore.css("display")!=="none";if(al){return}else{this.$dom.commPanelChatToShowMore.show().attr("aria-hidden",false);this.$dom.commPanelChatToShowLess.hide().attr("aria-hidden",true);
if(am&&ak){this.$dom.commPanelChatToShowMore.focus()}this.toggleModeArea(am)}},showMoreMode:function(am,ak){if(this.$dom.commPanelChatToShowMore.length===0||this.$dom.commPanelChatToShowLess.length===0){return}var al=this.$dom.commPanelChatToShowLess.css("display")!=="none";if(al){return}else{this.$dom.commPanelChatToShowLess.show().attr("aria-hidden",false);this.$dom.commPanelChatToShowMore.hide().attr("aria-hidden",true);if(am&&ak){this.$dom.commPanelChatToShowLess.focus()}this.toggleModeArea(am)}},toggleModeArea:function(am){var ak=this.$dom.chatUI;var al="enable";ak.toggleClass("siebui-comm-panel-less");if(ak.hasClass("siebui-comm-panel-less")){al="disable"}this.$dom.chatMsg.resizable(al);this.$dom.chatInputWrap.resizable(al);n.call(am.data.ctx,"Chat: Toggle")},closeChat:function(al,ak){this.$dom.chatCloseEl.trigger("click")},sendText:function(an,ak){var al=this;var ao=al.$dom.chatTextInput.val();var am={text:ao,chatId:al.currChatId,userName:al.currUserName,isUrl:false};al.$dom.chatTextInput.val("");al.chatTextInputChange();if(ao.replace(/\s/g,"")!==""){al.onSendMessage(al.renderer,am)}},smartShare:function(al,ak){this.onSmartShareClick(this.renderer)},frequentlyUsedText:function(al,ak){this.onFrequentlyUsedText(this.renderer)},sendUrl:function(an,ak){var al=this;var ao=al.$dom.chatUrlInput.val();var am={text:ao,chatId:al.currChatId,userName:al.currUserName,isUrl:true};al.$dom.chatUrlInput.val("");al.chatUrlInputChange();if(ao.replace(/\s/g,"")!==""){al.onSendMessage(al.renderer,am)}},pushUrl:function(al,ak){this.onPushUrl(this.renderer)},clickTab:function(ao,ak){var am=this;var al=ak.attr("data-chatId");var an=ak.attr("data-userName");am.switchTab(al,an)},clickKB:function(an,ak){var am=this;var al=am.$dom.chatKBVisited;var ao=al.val();am.onKBClick()},clickAction:function(an,ak){var am=this;var al=am.$dom.chatAction;var ao=al.find("option:selected").attr("data-action");am.onActionClick(am.renderer,ao)},updateUnread:function(am,ak){var an=this.storedMap[am];var al=an.tabEl;an.unread=ak||1;al.addClass("siebui-chat-tab-head-item-blink");al.children("span:first").text(an.unread).show()},clearUnread:function(al){var am=this.storedMap[al];var ak=am.tabEl;am.unread=0;ak.removeClass("siebui-chat-tab-head-item-blink");ak.children("span:first").text("").hide()},createDashboard:function(al){this.currDashboard=al;this.renderDashboard(al);var am=0;var ak=al.length;var an=null;for(am=0;am<ak;am++){an=al[am];if(an.length==="full"&&an.visible===F.get("CHATUISVC_VALUE_YES")){if(an.field.type==="input"){this.bindHotkey(this.$dom.chatEl,an.button.hotkey,"clickKB")}else{if(an.field.type==="combo"){this.bindHotkey(this.$dom.chatEl,an.button.hotkey,"clickAction","wrapup")}}}}},updateDashboard:function(ao){var al=this.currDashboard;var am=null;var an;var ak=al.length;for(an=0;an<ak;an++){am=al[an];am.text=ao[am.name]}this.renderDashboard(al)},updateKBVisited:function(ak){ak=ak||"";this.$dom.chatKBVisited&&this.$dom.chatKBVisited.val(ak).attr("aria-label",ak).attr("title",ak)},updateTextLabel:function(ak){this.renderTextLabel(ak)},updateTextLinks:function(ak){this.renderTextLinks(ak)},updateUrlLabel:function(ak){this.renderUrlLabel(ak)},updateUrlLinks:function(ak){this.renderUrlLinks(ak)},updateDashboardSwitch:function(ak,al){this.renderToggleDashboard(ak,al)},renderDashboard:function(ar){var ay=this.$dom.chatDashboard;var ao=null;var ap="";var ak=null;var al=null;var au=null;var ax="";var an;var at=ar.length;var am;var aw=0;var aq;var av=0;for(an=0;an<at;an++){ao=ar[an];if(ao.visible!==F.get("CHATUISVC_VALUE_YES")){continue}ao.text=ao.text||"";if(ao.length==="half"){ax+=this.compileTMPL(T.tmplDashboardItemShort,ao)}else{if(ao.length==="full"){ao.image=ao.button&&ao.button.image;if(ao.field.type==="input"){aq=ao.button||{};ao.buttonTooltip=this.getButtonTooltip(aq.display,aq.hotkey);ao.buttonLabel=aq.display||"";ax+=this.compileTMPL(T.tmplDashboardItemRichInput,ao)}else{if(ao.field.type==="combo"){al=ao.field.options.split(",");au=ao.field.actions.split(",");av=(this.storedMap[this.currChatId]&&this.storedMap[this.currChatId].actionIndex)||0;for(am=0,aw=al.length;am<aw;am++){ak={};ak.isSelect=((am===av)?"selected":"");ak.option=al[am];ak.action=au[am];ap+=this.compileTMPL(T.tmplOption,ak)}ao.options=ap;ao.className="siebui-chat-dashboard-action";aq=ao.button||{};ao.buttonTooltip=this.getButtonTooltip(aq.display,aq.hotkey);ao.buttonLabel=aq.display||"";ax+=this.compileTMPL(T.tmplDashboardItemRichSelect,ao)}else{ax+=this.compileTMPL(T.tmplDashboardItemLong,ao)}}}}}ay.html(ax);this.$dom.chatKBVisited=$("#chatKBVisited",ay);this.$dom.chatAction=$("#chatAction",ay);this.setDefaultTabindex("dashboard");this.eventHelper.Manage(this.$dom.chatAction,"change",{ctx:this},this.onChatActionChange)},renderMsgLog:function(ao){var an=this.storedMap[ao].msgLog;var at=this.$dom.chatMsgLog;var ap=an.length;var ar=0;var ak="";var aq=null;var am;var al=null;if(ap){for(am=0;am<ap;am++){al=an[am];if(al.isAgent){al.agentClassName="siebui-chat-msg-log-item-agent"}else{al.agentClassName=""}if(al.isUrl){al.url=al.msg;if(!(/^[a-z]+:.+/ig).test(al.url)){al.url=al.url.replace(/^([:\/]+)/g,"");al.url="http://"+al.url}ak+=this.compileTMPL(T.tmplMsgLogUrlItem,al)}else{ak+=this.compileTMPL(T.tmplMsgLogItem,al)}}at.html(ak);this.setDefaultTabindex("msgLog");ar=(at[0]&&at[0].scrollHeight)||0;at.scrollTop(ar)}else{at.html("")}},renderTextLabel:function(am){var al=this.$dom.chatTextLabel.children("span")[0];var ak=$(al);var an=am.display||"";ak.text(an).attr("aria-label",an).attr("title",an)},renderTextLinks:function(al){var ap=null;var am=null;var ar="";var aq="";var an;var ak=al.length;var ao="";for(an=0;an<ak;an++){ap=al[an];aq=ap.display||"";ao=this.getButtonTooltip(aq,ap.hotkey);am={title:ao,label:aq,text:aq,className:ap.className,mousedownFnName:ap.fnType==="mousedown"?ap.fnName:"",clickFnName:ap.fnType==="click"?ap.fnName+" clickTabindex":"clickTabindex"};if(ap.visible===F.get("CHATUISVC_VALUE_YES")){ar+=this.compileTMPL(T.tmplTextLink,am)}if(ap.hotkey){this.bindHotkey(this.$dom.chatEl,ap.hotkey,ap.fnName)}}this.$dom.chatTextLinks.html(ar);this.setDefaultTabindex("textToolbar")},renderUrlLabel:function(am){var al=this.$dom.chatUrlLabel.children("span")[0];var ak=$(al);var an=am.display||"";ak.text(an).attr("aria-label",an).attr("title",an)},renderUrlLinks:function(al){var ap=null;var am=null;var ar="";var aq="";var an;var ak=al.length;var ao="";for(an=0;an<ak;an++){ap=al[an];aq=ap.display||"";ao=this.getButtonTooltip(aq,ap.hotkey);am={title:ao,label:aq,text:aq,className:ap.className,mousedownFnName:ap.fnType==="mousedown"?ap.fnName:"",clickFnName:ap.fnType==="click"?ap.fnName+" clickTabindex":"clickTabindex"};if(ap.visible===F.get("CHATUISVC_VALUE_YES")){ar+=this.compileTMPL(T.tmplUrlLink,am)}if(ap.hotkey){this.bindHotkey(this.$dom.chatEl,ap.hotkey,ap.fnName)}}this.$dom.chatUrlLinks.html(ar);this.setDefaultTabindex("urlToolbar")},renderInput:function(am){var an=this.storedMap[am];var al="";var ak="";if(an){al=an.toSendText||"";
ak=an.toSendUrl||"";this.$dom.chatTextInput.val(al);this.$dom.chatTextInput.attr("aria-label",al);this.$dom.chatUrlInput.val(ak);this.$dom.chatUrlInput.attr("aria-label",ak)}this.chatTextInputChange();this.chatUrlInputChange()},renderToggleMode:function(){if(this.$dom.chatEl.length===0){return}var al=E.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_MORE");var ak=E.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_LESS");this.$dom.commPanelChatToShowLess.parent("div").attr("title",ak);this.$dom.commPanelChatToShowLess.attr("aria-label",ak);this.$dom.commPanelChatToShowMore.parent("div").attr("title",al);this.$dom.commPanelChatToShowMore.attr("aria-label",al)},renderToggleDashboard:function(al,am){var ak=al.display||"";var ap=am.display||"";var an=this.getButtonTooltip(al.display,al.hotkey);var ao=this.getButtonTooltip(am.display,am.hotkey);this.bindHotkey(this.$dom.chatEl,al.hotkey,"showDashboard","disabled");this.bindHotkey(this.$dom.chatEl,am.hotkey,"hideDashboard","disabled");this.$dom.chatToShowDashboard.attr("aria-label",ak).text("+");this.$dom.chatToShowDashboard.parent("div").attr("title",an);this.$dom.chatToHideDashboard.attr("aria-label",ap).text("-");this.$dom.chatToHideDashboard.parent("div").attr("title",ao);if(al.visible!==F.get("CHATUISVC_VALUE_YES")&&am.visible!==F.get("CHATUISVC_VALUE_YES")){this.$dom.chatToggleDashboard.hide()}},changeTabStatus:function(am,ak){var al=this.storedMap[am].tabEl;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-tab-head-item-disabled")}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-tab-head-item-disabled")}}},changeDasboardStatus:function(am,ak){var al=this.$dom.chatDashboard;ak=ak||this.storedMap[am].status;al.removeClass().addClass("siebui-chat-dashboard");if(ak==="disabled"){al.addClass("siebui-chat-dashboard-disabled")}else{if(ak==="wrapup"){al.addClass("siebui-chat-dashboard-wrapup")}}},changeMsgLogStatus:function(am,ak){var al=this.$dom.chatMsgLog;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-msg-log-disabled")}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-msg-log-disabled")}}},changeTextToolbarStatus:function(am,ak){var al=this.$dom.chatTextToolbar;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-toolbar-disabled")}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-toolbar-disabled")}}},changeTextInputStatus:function(am,ak){var al=this.$dom.chatTextInput;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-input-disabled");al.attr("readonly",false)}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-input-disabled");al.attr("readonly",true)}}},changeUrlToolbarStatus:function(am,ak){var al=this.$dom.chatUrlToolbar;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-toolbar-disabled")}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-toolbar-disabled")}}},changeUrlInputStatus:function(am,ak){var al=this.$dom.chatUrlInput;ak=ak||this.storedMap[am].status;if(ak==="enabled"){al.removeClass("siebui-chat-input-disabled");al.attr("readonly",false)}else{if(ak==="disabled"||ak==="wrapup"){al.addClass("siebui-chat-input-disabled");al.attr("readonly",true)}}},isDisabled:function(){return this.storedMap[this.currChatId].status==="disabled"},isWrapup:function(){return this.storedMap[this.currChatId].status==="wrapup"},changeStatus:function(al,ak){if(!this.storedMap[al]){return}if(ak){this.storedMap[al].status=ak}if(al!==this.currChatId){return}this.changeTabStatus(al,ak);this.changeDasboardStatus(al,ak);this.changeMsgLogStatus(al,ak);this.changeTextToolbarStatus(al,ak);this.changeTextInputStatus(al,ak);this.changeUrlToolbarStatus(al,ak);this.changeUrlInputStatus(al,ak)},setDefault:function(){this.currChatId="";this.currUserName="";this.lastReadMessage="";this.lastReadLogCount=-1;this.MESSAGE_COUNT=1023;this.currDashboard=[];this.isRtl=false;this.typingIndicator="Customer is typing...";this.systemMessage="System Message";this.storedMap={};this.keyFnArr=[];this.$dom={};this.renderer=null;this.onTyping=this.empty;this.onSendMessage=this.empty;this.onSwitchTab=this.empty;this.onKBClick=this.empty;this.onActionClick=this.empty;this.onImplicitSave=this.empty;this.onSmartShareClick=this.empty;this.eventHelper=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper")},init:function(ak){this.setDefault();if(ak){this.renderer=ak.renderer||null;this.onTyping=ak.onAgentTyping||this.empty;this.onSendMessage=ak.onSendMessage||this.empty;this.onSwitchTab=ak.onSwitchTab||this.empty;this.onKBClick=ak.onKBClick||this.empty;this.onActionClick=ak.onActionClick||this.empty;this.onImplicitSave=ak.onImplicitSave||this.empty;this.onSmartShareClick=ak.onSmartShareClick||this.empty;this.onFrequentlyUsedText=ak.onFrequentlyUsedText||this.empty;this.onPushUrl=ak.onPushUrl||this.empty}},showUI:function(){this.$dom.chatEl=$("#s_chatwrap");this.$dom.chatEl.html(T.tmplTabArea+T.tmplTextArea+T.tmplUrlArea+T.tmplMaskArea);this.initEl();this.isRtl=(window.SiebelApp&&SiebelApp.S_App.GetDirection())||false;this.$dom.chatMsg.resizable({handles:"s"});this.$dom.chatInputWrap.resizable({handles:"s"});this.renderToggleMode();this.bindListener()},setTabCaption:function(al,am){if(!this.storedMap[al]){return}var ak=this.storedMap[al].tabEl;if(ak.length&&am){ak.find("a").text(am);ak.attr("aria-label",am)}},setFocus:function(al){if(!this.storedMap[al]){return}var ak=this.storedMap[al].tabEl;if(ak.length){this.setTabindexByArea(ak,this.$dom.chatTabItems);this.setChatTextInputFocus()}},setTabTooltip:function(al,am){if(!this.storedMap[al]){return}var ak=this.storedMap[al].tabEl;if(ak.length&&am){ak.children("div").attr("title",am)}},setTypingIndicator:function(ak){this.typingIndicator=ak},setSystemMessage:function(ak){this.systemMessage=ak},showTypingIndicator:function(ak){var al="";if(ak===this.currChatId){al=this.$dom.chatTyping.text();if(al===""){this.$dom.chatTyping.text(this.typingIndicator)}}},hideTypingIndicator:function(ak){if(ak===this.currChatId){this.$dom.chatTyping.text("")}},newTab:function(al,am){var ao={chatId:al,userName:am};var ap=null;var an="";var ak=null;SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+al+"] Initial chat.");if(!this.storedMap[al]){this.storedMap[al]={}}ap=this.$dom.chatTabItems;an=this.compileTMPL(T.tmplTabHeadItem,ao);ap.append(an);this.$dom.chatMask.removeClass("siebui-chat-mask");ak=ap.children("li").last();this.setDefaultTabindex("tabs");this.storedMap[al].tabEl=ak;this.storedMap[al].userName=am;this.storedMap[al].msgLog=[];this.storedMap[al].unread=0;this.storedMap[al].status="enabled"},existTab:function(ak){return this.storedMap[ak]},closeTab:function(al){if(!this.storedMap[al]){return}var am=this.$dom.chatTabItems;var ak=this.storedMap[al].tabEl;SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+al+"] Close chat.");ak&&ak.remove();ak=null;delete this.storedMap[al];this.currChatId="";this.currUserName="";this.setDefaultTabindex("tabs")
},activeTab:function(al){if(!this.storedMap[al]){return}var an=this.currChatId;var am="";var ak=null;var ao=null;if(al===an){return}if(an){this.storedMap[an].toSendText=this.$dom.chatTextInput.val();this.storedMap[an].toSendUrl=this.$dom.chatUrlInput.val()}am=this.storedMap[al].userName;ak=this.storedMap[al].tabEl;ao=this.$dom.chatTabItems;ao.children("li").removeClass("siebui-chat-tab-head-item-curr siebui-chat-tab-state-terminate siebui-chat-tab-state-new-msg siebui-chat-tab-state-hold-new siebui-chat-tab-state-new-msg-hold-new");ak.addClass("siebui-chat-tab-head-item-curr");this.currChatId=al;this.currUserName=am;this.clearUnread(al);this.renderMsgLog(al);this.renderInput(al);this.changeStatus(al);this.hideTypingIndicator(al)},enableTab:function(ak){this.changeStatus(ak,"enabled")},disableTab:function(ak){this.changeStatus(ak,"disabled")},wrapupTab:function(ak){this.changeStatus(ak,"wrapup")},switchTab:function(am,ao){if(!this.storedMap[am]){return}var ak=this.currChatId;var al=null;var an=null;if(am===ak){return}if(!this.onImplicitSave(this.renderer)){return}if(this.renderer.GetPM().Get("SwitchDisabled")){return}al=this.storedMap[am].tabEl;an=this.storedMap[ak].tabEl;this.onSwitchTab(this.renderer,ak,am);this.storedMap[ak].toSendText=this.$dom.chatTextInput.val();this.storedMap[ak].toSendUrl=this.$dom.chatUrlInput.val();this.clearUnread(am);this.currChatId=am;this.currUserName=ao;this.renderMsgLog(am);this.renderInput(am);this.changeStatus(am);an.removeClass("siebui-chat-tab-head-item-curr");al.addClass("siebui-chat-tab-head-item-curr").removeClass("siebui-chat-tab-state-terminate siebui-chat-tab-state-new-msg siebui-chat-tab-state-hold-new siebui-chat-tab-state-new-msg-hold-new");this.hideTypingIndicator(am)},changeTabState:function(ap,al,an){if(!this.storedMap[ap]){return}var ar={terminate:"siebui-chat-tab-state-terminate",holdNew:"siebui-chat-tab-state-hold-new",newMsg:"siebui-chat-tab-state-new-msg",newMsgHoldNew:"siebui-chat-tab-state-new-msg-hold-new"};var am=al.split(" ");var at=[];var ak=null;var au=null;var ao;var aq=am.length;for(ao=0;ao<aq;ao++){at.push(ar[am[ao]]||"")}ak=at.join(" ");au=this.storedMap[ap].tabEl;if(an==="add"){au.addClass(ak)}else{if(an==="remove"){au.removeClass(ak)}}},appendMessage:function(ak,an,aq,am,al,ap){if(!this.storedMap[ak]){return}aq=SiebelApp.Utils.replaceAll(aq,"&","&amp;");aq=SiebelApp.Utils.replaceAll(aq," ","&nbsp;");aq=SiebelApp.Utils.replaceAll(aq,'"',"&quot;");aq=SiebelApp.Utils.replaceAll(aq,"'","&#39;");aq=SiebelApp.Utils.replaceAll(aq,"<","&lt;");aq=SiebelApp.Utils.replaceAll(aq,">","&gt;");var ao={chatId:ak,userName:an,msg:aq,time:am,isAgent:al,isUrl:ap};SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+ak+"] Append Message.");if(an==="System Message"){an=this.systemMessage}this.storedMap[ak].msgLog.push(ao);if(ak===this.currChatId){this.renderMsgLog(ak)}},readLastMessage:function(ao){if(!this.storedMap[ao]){return}var ak=this.storedMap[ao].msgLog;var am=ak.length;var an=ak[am-1];if(!an){return}var al=JSON.stringify(an);if(am===this.lastReadLogCount&&al===this.lastReadMessage){return}var ap=an.userName+" "+an.time+" "+an.msg;this.lastReadLogCount=am;this.lastReadMessage=al;this.readMessage(ap)},readMessage:function(al){var ak=this.$dom.chatNewMsg;ak.html(al);setTimeout(function(){ak.html("")},100)},clearMessage:function(ak){if(!this.storedMap[ak]){return}this.storedMap[ak].msgLog=[];if(ak===this.currChatId){this.renderMsgLog(ak)}},getInputText:function(ak){if(!this.storedMap[ak]){return}var al="";SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+ak+"] Get input text from chat.");if(ak===this.currChatId){al=this.$dom.chatTextInput.val()}else{al=this.storedMap[ak].toSendText}return al},setInputText:function(ak,al){if(ak&&ak===this.currChatId){this.$dom.chatTextInput.val(al)}this.chatTextInputChange()},appendInputText:function(ao){var an=this.$dom.chatTextInput.val();var al=an.length;var am=this;var ak="";if(al>0&&an[al-1]!=="\n"){an+="\n"}ak=an+ao;am.$dom.chatTextInput.val(ak);am.storedMap[am.currChatId].toSendPos=ak.length;setTimeout(function(){am.setChatTextInputFocus()},1);this.chatTextInputChange()},getInputUrl:function(al){if(!this.storedMap[al]){return}var ak="";if(al===this.currChatId){ak=this.$dom.chatUrlInput.val()}else{ak=this.storedMap[al].toSendUrl}return ak},setInputUrl:function(al,ak){if(al&&al===this.currChatId){this.$dom.chatUrlInput.val(ak)}this.chatUrlInputChange()},onChatControlResize:function(am,al){var ak=al.size.height-am.data.diff;am.data.child.height((ak>80)?ak:80);al.element.removeAttr("style")},onChatActionChange:function(an){var am=an.data.ctx;var ak=$(an.target);var al=ak[0].selectedIndex;am.storedMap[am.currChatId].actionIndex=al},getButtonTooltip:function(al,ak){al=al||"";if(ak){return al+" ["+ak+"]"}else{return al}}};return N}());return SiebelAppFacade.ChatPhyRenderer})};